{"version":3,"sources":["BRE.js"],"names":["modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","DebugEvents","PHASE_COMPLETION_READY","PHASE_COMPLETION_NOT_READY","PHASE_CHANGED","QUESTION_ANSWERED","QUESTION_NOT_ANSWERED","OPTION_VALUE_CHANGED","BUG_REPORT_SUCCEEDED","BUG_REPORT_FAILED","USER_REJECTED","Phase","[object Object]","phaseName","this","followsUpOn","autoComplete","thingToFollowUpOn","auto","Error","PhaseTypes","ATTEMPT","QUESTION","REPORT","ProcessFactory","_src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__","_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__","_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__","_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__","lazyEvalUsingParent","parentPhase","str","parentResult","result","eval","actions","phaseFactory","cfg","finishWithReport","process","phaseCfg","phases","enqueuePhase","createPhase","bugReporter","lazyEval","phase","addFollowUpPhasesForSuccess","addFollowUpPhasesForAnswers","type","success","subPhase","addSuccessFollowUp","q","questionCfg","entries","questions","optionCfg","options","followUp","option","addFollowUp","DebugProcess","_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__","processName","currentPhaseIndex","push","watchPhase","splice","events","$","on","join","e","trigger","goToNextPhase","thing","getCurrentPhase","getThingsToFollowUpOn","followUpPhases","insertPhase","hasNextPhase","checkCompletionReady","start","length","slice","map","getSummary","PhaseReport","_src_Models_Debug_Phase_js__WEBPACK_IMPORTED_MODULE_0__","_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__","_src_Models_Debug_PhaseTypes_js__WEBPACK_IMPORTED_MODULE_2__","Status","SUCCESS","FAIL","NOT_ATTEMPTED","super","status","error","report","buildReport","submitReport","then","url","html_url","catch","finally","PhaseAttempt_PhaseAttempt","asyncFunctionToAttempt","instructions","attempt","async","fail","_error","_result","summarizeData","ctrl","successFollowUpPhases","abortableAttempt","err","console","warn","Promise","resolve","reject","func","cb","setFollowsUpOn","doAttempt","data","summarizeError","message","extra","stack","phaseNum","functionToAttempt","PhaseQuestion_PhaseQuestion","_examinedHtml","html","examinedHtml","question","isAnswered","reduce","acc","concat","QuestionTypes","VALUE","FREE_FORM","SELECT","Question_Question","text","selectedOptionIndex","index","getSelectedOption","answer","QuestionSelect_QuestionSelect","Option_Option","humanText","className","QuestionFreeForm_QuestionFreeForm","questionText","placeholderText","minResponseLength","setSelectedOption","watchSelectedOption","Correctness","CORRECT","INCORRECT","NOT_SURE","OPTION_INCORRECT","QuestionValue_QuestionValue","valueQuestioned","_valueQuestioned","assign","valueChecked","QuestionFactory_QuestionFactory","createQuestionFreeForm","createQuestionSelect","createQuestionValue","ask","addOption","valueExamined","examine","PhaseFactory_PhaseFactory","questionFactory","createPhaseAttempt","createPhaseQuestion","createPhaseReport","action","internalName","execute","summarizeResult","setDataSummarizer","setInstructions","lookAt","addQuestion","DataCollector","debugProcess","censoredProps","Set","scrub","buildData","nav","window","navigator","getSummarySoFar","contentHtml","document","getElementById","outerHTML","appCodeName","app","appName","appVersion","platfrom","userAgent","languages","extend","oscpu","gameData","game_data","keys","has","censorCsrfInString","replace","API","bugReport","BugReporter_BugReporter","title","dataCollected","getCollectibleData","majorVersion","world","player","TwCheese","version","JSON","stringify","createIssue","response","fetch","method","body","ok","statusText","json","getProp","propPath","defaultValue","tokens","split","token","language","buildings","twcheese","market","textScraper","gameTexts","textId","haystack","needle","includes","elements","searchFor","filter","el","buildingType","buildingName","game","image_base","ImageSrc_self","ROOT","ImageSrc","plus","minus","wood","stone","iron","attack","haulPartial","haulFull","info","attackSentViaFa","attackSizeSmall","attackSizeMedium","attackSizeLarge","attackContainsSnob","attackContainsSpy","attackContainsKnight","popupBackground","popupBorder","servant","loadingSpinner","calendar","sidebarMain","sidebarBug","sidebarGithub","jq","blue","black","darkGrey","grey","red","legacy","helpBackground","helpBackgroundBright","buildingIcon","troopIcon","troopType","dotIcon","color","scavengeOption","optionId","BattleReportCondensed_BattleReportCondensed","subject","attackIcons","attackerName","attackerNobleDied","attackerVillage","buildingLevels","defenderName","defenderVillage","defenderSurvivors","dotColor","haulStatus","HAUL_STATUS_UNKNOWN","isForwarded","loyalty","note","reportId","resources","strTimeReceived","timeLaunched","wasAttackFeint","isZero","HAUL_STATUS_FULL","village","Math","round","distanceTo","HAUL_STATUS_PARTIAL","Village","id","x","y","parseInt","otherVillage","diffX","diffY","hypot","Resource_Resource","amount","TYPE_TIMBER","TYPE_CLAY","TYPE_IRON","Resources_Resources","woodAmount","stoneAmount","ironAmount","other","factor","maxAmount","min","valueOf","TYPES","Config_Config","props","_loadCachedData","prop","setProp","_save","saved","localStorage","getItem","parse","_beforeSave","setItem","_getCacheableData","throttle","maxBurstsPerSecond","recentRequests","Array","unshift","performance","now","pop","anchorTimestamp","delayMs","setTimeout","originalFetch","requestDocument","sleepIfNeeded","responseText","doc","DOMParser","parseFromString","gameUrl","screen","uriParams","domain","TribalWars","buildURL","attackPrepUrl","unitCounts","targetVillageId","originVillageId","from","target","unitType","count","requestWasMade","apply","arguments","RemoteConfig_RemoteConfig","seconds","ttl","needsUpdate","update","Date","getTime","timeUpdated","xmlDoc","requestXml","_processXml","parseXmlNode","node","children","parseFloat","innerHTML","childNode","tagName","config","userConfig","gameConfig","setUrl","setTtl","buildingConfig","troopConfig","main","maxLevel","minLevel","popFactor","req","barracks","stable","smith","garage","church","farm","church_f","snob","place","statue","storage","hide","wall","watchtower","buildingTypes","resProductionHourly","level","popUsed","building","pop_factor","Buildings_BuildingLevels","fill","max_level","areRequirementsMet","reqs","requiredBuildingLevels","reqType","reqLevel","array","levels","forEach","buildingUtil","typeExistsOnWorld","Troops_troopTypes","travelMinutes","troop","speed","troopCarry","carry","TroopCounts","allowedTroopTypes","counts","values","sum","doSomething","capacity","troopPop","distance","role","calcTravelDuration","travelMinutesPerField","knight","relevantMinutes","max","subtrahend","difference","troopCounts","troops","minutesPerField","troopUtil","troopTypesOnWorld","units","existsOnWorld","resourceAmount","haulBonus","troopCount","carryCapacity","travelDuration","serverOffsetFromUtc","server_utc_diff","localOffsetFromUtc","getTimezoneOffset","pretendServerIsUTC","cheeseDate","addMilliseconds","TwCheeseDate_TwCheeseDate","Timing","getCurrentServerTime","days","ret","clone","setUTCDate","getUTCDate","hours","setUTCHours","getUTCHours","minutes","setUTCMinutes","getUTCMinutes","setUTCSeconds","getUTCSeconds","milliseconds","setUTCMilliseconds","getUTCMilliseconds","addDays","addHours","addMinutes","addSeconds","getUTCFullYear","getUTCMonth","date","isSameDayInUtc","tomorrow","otherDate","includeMillis","year","monthName","toLocaleString","month","day","toString","padStart","ms","getMonth","ReportRenamer_ReportRenamer","newName","createName","post","postToGame","ajaxaction","report_id","attacker","defender","timingInfo","calcTimingInfo","floor","launchTime","attackerLosses","after","toArray","reportName","trim","startsWith","parseTwCheeseName","parseDefaultName","fallbackReport","aName","dvX","dvY","match","avX","avY","avId","dName","dvId","matches","fromArray","newServerDate","catAmounts","catAmountsChurch","ramAmounts","invulnerable","DemolitionCalculator","demoScouted","demoBuffer","assignDemolition","siegeAmounts","whichSiegeLookup","bufferLevel","canUpgrade","oneShotScouted","oneShotUpgraded","BattleReport_BattleReport","attackerQuantity","attackerSurvivors","battleTime","catDamage","defenderLosses","defenderQuantity","espionageLevel","haul","luck","morale","ramDamage","unitsInTransit","unitsOutside","subMilliseconds","returnTime","startOfSecond","buildingPop","populationUsed","idle","populationCap","calcRaidUnits","home","timeNow","maxLoot","resourceCap","hideableResources","hourlyProduction","resourceProductionHourly","hoursSinceReport","resourcesProducedSinceReport","multiply","resourcesNow","add","travelHours","resourcesProducedDuringTravel","resourcesAtArrival","cap","countToCarry","periodHours","resourcesProduced","totalResources","suggestSiegeUnits","Player","StationedTroops","parseArrival","monthNumber","yearShort","millis","parseArrivalCzech","parseArrivalPortuguese","parseArrivalEnglish","scrapeResources","resourcesContainer","$res","find","remove","resAmount","resIconCssClass","icon","parent","scrapePlayer","playerCell","playerLink","firstChild","href","scrapeTroopCounts","troopRow","troopTypes","cells","scrapeVillage","link","removeTroopsLabel","troopRowCopy","createElement","appendChild","BattleReportScraper_BattleReportScraper","gameDoc","$gameDoc","mainTable","parents","luckTable","attackerTable","attackerUnitsTable","defenderTable","defenderUnitsTable","resultsTable","supportKilledTable","_validate","shouldAlwaysBeThere","propName","getAttacker","getAttackerLosses","getAttackerQuantity","getAttackerVillage","getBattleTime","getBuildingLevels","getCatDamage","getDefender","getDefenderLosses","getDefenderQuantity","getDefenderVillage","getDotColor","getEspionageLevel","getHaul","getLoyalty","getLuck","getMorale","getRamDamage","getReportId","getResources","getUnitsOutside","getUnitsInTransit","subtract","levelAfter","rows","buildingData","val","thElements","getElementsByTagName","catHeader","first","damageCell","parentNode","bElements","levelBefore","attr","spied_resources","spied_buildings","spied_external","Number","haulHeader","luckString","substring","indexOf","loyaltyHeader","before","moraleContainer","moraleString","ramHeader","URL","resContainer","supportKilled","row","h4elements","transitHeader","nextSibling","bits","SENT_VIA_FA","CONTAINS_SNOB","CONTAINS_KNIGHT","SIZE_SMALL","SIZE_MEDIUM","SIZE_LARGE","CONTAINS_SPY","sizeThresholds","Icons","Map","src","description","AttackIcons","mask","icons","bit","wasSentViaFa","spy","threshold","AttackIconsScraper_AttackIconsScraper","imgElements","img","setSentViaFa","setContainsSnob","setContainsSpy","setContainsKnight","setSizeSmall","setSizeMedium","setSizeLarge","BattleReportCondensedScraper_BattleReportCondensedScraper","reportRenamer","attackIconsScraper","reportsTable","reports","scrapeReport","reportLink","reportIcons","parseName","isNew","classList","contains","unconverted","querySelector","innerText","determineHaulStatus","scrapeIcons","lootImg","scoreDefenderDied","spear","sword","axe","archer","light","marcher","heavy","ram","catapult","militia","scoreAttackerDied","UI_escapeHtml","String","&","<",">","\"","'","cssInitd","initCss","css","appendTo","enhanceBattleReport","reportTable","defenseUnitsTable","rowAbove","survivorsRow","insertRow","insertCell","align","cell","unitCount","unit_table","population","calcPopulation","idleLabel","loyaltyExtra","reportedLoyalty","timeReported","hourlyGain","hoursPassed","loyaltyNow","loyaltyAtArrival","calcLoyalty","resultsHeaders","loyaltyRow","loyaltyHTML","removeChild","oddRow","oddHeader","defenderScore","calcDefenderScore","odaRow","odaHeader","attackerScore","calcAttackerScore","launchRow","toHtml","showReturnTime","returnRow","isDefenderMe","wasVillageConquered","linkHtml","jsonRow","colSpan","spawnLegacyHelpButton_language","AbstractWidget","_beforeInsert","$el","append","afterInsert","callback","observer","MutationObserver","mutations","outerloop","mutation","addedNodes","disconnect","observe","attributes","childList","subtree","afterDOMInsert","ReportRaiderWidget_ReportRaiderWidget","raiderTroopTypes","initStructure","watchSelf","applyUserConfig","mayFillRallyPoint","$scoutsContainer","createHtml","$raidMode","$haulBonus","$period","$periodContainer","$scouts","$buttonSetDefault","raiderUnitsTable","$raiderLinks","$raiderTroopCounts","travelTimes","calcTravelDurations","rallyPointUrl","raidModeOptions","iconCells","troopCountCells","travelTimeCells","Format","timeSpan","updateRaiders","set","getScouts","getRaidMode","getHaulBonus","getPeriod","UI","SuccessMessage","period","scouts","raidMode","raiders","calcRaidScouted","setRaiders","calcRaidPredicted","calcRaidPeriodic","show","spyCount","attackUrl","eq","ReportRenamerWidget_ReportRenamerWidget","renamer","$note","$renameButton","$autoRename","$namePreview","$availableChars","availableChars","rename","checked","autoRename","ReportToolsWidget_ReportToolsWidget","initChildWidgets","$content","$toggleIcon","$raiderContainer","$renamerContainer","createDemolitionTableHtml","catHeaders","ramHeaders","catRowOne","catRowTwo","ramRowOne","ramRowTwo","suggestedCounts","buildingTypesOnWorld","headerInnerHtml","siegeWeapon","rowTwo","toggleCollapsed","toggle","duration","willCollapse","columnCategories_language","centeredImg","tooltip","villageLink","columnCategories_cfg","hideable","cols","width","header","haulStatusIconSrc","view","createCellHtml","getIcons","escapeHtml","defenderDistance","try","startHidden","resType","number","cssClass","columnCategories","category","cellAtIndex","endIndex","initialColSpan","ReportListWidget_ReportListWidget","columnIndexes","resizable","reportsFolderDisplay","style","overflow","position","height","minHeight","minWidth","reportsTableHeaderDiv","reportsTableHeader","tableLayout","cellIndex","titleTh","widthSum","colIndexes","col","alignmentTh","paddingTop","paddingBottom","lowerTh","borderSpacing","reportsTableBodyDiv","clientHeight","reportsTableBody","alignmentCell","yScrollPanel","overflowY","overflowX","background","right","scrollbarWidth","yTableEmulator","xScrollPanel","marginTop","xTableEmulator","clientWidth","$head","$body","$bodyPane","$xBodyEmulator","$yBodyEmulator","$xScrollPanel","$yScrollPanel","$headContainer","top","outerHeight","populateReportsTable","applySettings","fitDisplayComponents","scrollTop","scrollLeft","preventDefault","deltaY","sign","originalEvent","timeStart","scrollStep","msElapsed","stepY","requestAnimationFrame","minimal","fallbackSubjectColSpan","twcheeseReport","hasDecentInfo","textAlign","alignForTroops","alignForResources","adjustScrollbars","hideColumns","settingName","configKey","showColumn","hideColumn","column","head","tableWidth","columnWidth","display","bodyPaneHeight","maxChars","chars","alignCols","bodyCell","padding","isReportMatch","DisplayConfigurer_DisplayConfigurer","reportListWidget","widget","toggleReportsColumns","getHideableCategories","refreshContents","DisplayConfigWidget_DisplayConfigWidget","displayConfigurer","reportsFolderSettingsDiv","insertCheckbox","shouldShowColumn","toggleColumn","getHideableColumns","Exporter_Exporter","attackFrom","headerText","exportText","buildHeader","ATTACK_FROM_CURRENT","buildEntryCurrentVillage","ATTACK_FROM_ORIGINAL","buildEntryOriginalVillage","buildFooter","ExporterBBCode_ExporterBBCode","urlCurrentVillage","coord","urlOriginalVillage","ExporterPlainText_ExporterPlainText","ExporterHTML_ExporterHTML","leadingZero","ExportRepeatLinksWidget_ExportRepeatLinksWidget","defaultHeader","exporters","bbcode","plainLink","updateExportText","$exportText","$buttonCopy","$headerInput","$formatOptions","$attackingVillageOptions","select","execCommand","format","buildExportText","ReportSelector","getSelectedReportIds","selectMatchingReports","deselectAllReports","wasDefenderCleared","textLower","toLowerCase","nameLower","coordinates","ReportSelectorWidget_ReportSelectorWidget","reportSelector","reportsSelectorBar","borderStyle","borderWidth","reportsSelectorBarLabel","backgroundColor","backgroundImage","backgroundRepeat","fontSize","fontWeight","paddingLeft","selectorClickyTable","imgHtml","clickyOptions","click","selectAll","selectNone","selectNew","selectOld","selectUnconverted","selectDotColor","selectForwarded","selectLoot","BattleReportCondensed","selectFeint","selectDeadNoble","selectLoyalty","selectCleared","descriptor","optionEl","addEventListener","selectorInputTable","inputOptions","hintInput","hintButton","use","selectText","sprite","selectAttacker","selectDefender","placeholder","coords","selectAttackerVillage","selectDefenderVillage","input","size","alreadyCleared","$button","$buttonIcon","margin","MassRenamerWidget_language","MassRenamerWidget_MassRenamerWidget","$buttonRename","$progressCount","$targetCount","$progressPercent","$timeRemaining","massRename","reportIds","total","progress","estimatedTimeRemaining","startTime","reportDoc","fullReport","oldReport","minutesRemaining","secondsRemaining","refreshDisplay","ErrorMessage","ReportsFolderWidget_ReportsFolderWidget","reportsFolder","reportsFolderToolbar","currentPanel","toggleDisplayConfig","toggleExport","processCfg","skipKey","skippableId","initialized","reportEnhanced","reportsFolderEnhanced","enhanceReportsFolder","oldReportsList","reportsForm","reportScraper","scrapeReports","insertBefore","processFactory","registerTool","narcismDiv","all","ensureUpdated","ensureRemoteConfigsUpdated","address","twcheese_menu","twcheese_menu_text","left","marginLeft","zIndex","onmouseover","onmouseout","cursor","onclick","open","spawnLegacyHelpButton","enhanceReport","screenName","InfoMessage","redirect","buttonConfirm","skipNextTime","confirm","ConfirmationBox","buildContent","suggestRedirect","getDebugProcess"],"mappings":"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","file":"../BRE.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 8);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return DebugEvents; });\nconst DebugEvents = {\r\n  PHASE_COMPLETION_READY: 'phase_completion_ready',\r\n  PHASE_COMPLETION_NOT_READY: 'phase_completion_not_ready',\r\n  PHASE_CHANGED: 'phase_changed',\r\n  QUESTION_ANSWERED: 'question_answered',\r\n  QUESTION_NOT_ANSWERED: 'question_not_answered',\r\n  OPTION_VALUE_CHANGED: 'answer_value_changed',\r\n  BUG_REPORT_SUCCEEDED: 'bug_report_succeeded',\r\n  BUG_REPORT_FAILED: 'bug_report_failed',\r\n  USER_REJECTED: 'user_rejected'\r\n};\r\n\r\n\r\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return Phase; });\nclass Phase {\r\n  constructor(phaseName) {\r\n    this.name = phaseName;\r\n    this.followsUpOn = null;\r\n    this.autoComplete = false;\r\n  }\r\n\r\n  setFollowsUpOn(thingToFollowUpOn) {\r\n    this.followsUpOn = thingToFollowUpOn;\r\n    return this;\r\n  }\r\n\r\n  setAutoComplete(auto) {\r\n    this.autoComplete = auto;\r\n    return this;\r\n  }\r\n\r\n  getType() {\r\n    throw Error('notimplemented');\r\n  }\r\n\r\n  start() {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  checkCompletionReady() {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  getThingsToFollowUpOn() {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  getSummary() {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n}\r\n\r\n\r\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PhaseTypes; });\nconst PhaseTypes = {\r\n  ATTEMPT: 'attempt',\r\n  QUESTION: 'question',\r\n  REPORT: 'report'\r\n};\r\n\r\n\r\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return ProcessFactory; });\n/* harmony import */ var _src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(4);\n/* harmony import */ var _src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(6);\n/* harmony import */ var _src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(7);\n/* harmony import */ var _src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(5);\n\r\n\r\n\r\n\r\n\r\n\r\nfunction lazyEvalUsingParent(parentPhase) {\r\n  return (str) => {\r\n    return () => {\r\n      let parentResult = parentPhase.result;\r\n      return eval(str);\r\n    };\r\n  }\r\n}\r\n\r\n\r\nclass ProcessFactory {\r\n\r\n  constructor(actions) {\r\n    this.phaseFactory = new _src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__[/* PhaseFactory */ \"a\"](actions);\r\n  }\r\n\r\n  create(name, cfg, finishWithReport) {\r\n    let process = new _src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugProcess */ \"a\"](name);\r\n\r\n    for (let phaseCfg of cfg.phases) {\r\n      process.enqueuePhase(this.createPhase(phaseCfg));\r\n    }\r\n\r\n    if (finishWithReport) {\r\n      let bugReporter = new _src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__[/* BugReporter */ \"a\"](process);\r\n      process.enqueuePhase(_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__[/* PhaseReport */ \"a\"].create(bugReporter));\r\n    }\r\n\r\n    return process;\r\n  }\r\n\r\n  createPhase(cfg, lazyEval) {\r\n    let phase = this.phaseFactory.create(cfg, lazyEval);\r\n    this.addFollowUpPhasesForSuccess(phase, cfg);\r\n    this.addFollowUpPhasesForAnswers(phase, cfg);\r\n    return phase;\r\n  }\r\n\r\n  addFollowUpPhasesForSuccess(phase, cfg) {\r\n    if (cfg.type === 'PhaseAttempt' && cfg.success) {\r\n      for (let phaseCfg of cfg.success) {\r\n        let subPhase = this.createPhase(phaseCfg, lazyEvalUsingParent(phase));\r\n        phase.addSuccessFollowUp(subPhase);\r\n      }\r\n    }\r\n  }\r\n\r\n  addFollowUpPhasesForAnswers(phase, cfg) {\r\n    if (cfg.type !== 'PhaseQuestion') {\r\n      return;\r\n    }\r\n\r\n    for (let [q, questionCfg] of Object.entries(cfg.questions)) {\r\n      if (questionCfg.type !== 'QuestionSelect') {\r\n        continue;\r\n      }\r\n      for (let [o, optionCfg] of Object.entries(questionCfg.options)) {\r\n        if (optionCfg.followUp) {\r\n          for (let phaseCfg of optionCfg.followUp) {\r\n            let option = phase.questions[q].options[o];\r\n            let subPhase = this.createPhase(phaseCfg, lazyEvalUsingParent(phase))\r\n            option.addFollowUp(subPhase);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n};\r\n\r\n\r\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return DebugProcess; });\n/* harmony import */ var _src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(0);\n\r\n\r\n\r\nclass DebugProcess {\r\n  constructor(processName) {\r\n    this.name = processName;\r\n    this.phases = [];\r\n    this.currentPhaseIndex = -1;\r\n  }\r\n\r\n  enqueuePhase(phase) {\r\n    this.phases.push(phase);\r\n    this.watchPhase(phase);\r\n    return this;\r\n  }\r\n\r\n  insertPhase(phase) {\r\n    this.phases.splice(this.currentPhaseIndex + 1, 0, phase);\r\n    this.watchPhase(phase);\r\n    return this;\r\n  }\r\n\r\n  watchPhase(phase) {\r\n    let events = [\r\n      _src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_READY,\r\n      _src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_NOT_READY,\r\n      _src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_CHANGED\r\n    ];\r\n\r\n    $(phase).on(events.join(' '), (e) => $(this).trigger(e.type, e));\r\n\r\n    $(phase).on(_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_READY, () => {\r\n      if (phase.autoComplete) {\r\n        this.goToNextPhase();\r\n      }\r\n    });\r\n  }\r\n\r\n  start() {\r\n    this.currentPhaseIndex = -1;\r\n    this.goToNextPhase();\r\n  }\r\n\r\n  goToNextPhase() {\r\n    if (this.currentPhaseIndex >= 0) {\r\n      for (let thing of this.getCurrentPhase().getThingsToFollowUpOn()) {\r\n        for (let phase of thing.followUpPhases) {\r\n          this.insertPhase(phase);\r\n        }\r\n      }\r\n    }\r\n    if (!this.hasNextPhase()) {\r\n      throw Error(`there's no next phase`);\r\n    }\r\n    this.currentPhaseIndex++;\r\n    $(this).trigger(_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_0__[/* DebugEvents */ \"a\"].PHASE_CHANGED);\r\n    this.getCurrentPhase().checkCompletionReady();\r\n    this.getCurrentPhase().start();\r\n  }\r\n\r\n  hasNextPhase() {\r\n    return this.currentPhaseIndex < this.phases.length - 1;\r\n  }\r\n\r\n  getCurrentPhase() {\r\n    return this.phases[this.currentPhaseIndex];\r\n  }\r\n\r\n  getSummarySoFar() {\r\n    // everything before the current phase\r\n    return this.phases.slice(0, this.currentPhaseIndex)\r\n      .map(phase => phase.getSummary());\r\n  }\r\n\r\n  static create(processName) {\r\n    return new DebugProcess(processName);\r\n  }\r\n\r\n}\r\n\r\n\r\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PhaseReport; });\n/* harmony import */ var _src_Models_Debug_Phase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(1);\n/* harmony import */ var _src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(0);\n/* harmony import */ var _src_Models_Debug_PhaseTypes_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(2);\n\r\n\r\n\r\n\r\n\r\nconst Status = {\r\n  SUCCESS: 'success',\r\n  FAIL: 'fail',\r\n  NOT_ATTEMPTED: 'not_attempted'\r\n};\r\n\r\n\r\nclass PhaseReport extends _src_Models_Debug_Phase_js__WEBPACK_IMPORTED_MODULE_0__[/* Phase */ \"a\"] {\r\n  constructor(bugReporter) {\r\n    super('send bug report');\r\n    this.bugReporter = bugReporter;\r\n    this.status = Status.NOT_ATTEMPTED;\r\n    this.error;\r\n  }\r\n\r\n  getType() {\r\n    return _src_Models_Debug_PhaseTypes_js__WEBPACK_IMPORTED_MODULE_2__[/* PhaseTypes */ \"a\"].REPORT;\r\n  }\r\n\r\n  start() {\r\n    let report = this.bugReporter.buildReport();\r\n    this.bugReporter.submitReport(report)\r\n      .then(d => {\r\n        this.status = Status.SUCCESS;\r\n        $(this).trigger({\r\n          type: _src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].BUG_REPORT_SUCCEEDED,\r\n          url: d.html_url\r\n        })\r\n      })\r\n      .catch(error => {\r\n        this.error = error;\r\n        this.status = Status.FAIL;\r\n        $(this).trigger(_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].BUG_REPORT_FAILED)\r\n      })\r\n      .finally(() => this.checkCompletionReady());\r\n  }\r\n\r\n  checkCompletionReady() {\r\n    if (this.status !== Status.NOT_ATTEMPTED) {\r\n      $(this).trigger(_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_READY);\r\n    } else {\r\n      $(this).trigger(_src_Models_Debug_DebugEvents_js__WEBPACK_IMPORTED_MODULE_1__[/* DebugEvents */ \"a\"].PHASE_COMPLETION_NOT_READY);\r\n    }\r\n  }\r\n\r\n  getThingsToFollowUpOn() {\r\n    return [];\r\n  }\r\n\r\n  getSummary() {\r\n    return {\r\n      phaseName: this.name\r\n    };\r\n  }\r\n\r\n  static create(bugReporter) {\r\n    return new PhaseReport(bugReporter);\r\n  }\r\n}\r\n\r\n\r\n\r\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// EXTERNAL MODULE: ./src/Models/Debug/Phase.js\nvar Phase = __webpack_require__(1);\n\n// EXTERNAL MODULE: ./src/Models/Debug/DebugEvents.js\nvar DebugEvents = __webpack_require__(0);\n\n// EXTERNAL MODULE: ./src/Models/Debug/PhaseTypes.js\nvar PhaseTypes = __webpack_require__(2);\n\n// CONCATENATED MODULE: ./src/Models/Debug/PhaseAttempt.js\n\r\n\r\n\r\n\r\nconst Status = {\r\n  SUCCESS: 'success',\r\n  FAIL: 'fail',\r\n  NOT_ATTEMPTED: 'not_attempted'\r\n};\r\n\r\n\r\nclass PhaseAttempt_PhaseAttempt extends Phase[\"a\" /* Phase */] {\r\n  constructor(phaseName, asyncFunctionToAttempt) {\r\n    super(phaseName);\r\n    this.instructions;\r\n    this.attempt = asyncFunctionToAttempt;\r\n    this.success = async () => {\r\n    };\r\n    this.fail = async () => {\r\n    };\r\n    this.status = Status.NOT_ATTEMPTED;\r\n    this.autoComplete = true;\r\n    this._error;\r\n    this._result;\r\n    this.summarizeData = d => d;\r\n    this.ctrl = {};\r\n\r\n    this.successFollowUpPhases = [];\r\n  }\r\n\r\n  getType() {\r\n    return PhaseTypes[\"a\" /* PhaseTypes */].ATTEMPT;\r\n  }\r\n\r\n  get result() {\r\n    if (this.status === Status.NOT_ATTEMPTED) {\r\n      throw new Error('tried to get result before the attempt settled');\r\n    }\r\n    if (this.status === Status.FAIL) {\r\n      throw new Error(`tried to get result of an attempt that failed`);\r\n    }\r\n    return this._result;\r\n  }\r\n\r\n  async doAttempt() {\r\n    try {\r\n      let result = await this.abortableAttempt();\r\n      this.status = Status.SUCCESS;\r\n      this._result = result;\r\n      await this.success(result);\r\n    } catch (err) {\r\n      console.warn(err);\r\n      this.status = Status.FAIL;\r\n      this._error = err;\r\n      await this.fail(err);\r\n    }\r\n    this.checkCompletionReady();\r\n  }\r\n\r\n  async abortableAttempt() {\r\n    return new Promise(async (resolve, reject) => {\r\n      $(this.ctrl).on(DebugEvents[\"a\" /* DebugEvents */].USER_REJECTED, () => reject('user rejected'));\r\n      try {\r\n        let parentResult;\r\n        if (this.followsUpOn) {\r\n          parentResult = this.followsUpOn.result;\r\n        }\r\n        let result = await this.attempt(parentResult, this.ctrl);\r\n        resolve(result);\r\n      } catch (err) {\r\n        reject(err);\r\n      }\r\n    });\r\n  }\r\n\r\n  userAbort() {\r\n    $(this.ctrl).trigger(DebugEvents[\"a\" /* DebugEvents */].USER_REJECTED);\r\n  }\r\n\r\n  setInstructions(instructions) {\r\n    this.instructions = instructions;\r\n    return this;\r\n  }\r\n\r\n  setDataSummarizer(func) {\r\n    this.summarizeData = func;\r\n    return this;\r\n  }\r\n\r\n  onSuccess(cb) {\r\n    this.success = cb;\r\n    return this;\r\n  }\r\n\r\n  addSuccessFollowUp(phase) {\r\n    this.successFollowUpPhases.push(phase);\r\n    phase.setFollowsUpOn(this);\r\n    return this;\r\n  }\r\n\r\n  get followUpPhases() {\r\n    if (this.status === Status.SUCCESS) {\r\n      return this.successFollowUpPhases;\r\n    }\r\n    return [];\r\n  }\r\n\r\n  onFail(cb) {\r\n    this.fail = cb;\r\n    return this;\r\n  }\r\n\r\n  start() {\r\n    this.doAttempt();\r\n  }\r\n\r\n  checkCompletionReady() {\r\n    if (this.status !== Status.NOT_ATTEMPTED) {\r\n      $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_READY);\r\n    } else {\r\n      $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_NOT_READY);\r\n    }\r\n  }\r\n\r\n  getThingsToFollowUpOn() {\r\n    return [this];\r\n  }\r\n\r\n  getSummary() {\r\n    return {\r\n      phaseName: this.name,\r\n      status: this.status,\r\n      data: typeof this._result === 'undefined' ? this._result : this.summarizeData(this._result),\r\n      error: this.summarizeError()\r\n    }\r\n  }\r\n\r\n  summarizeError() {\r\n    let err = this._error;\r\n    if (!(err instanceof Error)) {\r\n      return err;\r\n    }\r\n    return {\r\n      message: err.message,\r\n      name: err.name,\r\n      extra: err.extra,\r\n      stack: err.stack\r\n    };\r\n  }\r\n\r\n  static create(phaseNum, functionToAttempt) {\r\n    return new PhaseAttempt_PhaseAttempt(phaseNum, functionToAttempt);\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/PhaseQuestion.js\n\r\n\r\n\r\n\r\n\r\nclass PhaseQuestion_PhaseQuestion extends Phase[\"a\" /* Phase */] {\r\n  constructor(phaseName) {\r\n    super(phaseName);\r\n    this.questions = [];\r\n    this._examinedHtml;\r\n  }\r\n\r\n  getType() {\r\n    return PhaseTypes[\"a\" /* PhaseTypes */].QUESTION;\r\n  }\r\n\r\n  lookAt(html) {\r\n    this._examinedHtml = html;\r\n    return this;\r\n  }\r\n\r\n  get examinedHtml() {\r\n    if (typeof this._examinedHtml === 'function') {\r\n      return this._examinedHtml();\r\n    }\r\n    return this._examinedHtml;\r\n  }\r\n\r\n  addQuestion(question) {\r\n    this.questions.push(question);\r\n    $(question).on(DebugEvents[\"a\" /* DebugEvents */].QUESTION_ANSWERED, () => {\r\n      this.checkCompletionReady();\r\n    });\r\n    $(question).on(DebugEvents[\"a\" /* DebugEvents */].QUESTION_NOT_ANSWERED, () => {\r\n      this.checkCompletionReady();\r\n    });\r\n    return this;\r\n  }\r\n\r\n  start() {\r\n    // do nothing;\r\n  }\r\n\r\n  checkCompletionReady() {\r\n    for (let question of this.questions) {\r\n      if (!question.isAnswered()) {\r\n        $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_NOT_READY);\r\n        return;\r\n      }\r\n    }\r\n    $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].PHASE_COMPLETION_READY);\r\n  }\r\n\r\n  getThingsToFollowUpOn() {\r\n    return this.questions.reduce((acc, question) => acc.concat(question.getThingsToFollowUpOn()), []);\r\n  }\r\n\r\n  getSummary() {\r\n    return {\r\n      phaseName: this.name,\r\n      questions: this.questions.map(question => question.getSummary())\r\n    };\r\n  }\r\n\r\n  static create(phaseName) {\r\n    return new PhaseQuestion_PhaseQuestion(phaseName);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionTypes.js\nconst QuestionTypes = {\r\n  VALUE: 'value',\r\n  FREE_FORM: 'free_form',\r\n  SELECT: 'select'\r\n};\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Question.js\n\r\n\r\n\r\nclass Question_Question {\r\n  constructor(text) {\r\n    this.text = text;\r\n    this.options = [];\r\n    this.selectedOptionIndex = null;\r\n  }\r\n\r\n  getType() {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  addOption(option) {\r\n    this.options.push(option);\r\n    return this;\r\n  }\r\n\r\n  setSelectedOption(index) {\r\n    this.selectedOptionIndex = index;\r\n    $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].QUESTION_ANSWERED);\r\n    return this;\r\n  }\r\n\r\n  isAnswered() {\r\n    return this.selectedOptionIndex !== null;\r\n  }\r\n\r\n  getSelectedOption() {\r\n    return this.options[this.selectedOptionIndex];\r\n  }\r\n\r\n  getThingsToFollowUpOn() {\r\n    let option = this.getSelectedOption();\r\n    return (option.followUpPhases.length > 0) ? [option] : [];\r\n  }\r\n\r\n  getSummary() {\r\n    return {\r\n      question: this.text,\r\n      answer: this.getSelectedOption().value\r\n    };\r\n  }\r\n\r\n  static create(text) {\r\n    return new Question_Question(text);\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionSelect.js\n\r\n\r\n\r\n\r\nclass QuestionSelect_QuestionSelect extends Question_Question {\r\n  getType() {\r\n    return QuestionTypes.SELECT;\r\n  }\r\n\r\n  static create(text) {\r\n    return new QuestionSelect_QuestionSelect(text);\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Option.js\n\r\n\r\n\r\nclass Option_Option {\r\n  constructor(humanText, value, className = '') {\r\n    this.text = humanText;\r\n    this.value = value;\r\n    this.className = className;\r\n    this.followUpPhases = [];\r\n  }\r\n\r\n  addFollowUp(phase) {\r\n    this.followUpPhases.push(phase);\r\n    phase.setFollowsUpOn(this);\r\n    return this;\r\n  }\r\n\r\n  setValue(value) {\r\n    this.value = value;\r\n    $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].OPTION_VALUE_CHANGED);\r\n  }\r\n\r\n  static create(humanText, value, className) {\r\n    return new Option_Option(humanText, value, className);\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionFreeForm.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass QuestionFreeForm_QuestionFreeForm extends Question_Question {\r\n\r\n  constructor(questionText, placeholderText, minResponseLength = 0) {\r\n    super(questionText);\r\n    this.minResponseLength = minResponseLength;\r\n    this.options = [\r\n      Option_Option.create(placeholderText, '', 'free-form')\r\n    ];\r\n    this.setSelectedOption(0);\r\n    this.watchSelectedOption();\r\n  }\r\n\r\n  getType() {\r\n    return QuestionTypes.FREE_FORM;\r\n  }\r\n\r\n  watchSelectedOption() {\r\n    $(this.getSelectedOption()).on(DebugEvents[\"a\" /* DebugEvents */].OPTION_VALUE_CHANGED, () => {\r\n      if (this.isAnswered()) {\r\n        $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].QUESTION_ANSWERED);\r\n      } else {\r\n        $(this).trigger(DebugEvents[\"a\" /* DebugEvents */].QUESTION_NOT_ANSWERED);\r\n      }\r\n    });\r\n  }\r\n\r\n  isAnswered() {\r\n    return super.isAnswered() && this.options[0].value.length >= this.minResponseLength;\r\n  }\r\n\r\n  static create(questionText, placeholderText, minResponseLength) {\r\n    return new QuestionFreeForm_QuestionFreeForm(questionText, placeholderText, minResponseLength);\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Correctness.js\nconst Correctness = {\r\n  CORRECT: 'correct',\r\n  INCORRECT: 'incorrect',\r\n  NOT_SURE: 'not_sure'\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/QuestionValue.js\n\r\n\r\n\r\n\r\n\r\n\r\nconst OPTION_INCORRECT = 1;\r\n\r\nclass QuestionValue_QuestionValue extends Question_Question {\r\n\r\n  constructor(questionText, valueQuestioned) {\r\n    super(questionText);\r\n    this._valueQuestioned = valueQuestioned;\r\n    this.options = [\r\n      Option_Option.create('Correct', Correctness.CORRECT, 'correct'),\r\n      Option_Option.create('Incorrect', Correctness.INCORRECT, 'incorrect'),\r\n      Option_Option.create('Not sure', Correctness.NOT_SURE, 'not-sure')\r\n    ];\r\n  }\r\n\r\n  get value() {\r\n    if (typeof this._valueQuestioned === 'function') {\r\n      return this._valueQuestioned();\r\n    }\r\n    return this._valueQuestioned;\r\n  }\r\n\r\n  getType() {\r\n    return QuestionTypes.VALUE;\r\n  }\r\n\r\n  addFollowUp(phase) {\r\n    this.options[OPTION_INCORRECT].addFollowUp(phase);\r\n    return this;\r\n  }\r\n\r\n  getSummary() {\r\n    return Object.assign(super.getSummary(), {\r\n      valueChecked: this.value\r\n    });\r\n  }\r\n\r\n  static create(questionText, valueQuestioned) {\r\n    return new QuestionValue_QuestionValue(questionText, valueQuestioned);\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Build/QuestionFactory.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass QuestionFactory_QuestionFactory {\r\n\r\n  create(cfg, lazyEval) {\r\n    switch (cfg.type) {\r\n      case 'QuestionFreeForm':\r\n        return this.createQuestionFreeForm(cfg);\r\n      case 'QuestionSelect':\r\n        return this.createQuestionSelect(cfg);\r\n      case 'QuestionValue':\r\n        return this.createQuestionValue(cfg, lazyEval);\r\n      default:\r\n        throw `unrecognized question type: ${cfg.type}`;\r\n    }\r\n  }\r\n\r\n  createQuestionFreeForm(cfg) {\r\n    let minResponseLength = cfg.minResponseLength || 0;\r\n    return QuestionFreeForm_QuestionFreeForm.create(cfg.ask, cfg.placeholderText, minResponseLength);\r\n  }\r\n\r\n  createQuestionSelect(cfg) {\r\n    let question = QuestionSelect_QuestionSelect.create(cfg.ask);\r\n\r\n    for (let optionCfg of cfg.options) {\r\n      question.addOption(Option_Option.create(optionCfg.answer, optionCfg.value));\r\n    }\r\n\r\n    return question;\r\n  }\r\n\r\n  createQuestionValue(cfg, lazyEval) {\r\n    let valueExamined = lazyEval(cfg.examine);\r\n    return QuestionValue_QuestionValue.create(cfg.ask, valueExamined);\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/Build/PhaseFactory.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return PhaseFactory_PhaseFactory; });\n\r\n\r\n\r\n\r\n\r\nclass PhaseFactory_PhaseFactory {\r\n\r\n  constructor(actions) {\r\n    this.actions = actions;\r\n    this.questionFactory = new QuestionFactory_QuestionFactory();\r\n  }\r\n\r\n  create(cfg, lazyEval) {\r\n    switch (cfg.type) {\r\n      case 'PhaseAttempt':\r\n        return this.createPhaseAttempt(cfg);\r\n      case 'PhaseQuestion':\r\n        return this.createPhaseQuestion(cfg, lazyEval);\r\n      case 'PhaseReport':\r\n        return this.createPhaseReport(cfg);\r\n      default:\r\n        throw Error(`unrecognized phase type ${cfg.type}`);\r\n    }\r\n  }\r\n\r\n  createPhaseAttempt(cfg) {\r\n    let action = this.actions[cfg.action];\r\n    if (typeof action === 'undefined') {\r\n      throw Error(`unrecognized action: ${cfg.action}`);\r\n    }\r\n\r\n    let phase = PhaseAttempt_PhaseAttempt.create(cfg.internalName, action.execute);\r\n\r\n    if (action.summarizeResult) {\r\n      phase.setDataSummarizer(action.summarizeResult);\r\n    }\r\n    if (cfg.instructions) {\r\n      phase.setInstructions(cfg.instructions);\r\n    }\r\n    return phase;\r\n  }\r\n\r\n  createPhaseQuestion(cfg, lazyEval) {\r\n    let phase = PhaseQuestion_PhaseQuestion.create(cfg.internalName);\r\n\r\n    if (cfg.lookAt) {\r\n      phase.lookAt(lazyEval(cfg.lookAt));\r\n    }\r\n\r\n    for (let questionCfg of cfg.questions) {\r\n      let question = this.questionFactory.create(questionCfg, lazyEval);\r\n      phase.addQuestion(question);\r\n    }\r\n\r\n    return phase;\r\n  }\r\n\r\n}\r\n\r\n\r\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// CONCATENATED MODULE: ./src/Models/Debug/DataCollector.js\nclass DataCollector {\r\n  constructor(debugProcess) {\r\n    this.process = debugProcess;\r\n    this.censoredProps = new Set(['csrf', 'birthdate']);\r\n  }\r\n\r\n  getCollectibleData() {\r\n    return this.scrub(this.buildData());\r\n  }\r\n\r\n  buildData() {\r\n    let nav = window.navigator;\r\n\r\n    return {\r\n      process: this.process.getSummarySoFar(),\r\n      contentHtml: document.getElementById('contentContainer').outerHTML,\r\n      navigator: {\r\n        appCodeName: nav.app,\r\n        appName: nav.appName,\r\n        appVersion: nav.appVersion,\r\n        platfrom: nav.platfrom,\r\n        userAgent: nav.userAgent,\r\n        languages: $.extend(true, [], nav.languages),\r\n        oscpu: nav.oscpu\r\n      },\r\n      gameData: $.extend(true, {}, window.game_data)\r\n    }\r\n  }\r\n\r\n  scrub(d) {\r\n    if (typeof d === 'object' && d !== null) {\r\n      for (let key of Object.keys(d)) {\r\n        if (this.censoredProps.has(key)) {\r\n          d[key] = 'CENSORED';\r\n        } else {\r\n          d[key] = this.scrub(d[key]);\r\n        }\r\n      }\r\n    }\r\n    if (typeof d === 'string') {\r\n      return this.censorCsrfInString(d);\r\n    }\r\n    return d;\r\n  }\r\n\r\n  censorCsrfInString(s) {\r\n    return s.replace(/((&|&amp;)h=)(\\w+)/g, '$1CENSORED')\r\n      .replace(/(\\?h=)(\\w+)(&|&amp;)/g, '$1CENSORED$3')\r\n      .replace(/(csrf_token = ')(\\w+)/g, '$1CENSORED')\r\n      .replace(/(\"csrf\":\")(\\w+)/g, '$1CENSORED');\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./conf/API.js\nlet API = {\r\n    bugReport: {\r\n        url: 'https://56hqsw3c2c.execute-api.us-east-2.amazonaws.com/prod/bugreport'\r\n    }\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Debug/BugReporter.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return BugReporter_BugReporter; });\n\r\n\r\n\r\nclass BugReporter_BugReporter {\r\n  constructor(process) {\r\n    this.process = process;\r\n  }\r\n\r\n  buildReport() {\r\n    return {\r\n      title: '[Bug report] ' + this.process.name,\r\n      dataCollected: (new DataCollector(this.process)).getCollectibleData()\r\n    }\r\n  }\r\n\r\n  async submitReport(report) {\r\n    let message = [\r\n      '|game version|world|player|twcheese|',\r\n      '|---|---|---|---|',\r\n      `|${game_data.majorVersion}|${game_data.world}|${game_data.player.name}|${window.TwCheese.version}|`,\r\n      '```' + JSON.stringify(report.dataCollected, null, 2) + '```'\r\n    ].join(\"\\n\");\r\n    return await this.createIssue(report.title, message);\r\n  }\r\n\r\n  async createIssue(title, message) {\r\n    let response = await fetch(API.bugReport.url, {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        title: title,\r\n        message: message\r\n      })\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to create issue. [${response.status}: ${response.statusText}]`);\r\n    }\r\n    return await response.json();\r\n  }\r\n\r\n}\r\n\r\n\r\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./src/Util/Object.js\nfunction getProp(object, propPath, defaultValue) {\r\n  let tokens = propPath.split('.');\r\n  for (let i = 0; i < tokens.length - 1; i++) {\r\n    let token = tokens[i];\r\n    if (typeof object[token] !== 'object' || token === null) {\r\n      return defaultValue;\r\n    }\r\n    object = object[token];\r\n  }\r\n  let value = object[tokens[tokens.length - 1]];\r\n  return (typeof value === 'undefined') ? defaultValue : value;\r\n}\r\n\r\n\r\nfunction setProp(object, propPath, value) {\r\n  let tokens = propPath.split('.');\r\n  for (let i = 0; i < tokens.length - 1; i++) {\r\n    let token = tokens[i];\r\n    if (typeof object[token] !== 'object' || token === null) {\r\n      object[token] = {};\r\n    }\r\n    object = object[token];\r\n  }\r\n  object[tokens[tokens.length - 1]] = value;\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/TextScraper.js\n\r\n\r\nvar language = {\"buildings\": {}, \"report\": {}, \"twcheese\": {}};\r\nswitch (game_data.market) {\r\n  default:\r\n    /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n    language['buildings']['main'] = 'Headquarters';\r\n    language['buildings']['barracks'] = 'Barracks';\r\n    language['buildings']['stable'] = 'Stable';\r\n    language['buildings']['garage'] = 'Workshop';\r\n    language['buildings']['church'] = 'Church';\r\n    language['buildings']['church_f'] = 'First church';\r\n    language['buildings']['snob'] = 'Academy';\r\n    language['buildings']['smith'] = 'Smithy';\r\n    language['buildings']['place'] = 'Rally point';\r\n    language['buildings']['statue'] = 'Statue';\r\n    language['buildings']['market'] = 'Market';\r\n    language['buildings']['wood'] = 'Timber camp';\r\n    language['buildings']['stone'] = 'Clay pit';\r\n    language['buildings']['iron'] = 'Iron mine';\r\n    language['buildings']['farm'] = 'Farm';\r\n    language['buildings']['storage'] = 'Warehouse';\r\n    language['buildings']['hide'] = 'Hiding place';\r\n    language['buildings']['wall'] = 'Wall';\r\n    language['buildings']['watchtower'] = 'Watchtower';\r\n\r\n    language['report']['catDamage'] = 'Damage by catapults:';\r\n    language['report']['ramDamage'] = 'Damage by rams:';\r\n    language['report']['haul'] = 'Haul:';\r\n    language['report']['loyalty'] = 'Loyalty:';\r\n    language['report']['unitsInTransit'] = 'Defender\\'s troops, that were in transit';\r\n    language['report']['deletedPlayer'] = '(deleted)';\r\n    language['report']['unread'] = '(new)';\r\n    break;\r\n\r\n  case 'cz':\r\n    /*==== divokekmeny.cz/ ====*/\r\n    language['buildings']['main'] = 'Hlavní budova';\r\n    language['buildings']['barracks'] = 'Kasárna';\r\n    language['buildings']['stable'] = 'Stáj';\r\n    language['buildings']['garage'] = 'Dílna';\r\n    language['buildings']['church'] = 'Kostel';\r\n    language['buildings']['church_f'] = 'První kostel';\r\n    language['buildings']['snob'] = 'Panský dvůr';\r\n    language['buildings']['smith'] = 'Kovárna';\r\n    language['buildings']['place'] = 'Nádvoří';\r\n    language['buildings']['statue'] = 'Socha';\r\n    language['buildings']['market'] = 'Tržiště';\r\n    language['buildings']['wood'] = 'Dřevorubec';\r\n    language['buildings']['stone'] = 'Lom na těžbu hlíny';\r\n    language['buildings']['iron'] = 'Železný důl';\r\n    language['buildings']['farm'] = 'Selský dvůr';\r\n    language['buildings']['storage'] = 'Skladiště';\r\n    language['buildings']['hide'] = 'Skrýš';\r\n    language['buildings']['wall'] = 'Hradby';\r\n    language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n    language['report']['catDamage'] = 'Škoda vzniklá střelbou z katapultu:';\r\n    language['report']['ramDamage'] = 'Škoda vzniklá beranidlem:';\r\n    language['report']['haul'] = 'Kořist:';\r\n    language['report']['loyalty'] = 'Oddanost:';\r\n    language['report']['unitsInTransit'] = 'Vojsko obránce, které bylo na cestě';\r\n    language['report']['deletedPlayer'] = '(deleted)'; //todo: translate\r\n    language['report']['unread'] = '(new)'; //todo: translate\r\n    break;\r\n\r\n  case 'se':\r\n    language['buildings']['main'] = 'Högkvarter';\r\n    language['buildings']['barracks'] = 'Barack';\r\n    language['buildings']['stable'] = 'Stall';\r\n    language['buildings']['garage'] = 'Verkstad';\r\n    language['buildings']['church'] = 'Kyrka';\r\n    language['buildings']['church_f'] = 'Första Kyrkan';\r\n    language['buildings']['snob'] = 'Akademi';\r\n    language['buildings']['smith'] = 'Smedja';\r\n    language['buildings']['place'] = 'Samlingsplats';\r\n    language['buildings']['statue'] = 'Staty';\r\n    language['buildings']['market'] = 'Marknad';\r\n    language['buildings']['wood'] = 'Sågverk';\r\n    language['buildings']['stone'] = 'Lergrop';\r\n    language['buildings']['iron'] = 'Järngruva';\r\n    language['buildings']['farm'] = 'Farm';\r\n    language['buildings']['storage'] = 'Förråd';\r\n    language['buildings']['hide'] = 'Gömställe';\r\n    language['buildings']['wall'] = 'Mur';\r\n    language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n    language['report']['catDamage'] = 'Skada gjord av katapulter:';\r\n    language['report']['ramDamage'] = 'Skada gjorda av Murbräckan:';\r\n    language['report']['haul'] = 'Byte:';\r\n    language['report']['loyalty'] = 'Lojalitet:';\r\n    language['report']['unitsInTransit'] = 'Enheter utanför byn';\r\n    language['report']['deletedPlayer'] = '(borttaget)';\r\n    language['report']['unread'] = '(new)'; //todo: translate\r\n    break;\r\n\r\n  /*==== fyletikesmaxes.gr/ ====*/\r\n  case 'gr':\r\n    language['buildings']['main'] = 'Επιτελείο';\r\n    language['buildings']['barracks'] = 'Στρατώνας';\r\n    language['buildings']['stable'] = 'Στάβλος';\r\n    language['buildings']['garage'] = 'Εργαστήριο';\r\n    language['buildings']['church'] = 'Εκκλησία';\r\n    language['buildings']['church_f'] = 'ΠρώτηΕκκλησία';\r\n    language['buildings']['snob'] = 'Ακαδημία';\r\n    language['buildings']['smith'] = 'Οπλοποιείο';\r\n    language['buildings']['place'] = 'ΜέροςΣυγκέντρωσης';\r\n    language['buildings']['statue'] = 'Άγαλμα';\r\n    language['buildings']['market'] = 'Αγορά';\r\n    language['buildings']['wood'] = 'Ξυλουργείο';\r\n    language['buildings']['stone'] = 'Λατομείο';\r\n    language['buildings']['iron'] = 'Σιδηρωρυχείο';\r\n    language['buildings']['farm'] = 'Αγρόκτημα';\r\n    language['buildings']['storage'] = 'Αποθήκη';\r\n    language['buildings']['hide'] = 'Κρυψώνα';\r\n    language['buildings']['wall'] = 'Τείχος';\r\n    language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n    language['report']['catDamage'] = 'Ζημία που έκαναν οι καταπέλτες:';\r\n    language['report']['ramDamage'] = 'Ζημιά που προκλήθηκε από τον πολιορκητικό κριό:';\r\n    language['report']['haul'] = 'Αλλαγή:';\r\n    language['report']['loyalty'] = 'Πίστη:';\r\n    language['report']['unitsInTransit'] = 'Στρατεύματα αμυνόμενου που ήταν σε μεταφορά';\r\n    language['report']['deletedPlayer'] = '(διεγραμμένο)';\r\n    language['report']['unread'] = '(νέο)';\r\n    break;\r\n\r\n  /* the market where Arma plays :D */\r\n  case 'hr':\r\n    language['buildings']['main'] = 'Sjedište';\r\n    language['buildings']['barracks'] = 'Vojarna';\r\n    language['buildings']['stable'] = 'Štala';\r\n    language['buildings']['garage'] = 'Radionica';\r\n    language['buildings']['church'] = 'Crkva';\r\n    language['buildings']['church_f'] = 'Prva crkva';\r\n    language['buildings']['snob'] = 'Akademija';\r\n    language['buildings']['smith'] = 'Kovačnica';\r\n    language['buildings']['place'] = 'Okupljalište';\r\n    language['buildings']['statue'] = 'Spomenik';\r\n    language['buildings']['market'] = 'Tržnica';\r\n    language['buildings']['wood'] = 'Drvosječa';\r\n    language['buildings']['stone'] = 'Glinokop';\r\n    language['buildings']['iron'] = 'Rudnik željeza';\r\n    language['buildings']['farm'] = 'Farma';\r\n    language['buildings']['storage'] = 'Spremište';\r\n    language['buildings']['hide'] = 'Skrovište';\r\n    language['buildings']['wall'] = 'Zid';\r\n    language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n    language['report']['catDamage'] = 'Šteta nanešena katapultima:\t';\r\n    language['report']['ramDamage'] = 'Šteta nanešena ovnovima:';\r\n    language['report']['haul'] = 'Nosivost:';\r\n    language['report']['loyalty'] = 'Odanost:';\r\n    language['report']['unitsInTransit'] = 'Obrambene postrojbe koje su bile na putu';\r\n    language['report']['deletedPlayer'] = '(obrisano)';\r\n    break;\r\n\r\n  /* Norwegian */\r\n  case 'no':\r\n    language['buildings']['main'] = 'Hovedkvarter';\r\n    language['buildings']['barracks'] = 'Brakker';\r\n    language['buildings']['stable'] = 'Stall';\r\n    language['buildings']['garage'] = 'Verksted';\r\n    language['buildings']['church'] = 'Kirke';\r\n    language['buildings']['church_f'] = 'Første Kirke';\r\n    language['buildings']['snob'] = 'Akademi';\r\n    language['buildings']['smith'] = 'Smie';\r\n    language['buildings']['place'] = 'Samlingsplass';\r\n    language['buildings']['statue'] = 'Statue';\r\n    language['buildings']['market'] = 'Marked';\r\n    language['buildings']['wood'] = 'Hogstfelt';\r\n    language['buildings']['stone'] = 'Leirgrav';\r\n    language['buildings']['iron'] = 'Jerngruve';\r\n    language['buildings']['farm'] = 'Gård';\r\n    language['buildings']['storage'] = 'Varehus';\r\n    language['buildings']['hide'] = 'Skjulested';\r\n    language['buildings']['wall'] = 'Mur';\r\n    language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n    language['report']['catDamage'] = 'Skade forårsaket av katapulter:';\r\n    language['report']['ramDamage'] = 'Skade forårsaket av rambukker:';\r\n    language['report']['haul'] = 'Bytte';\r\n    language['report']['loyalty'] = 'Lojalitet:';\r\n    language['report']['unitsInTransit'] = 'Forsvarer';\r\n    language['report']['unitsInTransit'] = 'Antall';\r\n    language['report']['deletedPlayer'] = '(slettet)';\r\n    language['report']['unread'] = '(ny)';\r\n    break;\r\n\r\n  // Portugal\r\n  case 'pt':\r\n    language['buildings']['main'] = 'Edifício Principal';\r\n    language['buildings']['barracks'] = 'Quartel';\r\n    language['buildings']['stable'] = 'Estábulo';\r\n    language['buildings']['garage'] = 'Oficina';\r\n    language['buildings']['church'] = 'Igreja';\r\n    language['buildings']['church_f'] = 'Primeira Igreja';\r\n    language['buildings']['snob'] = 'Academia';\r\n    language['buildings']['smith'] = 'Ferreiro';\r\n    language['buildings']['place'] = 'Praça de Reuniões';\r\n    language['buildings']['statue'] = 'Estátua';\r\n    language['buildings']['market'] = 'Mercado';\r\n    language['buildings']['wood'] = 'Bosque';\r\n    language['buildings']['stone'] = 'Poço de Argila';\r\n    language['buildings']['iron'] = 'Mina de Ferro';\r\n    language['buildings']['farm'] = 'Fazenda';\r\n    language['buildings']['storage'] = 'Armazém';\r\n    language['buildings']['hide'] = 'Esconderijo';\r\n    language['buildings']['wall'] = 'Muralha';\r\n    language['buildings']['watchtower'] = 'Watchtower'; // todo: translate\r\n\r\n    language['report']['catDamage'] = 'Dano provocado por catapultas:';\r\n    language['report']['ramDamage'] = 'Dano provocado por aríetes:';\r\n    language['report']['haul'] = 'Busca minuciosa:';\r\n    language['report']['loyalty'] = 'Lealdade:';\r\n    language['report']['unitsInTransit'] = 'Unidades fora da aldeia';\r\n    language['report']['deletedPlayer'] = '(eliminado)';\r\n    language['report']['unread'] = '(novo)';\r\n    break;\r\n\r\n}\r\n\r\nfunction escapeSingleQuotes(str) {\r\n  return str.replace(/'/g, \"\\\\'\");\r\n}\r\n\r\nclass TextScraper_TextScraper {\r\n  constructor(gameTexts) {\r\n    this.gameTexts = gameTexts;\r\n  }\r\n\r\n  t(textId) {\r\n    return getProp(this.gameTexts, textId);\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLElement|jQuery|string} haystack\r\n   * @param {string} textId\r\n   * @return {boolean}\r\n   */\r\n  includes(haystack, textId) {\r\n    let needle = this.t(textId);\r\n    if (typeof haystack === 'string') {\r\n      return haystack.includes(needle);\r\n    }\r\n    return $(haystack).html().includes(needle);\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLElement[] | jQuery} elements\r\n   * @param {string} textId\r\n   * @return {HTMLElement|undefined}\r\n   */\r\n  first(elements, textId) {\r\n    let searchFor = this.t(textId);\r\n    return $(elements).filter(`:contains('${escapeSingleQuotes(searchFor)}')`)[0];\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLElment|jQuery} el\r\n   * @return {string}\r\n   */\r\n  buildingType(el) {\r\n    let text = $(el).text();\r\n    for (let [buildingType, buildingName] of Object.entries(this.gameTexts.buildings)) {\r\n      if (text.includes(buildingName)) {\r\n        return buildingType;\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\n\r\nlet textScraper = new TextScraper_TextScraper(language);\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./conf/ImageSrc.js\nlet game = window.image_base;\r\nlet ImageSrc_self = window.TwCheese.ROOT + '/assets/images/';\r\n\r\nlet ImageSrc = {\r\n    plus: game + 'plus.png',\r\n    minus: game + 'minus.png',\r\n    wood: game + 'holz.png',\r\n    stone: game + 'lehm.png',\r\n    iron: game + 'eisen.png',\r\n    attack: game + 'command/attack.png',\r\n    haulPartial: game + 'max_loot/0.png',\r\n    haulFull: game + 'max_loot/1.png',\r\n    info: game + 'questionmark.png',\r\n    attackSentViaFa: game + 'command/farm.png',\r\n    attackSizeSmall: game + 'command/attack_small.png',\r\n    attackSizeMedium: game + 'command/attack_medium.png',\r\n    attackSizeLarge: game + 'command/attack_large.png',\r\n    attackContainsSnob: game + 'command/snob.png',\r\n    attackContainsSpy: game + 'command/spy.png',\r\n    attackContainsKnight: game + 'command/knight.png',\r\n    popupBackground: game + 'popup/content_background.png',\r\n    popupBorder: game + 'popup/border.png',\r\n    servant: game + 'paladin_new.png',\r\n    loadingSpinner: game + 'throbber.gif',\r\n    calendar: ImageSrc_self + 'calendar.png',\r\n    sidebarMain: ImageSrc_self + 'sidebar/gear.png',\r\n    sidebarBug: ImageSrc_self + 'sidebar/bug.png',\r\n    sidebarGithub: ImageSrc_self + 'sidebar/github.png',\r\n    jq: {\r\n        blue: ImageSrc_self + 'jquery/ui-icons_2e83ff_256x240.png',\r\n        black: ImageSrc_self + 'jquery/ui-icons_222222_256x240.png',\r\n        darkGrey: ImageSrc_self + 'jquery/ui-icons_454545_256x240.png',\r\n        grey: ImageSrc_self + 'jquery/ui-icons_888888_256x240.png',\r\n        red: ImageSrc_self + 'jquery/ui-icons_cd0a0a_256x240.png'\r\n    },\r\n    legacy: {\r\n        helpBackground: ImageSrc_self + 'legacy/help_background.png',\r\n        helpBackgroundBright: ImageSrc_self + 'legacy/help_background_highlight.png'\r\n    },    \r\n    buildingIcon: buildingType => game + `buildings/${buildingType}.png`,\r\n    troopIcon: troopType => game + `unit/unit_${troopType}.png`,\r\n    dotIcon: color => game + `dots/${color}.png`,\r\n    scavengeOption: optionId => game + `scavenging/options/${optionId}.png`,\r\n};\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/BattleReportCondensed.js\n\r\n\r\n\r\nclass BattleReportCondensed_BattleReportCondensed {\r\n  constructor() {\r\n    this.subject = null; // string\r\n    this.attackIcons = null; // AttackIcons\r\n    this.attackerName = null; // string\r\n    this.attackerNobleDied = false; // boolean\r\n    this.attackerVillage = null; // Village\r\n    this.buildingLevels = null; // BuildingLevels\r\n    this.defenderName = null; // string\r\n    this.defenderVillage = null; // Village\r\n    this.defenderSurvivors = null; // TroopCounts\r\n    this.dotColor = null; // string\r\n    this.haulStatus = BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN;\r\n    this.isForwarded = false; // string\r\n    this.loyalty = null; // {after:number}\r\n    this.note = null; // string\r\n    this.reportId = null; // int\r\n    this.resources = null; // Resources\r\n    this.strTimeReceived = null; // string\r\n    this.timeLaunched = null; // TwCheeseDate\r\n    this.wasAttackFeint = false; // boolean\r\n  }\r\n\r\n  /**\r\n   * were the defender's troops all killed?\r\n   * @return {boolean}\r\n   */\r\n  wasDefenderCleared() {\r\n    return this.defenderSurvivors && this.defenderSurvivors.isZero();\r\n  }\r\n\r\n  haulStatusIconSrc() {\r\n    if (this.haulStatus === BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN) {\r\n      throw Error(`There's no icon.... that's why the status is unknown!`);\r\n    }\r\n    if (this.haulStatus === BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_FULL) {\r\n      return ImageSrc.haulFull;\r\n    }\r\n    return ImageSrc.haulPartial;\r\n  }\r\n\r\n  /**\r\n   * @param {{x:number, y:number}} village\r\n   * @return number\r\n   */\r\n  defenderDistance(village) {\r\n    if (!this.defenderVillage) {\r\n      return '?';\r\n    }\r\n    return Math.round(this.defenderVillage.distanceTo(village) * 100) / 100;\r\n  }\r\n\r\n}\r\n\r\nBattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN = -1;\r\nBattleReportCondensed_BattleReportCondensed.HAUL_STATUS_PARTIAL = 0;\r\nBattleReportCondensed_BattleReportCondensed.HAUL_STATUS_FULL = 1;\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Village.js\nclass Village {\r\n  constructor(id, x, y) {\r\n    this.id = parseInt(id);\r\n    this.x = parseInt(x);\r\n    this.y = parseInt(y);\r\n  }\r\n\r\n  /**\r\n   * @param {Village} otherVillage\r\n   */\r\n  distanceTo(otherVillage) {\r\n    let diffX = this.x - otherVillage.x;\r\n    let diffY = this.y - otherVillage.y;\r\n    return Math.hypot(diffX, diffY);\r\n  }\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Resource.js\n\r\n\r\nclass Resource_Resource {\r\n  constructor(type, amount) {\r\n    this.type = type;\r\n    this.amount = amount;\r\n  }\r\n\r\n  valueOf() {\r\n    return this.amount;\r\n  }\r\n\r\n  toString() {\r\n    return this.amount;\r\n  }\r\n\r\n  toDebugString() {\r\n    return this.amount;\r\n  }\r\n\r\n  imageSrc() {\r\n    return ImageSrc[this.type];\r\n  }\r\n\r\n}\r\n\r\nResource_Resource.TYPE_TIMBER = 'wood';\r\nResource_Resource.TYPE_CLAY = 'stone';\r\nResource_Resource.TYPE_IRON = 'iron';\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Resources.js\n\r\n\r\nclass Resources_Resources {\r\n  constructor(woodAmount = 0, stoneAmount = 0, ironAmount = 0) {\r\n    this.wood = new Resource_Resource(Resource_Resource.TYPE_TIMBER, woodAmount);\r\n    this.stone = new Resource_Resource(Resource_Resource.TYPE_CLAY, stoneAmount);\r\n    this.iron = new Resource_Resource(Resource_Resource.TYPE_IRON, ironAmount);\r\n  }\r\n\r\n  sum() {\r\n    return this.wood + this.stone + this.iron;\r\n  }\r\n\r\n  add(other) {\r\n    return new Resources_Resources(\r\n      this.wood + other.wood,\r\n      this.stone + other.stone,\r\n      this.iron + other.iron\r\n    );\r\n  }\r\n\r\n  multiply(factor) {\r\n    return new Resources_Resources(\r\n      this.wood * factor,\r\n      this.stone * factor,\r\n      this.iron * factor\r\n    );\r\n  }\r\n\r\n  cap(maxAmount) {\r\n    return new Resources_Resources(\r\n      Math.min(this.wood, maxAmount),\r\n      Math.min(this.stone, maxAmount),\r\n      Math.min(this.iron, maxAmount)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @param {Objecet} other\r\n   */\r\n  equals(other) {\r\n    return this.wood.valueOf() === other.wood.valueOf()\r\n      && this.stone.valueOf() === other.stone.valueOf()\r\n      && this.iron.valueOf() === other.iron.valueOf();\r\n  }\r\n\r\n  toArray() {\r\n    return [this.wood.amount, this.stone.amount, this.iron.amount];\r\n  }\r\n\r\n}\r\n\r\nResources_Resources.TYPES = [Resource_Resource.TYPE_TIMBER, Resource_Resource.TYPE_CLAY, Resource_Resource.TYPE_IRON];\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Config.js\n\r\n\r\n\r\nclass Config_Config {\r\n  constructor(id) {\r\n    this.id = id;\r\n    this.props = {};\r\n    this._loadCachedData();\r\n  }\r\n\r\n  get(prop, defaultValue) {\r\n    return getProp(this.props, prop, defaultValue);\r\n  }\r\n\r\n  set(prop, value) {\r\n    setProp(this.props, prop, value);\r\n    this._save();\r\n  }\r\n\r\n  initProps(props) {\r\n    this.props = props;\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @return {object|null}\r\n   */\r\n  _loadCachedData() {\r\n    let saved = window.localStorage.getItem(this.id);\r\n    if (saved) {\r\n      let data = JSON.parse(saved);\r\n\r\n      // should ideally be data.props\r\n      // But for backwards compatibility, the data could be the props too.\r\n      this.props = data.props || data;\r\n      return data;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * @final\r\n   * @protected\r\n   */\r\n  _save() {\r\n    this._beforeSave();\r\n    window.localStorage.setItem(this.id, JSON.stringify(this._getCacheableData()));\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   */\r\n  _beforeSave() {\r\n\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @return {object}\r\n   */\r\n  _getCacheableData() {\r\n    return {\r\n      props: this.props\r\n    };\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RateLimiter.js\nclass RateLimiter {\r\n  constructor(maxBurstsPerSecond) {\r\n    this.maxBurstsPerSecond = maxBurstsPerSecond;\r\n    this.recentRequests = new Array(maxBurstsPerSecond);\r\n  }\r\n\r\n  requestWasMade() {\r\n    this.recentRequests.unshift(performance.now());\r\n    this.recentRequests.pop();\r\n  }\r\n\r\n  async sleepIfNeeded() {\r\n    let anchorTimestamp = this.recentRequests[this.maxBurstsPerSecond - 1];\r\n    if (typeof anchorTimestamp === 'undefined') {\r\n      return;\r\n    }\r\n    let delayMs = anchorTimestamp + 1000 - performance.now();\r\n    if (delayMs <= 0) {\r\n      return;\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n      setTimeout(resolve, delayMs);\r\n    });\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Util/Network.js\n\r\n\r\nlet throttle = new RateLimiter(5);\r\n\r\nlet originalFetch = window.fetch;\r\nwindow.fetch = function () {\r\n  throttle.requestWasMade();\r\n  return originalFetch.apply(this, arguments);\r\n};\r\n\r\n\r\n/**\r\n * requests the document from a url\r\n * @param {string} url the url of the page to get the document from\r\n * @return {Promise}\r\n * @resolve {HTMLDocment}\r\n */\r\nasync function requestDocument(url) {\r\n  await throttle.sleepIfNeeded();\r\n  let response = await fetch(url);\r\n  let responseText = await response.text();\r\n  let doc = (new DOMParser()).parseFromString(responseText, 'text/html');\r\n\r\n  Object.defineProperty(doc, 'URL', {\r\n    get: () => url\r\n  });\r\n\r\n  return doc;\r\n};\r\n\r\n\r\n/**\r\n * requests xml document from a url\r\n * @param {string} url the url of the page to get the cml document from\r\n * @return {Promise}\r\n * @resolve {XMLDocument}\r\n */\r\nasync function requestXml(url) {\r\n  await throttle.sleepIfNeeded();\r\n  let response = await fetch(url);\r\n  let responseText = await response.text();\r\n  let xmlDoc = (new DOMParser()).parseFromString(responseText, 'text/xml');\r\n\r\n  Object.defineProperty(xmlDoc, 'URL', {\r\n    get: () => url\r\n  });\r\n\r\n  return xmlDoc;\r\n};\r\n\r\n\r\n/**\r\n * make a POST request to the game\r\n * @param {string} screen\r\n * @param {object} uriParams\r\n * @param {object} data\r\n * @return {Promise}\r\n * @resolve {object} response data from the game\r\n */\r\nasync function postToGame(screen, uriParams, data) {\r\n  await throttle.sleepIfNeeded();\r\n  return new Promise(function (resolve, reject) {\r\n    window.TribalWars.post(screen, uriParams, data, resolve, reject);\r\n  });\r\n}\r\n\r\n\r\nfunction gameUrl(screen, uriParams, method = 'GET') {\r\n  return 'https://' + document.domain + window.TribalWars.buildURL(method, screen, uriParams);\r\n}\r\n\r\n\r\nfunction attackPrepUrl(unitCounts, targetVillageId, originVillageId = window.game_data.village.id) {\r\n  let uriParams = {\r\n    from: 'reports',\r\n    village: originVillageId,\r\n    target: targetVillageId\r\n  };\r\n  for (let [unitType, count] of Object.entries(unitCounts)) {\r\n    uriParams[unitType] = count;\r\n  }\r\n  return gameUrl('place', uriParams);\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RemoteConfig.js\n\r\n\r\n\r\n\r\nfunction parseXmlNode(node) {\r\n  if (node.children.length === 0) {\r\n    return parseFloat(node.innerHTML) || null;\r\n  }\r\n  let object = {};\r\n  for (let childNode of node.children) {\r\n    object[childNode.tagName] = parseXmlNode(childNode);\r\n  }\r\n  return object;\r\n}\r\n\r\n\r\nclass RemoteConfig_RemoteConfig extends Config_Config {\r\n\r\n  /**\r\n   * @param {string} url\r\n   */\r\n  setUrl(url) {\r\n    this.url = url;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * @param {number} seconds\r\n   */\r\n  setTtl(seconds) {\r\n    this.ttl = seconds * 1000;\r\n    return this;\r\n  }\r\n\r\n  async ensureUpdated() {\r\n    if (this.needsUpdate()) {\r\n      await this.update();\r\n    }\r\n  }\r\n\r\n  needsUpdate() {\r\n    let now = new Date().getTime();\r\n    let ttl = this.ttl || 86400;\r\n    return !this.timeUpdated || ttl < now - this.timeUpdated;\r\n  }\r\n\r\n  async update() {\r\n    let xmlDoc = await requestXml(this.url);\r\n    this._processXml(xmlDoc);\r\n    this._save();\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @param {XMLDocument} xmlDoc\r\n   */\r\n  _processXml(xmlDoc) {\r\n    this.props = parseXmlNode(xmlDoc).config;\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @return {object|null}\r\n   */\r\n  _loadCachedData() {\r\n    let data = super._loadCachedData();\r\n    if (data) {\r\n      this.timeUpdated = data.timeUpdated;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   */\r\n  _beforeSave() {\r\n    this.timeUpdated = new Date().getTime();\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @return {object}\r\n   */\r\n  _getCacheableData() {\r\n    return Object.assign({}, super._getCacheableData(), {\r\n      timeUpdated: this.timeUpdated\r\n    });\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Util/Config.js\n\r\n\r\n\r\nlet userConfig = new Config_Config('twcheese.userConfig');\r\n\r\nlet gameConfig = (new RemoteConfig_RemoteConfig('twcheese.gameConfig'))\r\n  .setUrl(`https://${document.domain}/interface.php?func=get_config`)\r\n  .setTtl(8 * 3600);\r\n\r\nlet buildingConfig = (new RemoteConfig_RemoteConfig('twcheese.buildingConfig'))\r\n  .setUrl(`https://${document.domain}/interface.php?func=get_building_info`)\r\n  .setTtl(8 * 3600);\r\n\r\nlet troopConfig = (new RemoteConfig_RemoteConfig('twcheese.troopConfig'))\r\n  .setUrl(`https://${document.domain}/interface.php?func=get_unit_info`)\r\n  .setTtl(8 * 3600);\r\n\r\n\r\nasync function ensureRemoteConfigsUpdated() {\r\n  await Promise.all([\r\n    gameConfig.ensureUpdated(),\r\n    troopConfig.ensureUpdated(),\r\n    buildingConfig.ensureUpdated()\r\n  ]);\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./conf/Buildings.js\nlet cfg = {\r\n    main: {\r\n        maxLevel: 30,\r\n        minLevel: 1,\r\n        pop: 5,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    barracks: {\r\n        maxLevel: 25,\r\n        minLevel: 0,\r\n        pop: 7,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 3\r\n        }\r\n    },\r\n    stable: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 8,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 10,\r\n            barracks: 5,\r\n            smith: 5\r\n        }\r\n    },\r\n    garage: {\r\n        maxLevel: 15,\r\n        minLevel: 0,\r\n        pop: 8,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 10,\r\n            smith: 10\r\n        }\r\n    },\r\n    church: {\r\n        maxLevel: 3,\r\n        minLevel: 0,\r\n        pop: 5000,\r\n        popFactor: 1.55,\r\n        req: {\r\n            main: 5,\r\n            farm: 5\r\n        }\r\n    },\r\n    church_f: {\r\n        maxLevel: 1,\r\n        minLevel: 0,\r\n        pop: 5,\r\n        popFactor: 1.55,\r\n        req: {}\r\n    },\r\n    snob: {\r\n        maxLevel: 3,\r\n        minLevel: 0,\r\n        pop: 80,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 20,\r\n            smith: 20,\r\n            market: 10\r\n        }\r\n    },\r\n    smith: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 20,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 5,\r\n            barracks: 1\r\n        }\r\n    },\r\n    place: {\r\n        maxLevel: 1,\r\n        minLevel: 0,\r\n        pop: 0,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    statue: {\r\n        maxLevel: 1,\r\n        minLevel: 0,\r\n        pop: 10,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    market: {\r\n        maxLevel: 25,\r\n        minLevel: 0,\r\n        pop: 20,\r\n        popFactor: 1.17,\r\n        req: {\r\n            main: 3,\r\n            storage: 2\r\n        }\r\n    },\r\n    wood: {\r\n        maxLevel: 30,\r\n        minLevel: 0,\r\n        pop: 5,\r\n        popFactor: 1.155,\r\n        req: {}\r\n    },\r\n    stone: {\r\n        maxLevel: 30,\r\n        minLevel: 0,\r\n        pop: 10,\r\n        popFactor: 1.14,\r\n        req: {}\r\n    },\r\n    iron: {\r\n        maxLevel: 30,\r\n        minLevel: 0,\r\n        pop: 10,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    farm: {\r\n        maxLevel: 30,\r\n        minLevel: 1,\r\n        pop: 0,\r\n        popFactor: 1,\r\n        req: {}\r\n    },\r\n    storage: {\r\n        maxLevel: 30,\r\n        minLevel: 1,\r\n        pop: 0,\r\n        popFactor: 1.15,\r\n        req: {}\r\n    },\r\n    hide: {\r\n        maxLevel: 10,\r\n        minLevel: 0,\r\n        pop: 2,\r\n        popFactor: 1.17,\r\n        req: {}\r\n    },\r\n    wall: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 5,\r\n        popFactor: 1.17,\r\n        req: {\r\n            barracks: 1\r\n        }\r\n    },\r\n    watchtower: {\r\n        maxLevel: 20,\r\n        minLevel: 0,\r\n        pop: 500,\r\n        popFactor: 1.18,\r\n        req: {\r\n            main: 5,\r\n            farm: 5\r\n        }\r\n    }    \r\n};\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Buildings.js\n\r\n\r\n// todo: request devs make additional info available via interface.php, so this won't be necessary\r\n\r\n\r\n/**\r\n * Building    Index\r\n * hq:      0\r\n * barracks:  1\r\n * stable:    2\r\n * workshop:  3\r\n * church:    4\r\n * church_f:  5\r\n * academy:    6\r\n * smithy:    7\r\n * rally:    8\r\n * statue:    9\r\n * market:    10\r\n * timber:    11\r\n * clay:    12\r\n * iron:    13\r\n * farm:    14\r\n * warehouse:  15\r\n * hiding:    16\r\n * wall:    17\r\n */\r\nlet buildingTypes = [\r\n  'main',\r\n  'barracks',\r\n  'stable',\r\n  'garage',\r\n  'church',\r\n  'church_f',\r\n  'snob',\r\n  'smith',\r\n  'place',\r\n  'statue',\r\n  'market',\r\n  'wood',\r\n  'stone',\r\n  'iron',\r\n  'farm',\r\n  'storage',\r\n  'hide',\r\n  'wall',\r\n  'watchtower'\r\n];\r\n\r\nfunction maxLevel(buildingType) {\r\n  let building = buildingConfig.get(buildingType);\r\n  if (typeof building === 'undefined') {\r\n    return 0;\r\n  }\r\n  return building.max_level;\r\n}\r\n\r\n\r\nfunction resProductionHourly(level) {\r\n  if (level === 0) {\r\n    return gameConfig.get('speed') * 5;\r\n  }\r\n  return gameConfig.get('speed') * 30 * (1.163118 ** (level - 1));\r\n}\r\n\r\n\r\nfunction popUsed(buildingType, level) {\r\n  let building = buildingConfig.get(buildingType);\r\n  if (typeof building === 'undefined') {\r\n    return 0;\r\n  }\r\n  return Math.round(building.pop * building.pop_factor ** (level - 1));\r\n}\r\n\r\n\r\nfunction requiredBuildingLevels(buildingType) {\r\n  // The config from interface.php is missing building requirements.\r\n  // So use own config.\r\n  let building = cfg[buildingType];\r\n  if (typeof building === 'undefined') {\r\n    return [];\r\n  }\r\n  return building.req;\r\n}\r\n\r\n\r\nclass Buildings_BuildingLevels {\r\n  constructor(fill = 0) {\r\n    for (let type of buildingTypes) {\r\n      this[type] = fill;\r\n    }\r\n  }\r\n\r\n  populationUsed() {\r\n    let pop = 0;\r\n    for (let buildingType of buildingTypes) {\r\n      let level = this[buildingType];\r\n      pop += popUsed(buildingType, level);\r\n    }\r\n    return pop;\r\n  }\r\n\r\n  populationCap() {\r\n    return Math.round(240 * 1.172103 ** (this.farm - 1));\r\n  }\r\n\r\n  resourceCap() {\r\n    return Math.round(1000 * 1.2294934 ** (this.storage - 1));\r\n  }\r\n\r\n  resourceProductionHourly() {\r\n    return new Resources_Resources(\r\n      resProductionHourly(this.wood),\r\n      resProductionHourly(this.stone),\r\n      resProductionHourly(this.iron)\r\n    );\r\n  }\r\n\r\n  hideableResources() {\r\n    if (this.hide === 0) {\r\n      return 0;\r\n    }\r\n    return Math.round(112.4859 * 1.3335 ** this.hide);\r\n  }\r\n\r\n  canUpgrade(buildingType) {\r\n    let alreadyMaxed = this[buildingType] >= maxLevel(buildingType);\r\n    return !alreadyMaxed && this.areRequirementsMet(buildingType);\r\n  }\r\n\r\n  areRequirementsMet(buildingType) {\r\n    let reqs = requiredBuildingLevels(buildingType);\r\n    for (let [reqType, reqLevel] of Object.entries(reqs)) {\r\n      if (reqLevel > this[reqType]) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  toArray() {\r\n    return buildingTypes.map(type => this[type]);\r\n  }\r\n\r\n  static fromArray(array) {\r\n    let levels = new Buildings_BuildingLevels();\r\n    array.forEach((level, i) => {\r\n      levels[buildingTypes[i]] = level;\r\n    });\r\n    return levels;\r\n  }\r\n\r\n  static typeAt(index) {\r\n    return buildingTypes[index];\r\n  }\r\n}\r\n\r\n\r\nlet buildingUtil = {\r\n  buildingTypesOnWorld() {\r\n    return buildingTypes.filter(type => this.typeExistsOnWorld(type));\r\n  },\r\n\r\n  typeExistsOnWorld(buildingType) {\r\n    return typeof buildingConfig.get(buildingType) !== 'undefined';\r\n  },\r\n};\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Troops.js\n\r\n\r\nlet Troops_troopTypes = ['spear', 'sword', 'axe', 'archer', 'spy', 'light', 'marcher', 'heavy', 'ram', 'catapult', 'knight', 'snob', 'militia'];\r\n\r\n\r\nfunction troopPop(troopType) {\r\n  let troop = troopConfig.get(troopType);\r\n  if (typeof troop === 'undefined') {\r\n    return 0;\r\n  }\r\n  return troop.pop;\r\n}\r\n\r\n\r\nfunction travelMinutes(troopType) {\r\n  let troop = troopConfig.get(troopType);\r\n  if (typeof troop === 'undefined') {\r\n    return 0;\r\n  }\r\n  return troop.speed;\r\n}\r\n\r\n\r\nfunction troopCarry(troopType) {\r\n  let troop = troopConfig.get(troopType);\r\n  if (typeof troop === 'undefined') {\r\n    return 0;\r\n  }\r\n  return troop.carry;\r\n}\r\n\r\n\r\nclass TroopCounts {\r\n  constructor() {\r\n    for (let type of Troops_troopTypes) {\r\n      this[type] = 0;\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return Object.assign(new TroopCounts(), this);\r\n  }\r\n\r\n  filter(allowedTroopTypes) {\r\n    let counts = new TroopCounts();\r\n    for (let type of Troops_troopTypes) {\r\n      if (allowedTroopTypes.includes(type)) {\r\n        counts[type] = this[type];\r\n      }\r\n    }\r\n    return counts;\r\n  }\r\n\r\n  isZero() {\r\n    for (let count of Object.values(this)) {\r\n      if (count !== 0) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  sum() {\r\n    let sum = 0;\r\n    for (let count of Object.values(this)) {\r\n      sum += count;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  /**\r\n   * @param {function} doSomething - receives two params: troopType and count\r\n   */\r\n  each(doSomething) {\r\n    for (let type of Troops_troopTypes) {\r\n      let count = this[type];\r\n      doSomething(type, count);\r\n    }\r\n  }\r\n\r\n  carryCapacity() {\r\n    let capacity = 0;\r\n    for (let type of Troops_troopTypes) {\r\n      capacity += this[type] * troopCarry(type);\r\n    }\r\n    return capacity;\r\n  }\r\n\r\n  populationUsed() {\r\n    return Troops_troopTypes.reduce((sum, type) => sum + troopPop(type) * this[type], 0);\r\n  }\r\n\r\n  travelDuration(distance, role = 'attack') {\r\n    let minutesPerField = this.travelMinutesPerField(role);\r\n    return calcTravelDuration(minutesPerField, distance);\r\n  }\r\n\r\n  travelMinutesPerField(role = 'attack') {\r\n    if (role === 'support' && this.knight > 0) {\r\n      return travelMinutes('knight');\r\n    }\r\n\r\n    let relevantMinutes = Troops_troopTypes\r\n      .filter(type => this[type] > 0)\r\n      .map(type => travelMinutes(type));\r\n\r\n    return Math.max(...relevantMinutes);\r\n  }\r\n\r\n  /**\r\n   * @param {TroopCounts} subtrahend\r\n   * @return {TroopCounts} difference\r\n   */\r\n  subtract(subtrahend) {\r\n    let difference = new TroopCounts();\r\n    for (let [troopType, count] of Object.entries(this)) {\r\n      difference[troopType] = count - subtrahend[troopType];\r\n    }\r\n    return difference;\r\n  }\r\n\r\n  /**\r\n   * get new TroopCounts, like this one but with any negative counts set to 0\r\n   */\r\n  zeroNegatives() {\r\n    let troopCounts = new TroopCounts();\r\n    for (let [troopType, count] of Object.entries(this)) {\r\n      troopCounts[troopType] = Math.max(0, count);\r\n    }\r\n    return troopCounts;\r\n  }\r\n\r\n  toArray() {\r\n    return Troops_troopTypes.map(type => this[type]);\r\n  }\r\n\r\n  static fromArray(array) {\r\n    let troops = new TroopCounts();\r\n    array.forEach((count, i) => {\r\n      troops[Troops_troopTypes[i]] = count;\r\n    });\r\n    return troops;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n *  @param {number} distance\r\n *  @return  {{spear:number, sword:number, ...}} milliseconds\r\n */\r\nfunction calcTravelDurations(distance) {\r\n  let travelTimes = {};\r\n  for (let type of Troops_troopTypes) {\r\n    travelTimes[type] = calcTravelDuration(travelMinutes(type), distance);\r\n  }\r\n  return travelTimes;\r\n};\r\n\r\n\r\nfunction calcTravelDuration(minutesPerField, distance) {\r\n  // The game rounds travel duration to the nearest second.\r\n  // The milliseconds part of the scheduled arrival is NOT some fraction of travel seconds.\r\n  // But rather, copied from the clock when the server started processing the request to travel.\r\n  //\r\n  // e.g. The clock says its 12:30:00.123.\r\n  // The server processes a request for troops to travel somewhere that takes them 10 minutes to reach.\r\n  // The scheduled arrival will be 12:40:00.123\r\n  return Math.round(distance * minutesPerField * 60) * 1000;\r\n}\r\n\r\n\r\nlet troopUtil = {\r\n\r\n  troopTypesOnWorld() {\r\n    return window.game_data.units;\r\n  },\r\n\r\n  existsOnWorld(troopType) {\r\n    return typeof troopConfig.get(troopType) !== 'undefined';\r\n  },\r\n\r\n  /**\r\n   * @param {string} troopType\r\n   * @param {number} resourceAmount\r\n   * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n   * @return {number} how many troops does it take to carry all the resources\r\n   */\r\n  countToCarry(troopType, resourceAmount, haulBonus = 0) {\r\n    let haulPerUnit = troopCarry(troopType) * (100 + haulBonus) / 100;\r\n    let troopCount = resourceAmount / haulPerUnit;\r\n    return Math.round(10 * troopCount) / 10;\r\n  },\r\n\r\n  carryCapacity(troopType, factor = 1.0) {\r\n    return troopCarry(troopType) * factor;\r\n  },\r\n\r\n  /**\r\n   * @param {string} troopType\r\n   * @param {number} distance\r\n   * @return {number} milliseconds to travel\r\n   */\r\n  travelDuration(troopType, distance) {\r\n    return calcTravelDuration(travelMinutes(troopType), distance);\r\n  }\r\n\r\n};\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/TwCheeseDate.js\n\r\n\r\nlet serverOffsetFromUtc = window.server_utc_diff * 1000;\r\nlet localOffsetFromUtc = new Date().getTimezoneOffset() * 60000;\r\n\r\nlet pretendServerIsUTC = function (cheeseDate) {\r\n  return cheeseDate.addMilliseconds(serverOffsetFromUtc)\r\n}\r\n\r\n\r\nclass TwCheeseDate_TwCheeseDate extends Date {\r\n  constructor() {\r\n    if (arguments.length === 0) {\r\n      super(window.Timing.getCurrentServerTime());\r\n    } else {\r\n      super(...arguments);\r\n    }\r\n  }\r\n\r\n  clone() {\r\n    return new TwCheeseDate_TwCheeseDate(this.getTime());\r\n  }\r\n\r\n  addDays(days) {\r\n    let ret = this.clone();\r\n    ret.setUTCDate(this.getUTCDate() + days);\r\n    return ret;\r\n  }\r\n\r\n  addHours(hours) {\r\n    let ret = this.clone();\r\n    ret.setUTCHours(this.getUTCHours() + hours);\r\n    return ret;\r\n  }\r\n\r\n  addMinutes(minutes) {\r\n    let ret = this.clone();\r\n    ret.setUTCMinutes(this.getUTCMinutes() + minutes);\r\n    return ret;\r\n  }\r\n\r\n  addSeconds(seconds) {\r\n    let ret = this.clone();\r\n    ret.setUTCSeconds(this.getUTCSeconds() + seconds);\r\n    return ret;\r\n  }\r\n\r\n  addMilliseconds(milliseconds) {\r\n    let ret = this.clone();\r\n    ret.setUTCMilliseconds(this.getUTCMilliseconds() + milliseconds);\r\n    return ret;\r\n  }\r\n\r\n  subDays(days) {\r\n    return this.addDays(-days);\r\n  }\r\n\r\n  subHours(hours) {\r\n    return this.addHours(-hours);\r\n  }\r\n\r\n  subMinutes(minutes) {\r\n    return this.addMinutes(-minutes);\r\n  }\r\n\r\n  subSeconds(seconds) {\r\n    return this.addSeconds(-seconds);\r\n  }\r\n\r\n  subMilliseconds(milliseconds) {\r\n    return this.addMilliseconds(-milliseconds);\r\n  }\r\n\r\n  getServerYear() {\r\n    return pretendServerIsUTC(this).getUTCFullYear();\r\n  }\r\n\r\n  getServerMonth() {\r\n    return pretendServerIsUTC(this).getUTCMonth();\r\n  }\r\n\r\n  getServerDate() {\r\n    return pretendServerIsUTC(this).getUTCDate();\r\n  }\r\n\r\n  getServerHours() {\r\n    return pretendServerIsUTC(this).getUTCHours();\r\n  }\r\n\r\n  getServerHours() {\r\n    return pretendServerIsUTC(this).getUTCHours();\r\n  }\r\n\r\n  getServerMinutes() {\r\n    return pretendServerIsUTC(this).getUTCMinutes();\r\n  }\r\n\r\n  getServerSeconds() {\r\n    return pretendServerIsUTC(this).getUTCSeconds();\r\n  }\r\n\r\n  getServerMilliseconds() {\r\n    return pretendServerIsUTC(this).getUTCMilliseconds();\r\n  }\r\n\r\n  isTodayOnServer() {\r\n    let date = pretendServerIsUTC(this);\r\n    let now = pretendServerIsUTC(new TwCheeseDate_TwCheeseDate());\r\n    return date.isSameDayInUtc(now);\r\n  }\r\n\r\n  isTomorrowOnServer() {\r\n    let date = pretendServerIsUTC(this);\r\n    let now = pretendServerIsUTC(new TwCheeseDate_TwCheeseDate());\r\n    let tomorrow = now.addDays(1);\r\n    return date.isSameDayInUtc(tomorrow);\r\n  }\r\n\r\n  isSameDayInUtc(otherDate) {\r\n    return this.getUTCFullYear() === otherDate.getUTCFullYear()\r\n      && this.getUTCMonth() === otherDate.getUTCMonth()\r\n      && this.getUTCDate() === otherDate.getUTCDate();\r\n  }\r\n\r\n  startOfHour() {\r\n    let ret = this.clone();\r\n    ret.setUTCMinutes(0);\r\n    ret.setUTCSeconds(0);\r\n    ret.setUTCMilliseconds(0);\r\n    return ret;\r\n  }\r\n\r\n  endOfHour() {\r\n    let ret = this.clone();\r\n    ret.setUTCMinutes(59);\r\n    ret.setUTCSeconds(59);\r\n    ret.setUTCMilliseconds(999);\r\n    return ret;\r\n  }\r\n\r\n  startOfSecond() {\r\n    let ret = this.clone();\r\n    ret.setUTCMilliseconds(0);\r\n    return ret;\r\n  }\r\n\r\n  equals(date) {\r\n    return this.getTime() === date.getTime();\r\n  }\r\n\r\n  toHtml(includeMillis = true) {\r\n    let d = pretendServerIsUTC(this);\r\n    let year = d.getUTCFullYear();\r\n    let monthName = d.toLocaleString('default', {month: 'short'});\r\n    let day = d.getUTCDate().toString().padStart(2, '0');\r\n    let hours = d.getUTCHours().toString().padStart(2, '0');\r\n    let minutes = d.getUTCMinutes().toString().padStart(2, '0');\r\n    let seconds = d.getUTCSeconds().toString().padStart(2, '0');\r\n    let ms = d.getUTCMilliseconds().toString().padStart(3, '0');\r\n\r\n    let html = `${monthName} ${day}, ${year} ${hours}:${minutes}:${seconds}`;\r\n    if (includeMillis) {\r\n      html += `<span class=\"small grey\">:${ms}</span>`;\r\n    }\r\n    return html;\r\n  }\r\n\r\n  toDebugString() {\r\n    let d = pretendServerIsUTC(this);\r\n    let year = d.getUTCFullYear();\r\n    let month = d.getUTCMonth().toString().padStart(2, '0');\r\n    let day = d.getUTCDate().toString().padStart(2, '0');\r\n    let hours = d.getUTCHours().toString().padStart(2, '0');\r\n    let minutes = d.getUTCMinutes().toString().padStart(2, '0');\r\n    let seconds = d.getUTCSeconds().toString().padStart(2, '0');\r\n    let ms = d.getUTCMilliseconds().toString().padStart(3, '0');\r\n    let offsetHours = Math.round(serverOffsetFromUtc / 360000) / 10;\r\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${ms} ServerTime(UTC+${offsetHours})`;\r\n  }\r\n\r\n  imageSrc() {\r\n    return ImageSrc.calendar;\r\n  }\r\n\r\n  /**\r\n   * @params whatever would be passed to a Date constructor\r\n   * @return {TwCheeseDate}\r\n   */\r\n  static newServerDate() {\r\n    let ret = new TwCheeseDate_TwCheeseDate(...arguments);\r\n    if (arguments.length > 1) {\r\n      ret = ret.addMilliseconds(0 - serverOffsetFromUtc - localOffsetFromUtc);\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  static monthNumber(monthName) {\r\n    return (new Date(monthName + ' 1 1970')).getMonth();\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/ReportRenamer.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportRenamer_ReportRenamer {\r\n\r\n  /**\r\n   * @param {BattleReport} report\r\n   * @param {string} note\r\n   * @return {Promise}\r\n   * @resolve {string} new name\r\n   */\r\n  async rename(report, note) {\r\n    let newName = this.createName(report, note);\r\n    await postToGame('report', {ajaxaction: 'edit_subject', report_id: report.reportId}, {text: newName});\r\n\r\n    $(this).trigger({\r\n      type: 'report-renamed',\r\n      reportId: report.reportId,\r\n      newName\r\n    });\r\n\r\n    return newName;\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReport} report\r\n   * @param {string} note\r\n   * @return {string} new name\r\n   */\r\n  createName(report, note = '') {\r\n    var newName = 'twCheese: ';\r\n    newName += report.attacker.name.replace(textScraper.t('report.deletedPlayer'), '') + ' ';\r\n    newName += '(' + report.attackerVillage.x + '|' + report.attackerVillage.y + ',' + report.attackerVillage.id + ')';\r\n    newName += report.defender.name.replace(textScraper.t('report.deletedPlayer'), '');\r\n    newName += '(' + report.defenderVillage.x + '|' + report.defenderVillage.y + ',' + report.defenderVillage.id + ')';\r\n\r\n    let timingInfo = report.calcTimingInfo();\r\n    newName += '_t:' + Math.floor(timingInfo.launchTime.getTime() / 1000) + '. ';\r\n\r\n    if (report.attackerLosses.snob > 0) //dead noble\r\n      newName += '_x';\r\n    if (report.loyalty)\r\n      newName += '_l:' + report.loyalty.after + '.';\r\n    if (report.defenderSurvivors)\r\n      newName += '_d[' + report.defenderSurvivors.toArray() + '] ';\r\n    if (report.buildingLevels)\r\n      newName += '_b[' + report.buildingLevels.toArray() + '] ';\r\n    if (report.resources)\r\n      newName += '_r[' + report.resources.toArray() + '] ';\r\n    if (report.wasAttackFeint())\r\n      newName += '_f';\r\n    if (note)\r\n      newName += '_n:' + note;\r\n\r\n    return newName;\r\n  }\r\n\r\n\r\n  /**\r\n   * @param {string} reportName\r\n   * @return {BattleReportCondensed}\r\n   */\r\n  parseName(reportName) {\r\n    reportName = reportName.trim();\r\n\r\n    if (reportName.startsWith('twCheese:')) {\r\n      try {\r\n        return this.parseTwCheeseName(reportName);\r\n      } catch (err) {\r\n        console.error('parseTwCheeseName failed:', reportName, err);\r\n      }\r\n    } else {\r\n      try {\r\n        return this.parseDefaultName(reportName);\r\n      } catch (err) {\r\n        // The player could have renamed the report to something unrecognized, or the game changed the name format.\r\n        console.info('parseDefaultName failed:', reportName);\r\n      }\r\n    }\r\n    let fallbackReport = new BattleReportCondensed_BattleReportCondensed();\r\n    fallbackReport.subject = reportName;\r\n    return fallbackReport;\r\n  }\r\n\r\n  /**\r\n   * @param {string} reportName\r\n   * @return {BattleReportCondensed}\r\n   */\r\n  parseDefaultName(reportName) {\r\n    let report = new BattleReportCondensed_BattleReportCondensed();\r\n    report.subject = reportName;\r\n\r\n    // e.g. \"Pazuzu (Squanch) scouts cheesasauruss village (600|410) K46 - (spy)\"\r\n    let expr = /(.*?) \\(.+\\((\\d+)\\|(\\d+)/;\r\n    let [, aName, dvX, dvY] = reportName.match(expr);\r\n    report.attackerName = aName;\r\n    report.defenderVillage = new Village(0, dvX, dvY);\r\n    return report;\r\n  }\r\n\r\n  /**\r\n   * @param {string} reportName\r\n   * @return {BattleReportCondensed}\r\n   */\r\n  parseTwCheeseName(reportName) {\r\n    let report = new BattleReportCondensed_BattleReportCondensed();\r\n    report.subject = reportName;\r\n\r\n    // e.g. \"twCheese: Pazuzu (598|419,17068)cheesasaurus(600|410,20373)\"\r\n    let expr = /twCheese: (.*?) \\((\\d+)\\|(\\d+),(\\d+)\\)(.*?)\\((\\d+)\\|(\\d+),(\\d+)\\)/\r\n    let [, aName, avX, avY, avId, dName, dvX, dvY, dvId] = reportName.match(expr);\r\n    report.attackerName = aName;\r\n    report.attackerVillage = new Village(avId, avX, avY);\r\n    report.defenderName = dName;\r\n    report.defenderVillage = new Village(dvId, dvX, dvY);\r\n\r\n    // set note, and remove from reportName\r\n    if (reportName.includes('_n:')) {\r\n      report.note = reportName.match(/_n:(.+)/)[1];\r\n      reportName = reportName.replace(/_n:.+/, '');\r\n    }\r\n\r\n    // set buildingLevels\r\n    let matches = reportName.match(/_b(\\[\\S+\\])/);\r\n    if (matches) {\r\n      report.buildingLevels = Buildings_BuildingLevels.fromArray(JSON.parse(matches[1]));\r\n    }\r\n\r\n    // set resources\r\n    matches = reportName.match(/_r(\\[\\S+\\])/);\r\n    if (matches) {\r\n      let r = JSON.parse(matches[1]);\r\n      report.resources = new Resources_Resources(r[0], r[1], r[2]);\r\n    }\r\n\r\n    // set defenderSurvivors\r\n    matches = reportName.match(/_d(\\[\\S+\\])/);\r\n    if (matches) {\r\n      report.defenderSurvivors = TroopCounts.fromArray(JSON.parse(matches[1]));\r\n    }\r\n\r\n    // set loyalty\r\n    matches = reportName.match(/_l:(\\d+)/);\r\n    if (matches) {\r\n      report.loyalty = {after: parseInt(matches[1])};\r\n    }\r\n\r\n    // set timeLaunched\r\n    matches = reportName.match(/_t:(\\d+)/);\r\n    if (matches) {\r\n      report.timeLaunched = TwCheeseDate_TwCheeseDate.newServerDate(parseInt(matches[1]) * 1000);\r\n    }\r\n\r\n    report.attackerNobleDied = reportName.includes('_x');\r\n    report.wasAttackFeint = reportName.includes('_f');\r\n    return report;\r\n  }\r\n\r\n  availableChars(name) {\r\n    return 255 - name.length;\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/DemolitionCalculator.js\nlet catAmounts = [0, 2, 6, 10, 15, 21, 28, 36, 45, 56, 68, 82, 98, 115, 136, 159, 185, 215, 248, 286, 328, 376, 430, 490, 558, 634, 720, 815, 922, 1041, 1175, 1175];\r\nlet catAmountsChurch = [0, 400, 500, 600, 600];\r\nlet ramAmounts = [0, 2, 4, 7, 10, 14, 19, 24, 30, 37, 45, 55, 65, 77, 91, 106, 124, 143, 166, 191, 219];\r\nlet invulnerable = ['church_f', 'hide'];\r\n\r\n\r\nfunction whichSiegeLookup(buildingType) {\r\n  switch (buildingType) {\r\n    case 'wall':\r\n      return ramAmounts;\r\n    case 'church':\r\n      return catAmountsChurch;\r\n    // todo: check if watchtower uses something special\r\n    default:\r\n      return catAmounts;\r\n  }\r\n}\r\n\r\n\r\nclass DemolitionCalculator {\r\n\r\n  /**\r\n   * @param {BuildingLevels} buildingLevels\r\n   * @return {{oneShotScouted:object, oneShotUpgraded:object}} mappings of how many siege units to demolish buildings\r\n   *     example: {\r\n   *         oneShotScouted: {\r\n   *             barracks: 23, // 23 catapults to demolish the scouted barracks level in one shot\r\n   *             wall: 42 // 42 rams to demolish the scouted wall level in one shot\r\n   *         },\r\n   *         oneShotUpgraded: {\r\n   *             barracks: 69, // 69 catapults to demolish the scouted barracks level, +1 upgrade, in one shot\r\n   *             wall: 1337 // 1337 rams to demolish the scouted wall level, +1 upgrade, in one shot\r\n   *         }\r\n   *     }\r\n   *\r\n   */\r\n  suggestSiegeUnits(buildingLevels) {\r\n    let demoScouted = {};\r\n    let demoBuffer = {};\r\n\r\n    function assignDemolition(buildingType) {\r\n      if (invulnerable.includes(buildingType)) {\r\n        demoScouted[buildingType] = 'NA';\r\n        demoBuffer[buildingType] = 'NA';\r\n        return;\r\n      }\r\n\r\n      let level = buildingLevels[buildingType];\r\n      if (level === '?') {\r\n        demoScouted[buildingType] = '?';\r\n        demoBuffer[buildingType] = '?';\r\n        return;\r\n      }\r\n\r\n      let siegeAmounts = whichSiegeLookup(buildingType);\r\n\r\n      demoScouted[buildingType] = siegeAmounts[level];\r\n      let bufferLevel = buildingLevels.canUpgrade(buildingType) ? level + 1 : level;\r\n      demoBuffer[buildingType] = siegeAmounts[bufferLevel];\r\n    }\r\n\r\n    for (let buildingType in buildingLevels) {\r\n      assignDemolition(buildingType);\r\n    }\r\n\r\n    return {\r\n      oneShotScouted: demoScouted,\r\n      oneShotUpgraded: demoBuffer\r\n    };\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/BattleReport.js\n\r\n\r\n\r\n\r\nclass BattleReport_BattleReport {\r\n  constructor() {\r\n    this.attacker = null;\r\n    this.attackerLosses = null;\r\n    this.attackerQuantity = null;\r\n    this.attackerSurvivors = null;\r\n    this.attackerVillage = null;\r\n    this.battleTime = null;\r\n    this.buildingLevels = null;\r\n    this.catDamage = null;\r\n    this.defender = null;\r\n    this.defenderLosses = null;\r\n    this.defenderQuantity = null;\r\n    this.defenderSurvivors = null;\r\n    this.defenderVillage = null;\r\n    this.dotColor = null;\r\n    this.espionageLevel = null;\r\n    this.haul = null;\r\n    this.loyalty = null; // {before:number, after:number}\r\n    this.luck = null;\r\n    this.morale = null;\r\n    this.ramDamage = null;\r\n    this.reportId = null;\r\n    this.resources = null;\r\n    this.unitsInTransit = null;\r\n    this.unitsOutside = null;\r\n  }\r\n\r\n  /**\r\n   * @return {{launchTime:TwCheeseDate, returnTime:TwCheeseDate}}\r\n   */\r\n  calcTimingInfo() {\r\n    let distance = this.attackerVillage.distanceTo(this.defenderVillage);\r\n    let travelDuration = this.attackerQuantity.travelDuration(distance, 'attack');\r\n    return {\r\n      launchTime: this.battleTime.subMilliseconds(travelDuration),\r\n      returnTime: this.battleTime.addMilliseconds(travelDuration).startOfSecond()\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @return {{buildings:number, troops:number, idle:number}}\r\n   */\r\n  calcPopulation() {\r\n    if (this.espionageLevel < 2) {\r\n      throw Error('not enough information to determine population');\r\n    }\r\n    let buildingPop = this.buildingLevels.populationUsed();\r\n    let troopPop = this.defenderQuantity.populationUsed();\r\n    if (this.unitsOutside) {\r\n      troopPop += this.unitsOutside.populationUsed();\r\n    }\r\n    return {\r\n      buildings: buildingPop,\r\n      troops: troopPop,\r\n      idle: this.buildingLevels.populationCap() - buildingPop - troopPop\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @param {Number} haulBonus the extra % bonus haul from flags, events, etc.  Example: 30 for 30%, NOT 0.3\r\n   * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n   */\r\n  calcRaidScouted(haulBonus = 0) {\r\n    if (this.espionageLevel < 1) {\r\n      throw Error('not enough information');\r\n    }\r\n    return this.calcRaidUnits(this.resources.sum(), haulBonus);\r\n  }\r\n\r\n  /**\r\n   * @param {{x:number, y:number}} home\r\n   * @param {TwCheeseDate} timeNow the current time\r\n   * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n   * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n   */\r\n  calcRaidPredicted(home, timeNow, haulBonus = 0) {\r\n    if (this.espionageLevel < 2) {\r\n      throw Error('not enough information');\r\n    }\r\n    let distance = this.defenderVillage.distanceTo(home);\r\n    let maxLoot = this.buildingLevels.resourceCap() - this.buildingLevels.hideableResources();\r\n    let hourlyProduction = this.buildingLevels.resourceProductionHourly();\r\n\r\n    let hoursSinceReport = (timeNow - this.battleTime) / 3600000;\r\n    let resourcesProducedSinceReport = hourlyProduction.multiply(hoursSinceReport);\r\n    let resourcesNow = this.resources.add(resourcesProducedSinceReport);\r\n\r\n    let troopCounts = new TroopCounts();\r\n    for (let troopType of Troops_troopTypes) {\r\n      let travelDuration = troopUtil.travelDuration(troopType, distance);\r\n      let travelHours = travelDuration / 3600000;\r\n      let resourcesProducedDuringTravel = hourlyProduction.multiply(travelHours);\r\n      let resourcesAtArrival = resourcesNow.add(resourcesProducedDuringTravel).cap(maxLoot);\r\n      troopCounts[troopType] = troopUtil.countToCarry(troopType, resourcesAtArrival.sum(), haulBonus);\r\n    }\r\n    return troopCounts;\r\n  }\r\n\r\n  /**\r\n   * @param {number} periodHours the number of hours that resources have been accumulating\r\n   * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n   * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n   */\r\n  calcRaidPeriodic(periodHours, haulBonus = 0) {\r\n    let resourcesProduced = this.buildingLevels.resourceProductionHourly().multiply(periodHours);\r\n    let maxLoot = this.buildingLevels.resourceCap() - this.buildingLevels.hideableResources();\r\n    let totalResources = resourcesProduced.cap(maxLoot).sum();\r\n    return this.calcRaidUnits(totalResources, haulBonus);\r\n  }\r\n\r\n  /**\r\n   * @param {number} resources the total resources to be raided\r\n   * @param {number} haulBonus the extra % bonus haul from flags, events, etc. Example: 30 for 30%, NOT 0.3\r\n   * @return {TroopCounts} how many of each type of troop should be sent to take all resources, provided only one type of troop is sent\r\n   */\r\n  calcRaidUnits(resources, haulBonus = 0) {\r\n    let troopCounts = new TroopCounts();\r\n    for (let troopType of Troops_troopTypes) {\r\n      troopCounts[troopType] = troopUtil.countToCarry(troopType, resources, haulBonus);\r\n    }\r\n    return troopCounts;\r\n  }\r\n\r\n  /**\r\n   * was the attack likely just a distraction?\r\n   * @return {boolean}\r\n   */\r\n  wasAttackFeint() {\r\n    let troops = this.attackerQuantity;\r\n    return troops.snob === 0 && troops.populationUsed() <= 130;\r\n  }\r\n\r\n  /**\r\n   * were the defender's troops all killed?\r\n   * @return {boolean}\r\n   */\r\n  wasDefenderCleared() {\r\n    return this.defenderSurvivors && this.defenderSurvivors.isZero();\r\n  }\r\n\r\n  /**\r\n   * @return {{oneShotScouted:object, oneShotUpgraded:object}} mappings of how many siege units to demolish buildings\r\n   */\r\n  suggestSiegeUnits() {\r\n    if (this.espionageLevel < 2) {\r\n      throw Error('not enough information');\r\n    }\r\n    return (new DemolitionCalculator()).suggestSiegeUnits(this.buildingLevels);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Player.js\nclass Player {\r\n  constructor(id, name) {\r\n    this.id = id;\r\n    this.name = name;\r\n  }\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/StationedTroops.js\nclass StationedTroops {\r\n\r\n  /**\r\n   * @param TroopCounts troopCounts\r\n   * @param Village village\r\n   */\r\n  constructor(troopCounts, village) {\r\n    this.troopCounts = troopCounts;\r\n    this.village = village;\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/time.js\n\r\n\r\n// note: some worlds have milliseconds disabled\r\n\r\n/**\r\n * @param {string} text formatted the way tw does it\r\n * @param {string} market two char market code. e.g. \"en\"\r\n * @return {TwCheeseDate}\r\n */\r\nfunction parseArrival(text, market) {\r\n  switch (market) {\r\n    case 'cz':\r\n      return parseArrivalCzech(text);\r\n    case 'pt':\r\n      return parseArrivalPortuguese(text);\r\n  }\r\n  return parseArrivalEnglish(text);\r\n};\r\n\r\nfunction parseArrivalEnglish(text) {\r\n  // e.g. \"Jun 12, 2019  15:36:23:000\"\r\n  let expr = /(\\D+) (\\d+), (\\d+)  (\\d+):(\\d+):(\\d+):?(\\d+)?/;\r\n  let [, monthName, day, year, hours, minutes, seconds, millis] = text.match(expr);\r\n  let month = TwCheeseDate_TwCheeseDate.monthNumber(monthName);\r\n  return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\nfunction parseArrivalCzech(text) {\r\n  // e.g. \"10.07.19 04:43:15:967\"\r\n  let [day, monthNumber, yearShort, hours, minutes, seconds, millis] = text.match(/\\d+/g);\r\n  let year = '20' + yearShort;\r\n  let month = monthNumber - 1;\r\n  return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\nfunction parseArrivalPortuguese(text) {\r\n  // e.g. \"09/jul/2019 (20:03:15):895\"\r\n  let expr = /(\\d+)\\/(\\D+)\\/(\\d+) \\((\\d+):(\\d+):(\\d+)\\):?(\\d+)?/;\r\n  let [, day, monthName, year, hours, minutes, seconds, millis] = text.match(expr);\r\n  let month = TwCheeseDate_TwCheeseDate.monthNumber(monthName);\r\n  return TwCheeseDate_TwCheeseDate.newServerDate(year, month, day, hours, minutes, seconds, millis || 0);\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/res.js\n\r\n\r\n/**\r\n * @param {HTMLElement} resourcesContainer an element containing wood/stone/iron amounts\r\n * @return {Resources}\r\n */\r\nfunction scrapeResources(resourcesContainer) {\r\n  // remove grey periods used as thousands separators\r\n  let $res = $(resourcesContainer).clone();\r\n  $res.find('.grey').remove();\r\n\r\n  let resAmount = function (resIconCssClass) {\r\n    // note: sometimes, if the res amount is 0, the game excludes it (and its icon) instead of showing 0\r\n    let icon = $res.find('span.' + resIconCssClass).get(0);\r\n    return icon ? parseInt($(icon).parent().text()) : 0;\r\n  }\r\n\r\n  return new Resources_Resources(\r\n    resAmount('wood'),\r\n    resAmount('stone'),\r\n    resAmount('iron')\r\n  );\r\n};\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/BattleReportScraper.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @param {HTMLTableCellElement} playerCell a cell containing a link to a player profile\r\n * @return {Player}\r\n */\r\nfunction scrapePlayer(playerCell) {\r\n  if (textScraper.includes(playerCell, 'report.deletedPlayer')) {\r\n    return new Player(-1, $(playerCell).text());\r\n  } else if (playerCell.innerHTML === '---') {\r\n    return new Player(0, '---');\r\n  }\r\n  let playerLink = playerCell.firstChild;\r\n  let id = parseInt(playerLink.href.match(/&id=(\\d+)/)[1]);\r\n  let name = playerLink.innerHTML;\r\n  return new Player(id, name);\r\n}\r\n\r\n\r\n/**\r\n * @param {HTMLTableRowElement} troopRow a row of cells containing troop counts\r\n * @return {TroopCounts}\r\n */\r\nfunction scrapeTroopCounts(troopRow) {\r\n  let troops = new TroopCounts();\r\n  let troopTypes = troopUtil.troopTypesOnWorld();\r\n  for (let i = 0; i < troopTypes.length; i++) {\r\n    if (typeof troopRow.cells[i] !== 'undefined') { // attacker can't have militia\r\n      troops[troopTypes[i]] = parseInt(troopRow.cells[i].innerHTML);\r\n    }\r\n  }\r\n  return troops;\r\n}\r\n\r\n\r\n/**\r\n * @param {HTMLAnchorElement} link - a link to a village with the name and coordinates\r\n * @return {Village}\r\n */\r\nfunction scrapeVillage(link) {\r\n  let [, id] = link.href.match(/&id=(\\d+)/);\r\n  let [, x, y] = link.innerHTML.match(/\\((\\d+)\\|(\\d+)\\)(?!.*\\(.*?\\))/);\r\n  return new Village(parseInt(id), parseInt(x), parseInt(y));\r\n}\r\n\r\n\r\n/**\r\n * removes the label from a troop count row\r\n * @return  troopRowCopy:HTMLTableRowElement - a row of troop counts suitable for the twcheese_getTroopCount function\r\n * @param  troopRow:HTMLTableRowElement - the row of troop counts with the label\r\n */\r\nfunction removeTroopsLabel(troopRow) {\r\n  var troopRowCopy = document.createElement('tr');\r\n  for (var i = 1; i < troopRow.cells.length; i++) {\r\n    troopRowCopy.appendChild(document.createElement('td'));\r\n    troopRowCopy.cells[i - 1].innerHTML = troopRow.cells[i].innerHTML;\r\n  }\r\n  return troopRowCopy;\r\n}\r\n\r\n/**\r\n * scrapes the page from game.php?screen=report&view={reportId}\r\n */\r\nclass BattleReportScraper_BattleReportScraper {\r\n\r\n  /**\r\n   * @param {HTMLDocument} gameDoc\r\n   */\r\n  constructor(gameDoc) {\r\n    this.gameDoc = gameDoc;\r\n    this.$gameDoc = $(gameDoc);\r\n    this.mainTable = this.$gameDoc.find('#attack_luck').parents('table')[0];\r\n    this.luckTable = gameDoc.getElementById('attack_luck');\r\n    this.attackerTable = gameDoc.getElementById('attack_info_att');\r\n    this.attackerUnitsTable = gameDoc.getElementById('attack_info_att_units');\r\n    this.defenderTable = gameDoc.getElementById('attack_info_def');\r\n    this.defenderUnitsTable = gameDoc.getElementById('attack_info_def_units');\r\n    this.resultsTable = gameDoc.getElementById('attack_results');\r\n    this.supportKilledTable = gameDoc.getElementById('attack_away_units');\r\n    this._validate();\r\n  }\r\n\r\n  _validate() {\r\n    let shouldAlwaysBeThere = ['mainTable', 'luckTable', 'attackerTable', 'attackerUnitsTable', 'defenderTable'];\r\n    for (let propName of shouldAlwaysBeThere) {\r\n      if (!this[propName]) {\r\n        throw Error(`BattleReportScraper failed: couldn't locate the ${propName}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  scrapeReport() {\r\n    let report = new BattleReport_BattleReport();\r\n\r\n    report.attacker = this.getAttacker();\r\n    report.attackerLosses = this.getAttackerLosses();\r\n    report.attackerQuantity = this.getAttackerQuantity();\r\n    report.attackerVillage = this.getAttackerVillage();\r\n    report.battleTime = this.getBattleTime();\r\n    report.buildingLevels = this.getBuildingLevels();\r\n    report.catDamage = this.getCatDamage();\r\n    report.defender = this.getDefender();\r\n    report.defenderLosses = this.getDefenderLosses();\r\n    report.defenderQuantity = this.getDefenderQuantity();\r\n    report.defenderVillage = this.getDefenderVillage();\r\n    report.dotColor = this.getDotColor();\r\n    report.espionageLevel = this.getEspionageLevel();\r\n    report.haul = this.getHaul();\r\n    report.loyalty = this.getLoyalty();\r\n    report.luck = this.getLuck();\r\n    report.morale = this.getMorale();\r\n    report.ramDamage = this.getRamDamage();\r\n    report.reportId = this.getReportId();\r\n    report.resources = this.getResources();\r\n    report.unitsOutside = this.getUnitsOutside();\r\n    report.unitsInTransit = this.getUnitsInTransit();\r\n\r\n    report.attackerSurvivors = report.attackerQuantity.subtract(report.attackerLosses);\r\n\r\n    if (report.defenderQuantity) {\r\n      report.defenderSurvivors = report.defenderQuantity.subtract(report.defenderLosses);\r\n    }\r\n\r\n    if (!report.buildingLevels && (report.ramDamage || report.catDamage)) {\r\n      report.buildingLevels = new Buildings_BuildingLevels('?');\r\n      if (report.ramDamage) {\r\n        report.buildingLevels.wall = report.ramDamage.levelAfter;\r\n      }\r\n      if (report.catDamage) {\r\n        report.buildingLevels[report.catDamage.buildingType] = report.catDamage.levelAfter;\r\n      }\r\n    }\r\n\r\n\r\n    return report;\r\n  }\r\n\r\n  /**\r\n   * @return {Player}\r\n   */\r\n  getAttacker() {\r\n    var playerCell = this.attackerTable.rows[0].cells[1];\r\n    return scrapePlayer(playerCell);\r\n  }\r\n\r\n  /**\r\n   * @return {TroopCounts}\r\n   */\r\n  getAttackerLosses() {\r\n    return scrapeTroopCounts(removeTroopsLabel(this.attackerUnitsTable.rows[2]));\r\n  }\r\n\r\n  /**\r\n   * @return {TroopCounts}\r\n   */\r\n  getAttackerQuantity() {\r\n    return scrapeTroopCounts(removeTroopsLabel(this.attackerUnitsTable.rows[1]));\r\n  }\r\n\r\n  /**\r\n   * @return {Village}\r\n   */\r\n  getAttackerVillage() {\r\n    return scrapeVillage(this.attackerTable.rows[1].cells[1].firstChild.firstChild);\r\n  }\r\n\r\n  /**\r\n   * @return {TwCheeseDate}\r\n   */\r\n  getBattleTime() {\r\n    var text = $(this.mainTable.rows[1].cells[1]).text();\r\n    return parseArrival(text, window.game_data.market);\r\n  }\r\n\r\n  /**\r\n   * @return {BuildingLevels|null}\r\n   */\r\n  getBuildingLevels() {\r\n    if (this.getEspionageLevel() < 2) {\r\n      return null;\r\n    }\r\n\r\n    let levels = new Buildings_BuildingLevels();\r\n    let buildingData = JSON.parse(this.$gameDoc.find('#attack_spy_building_data').val());\r\n    for (let building of buildingData) {\r\n      levels[building.id] = parseInt(building.level);\r\n    }\r\n    return levels;\r\n  }\r\n\r\n  /**\r\n   * @return {{buildingType:string, levelBefore:number, levelAfter:number} | null}\r\n   */\r\n  getCatDamage() {\r\n    if (!this.resultsTable) {\r\n      return null;\r\n    }\r\n    var thElements = this.resultsTable.getElementsByTagName('th');\r\n    let catHeader = textScraper.first(thElements, 'report.catDamage');\r\n    if (!catHeader) {\r\n      return null;\r\n    }\r\n    let damageCell = catHeader.parentNode.cells[1];\r\n    let buildingType = textScraper.buildingType(damageCell);\r\n    let bElements = damageCell.getElementsByTagName('b');\r\n    return {\r\n      buildingType,\r\n      levelBefore: parseInt(bElements[0].innerHTML),\r\n      levelAfter: parseInt(bElements[1].innerHTML)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @return {Player}\r\n   */\r\n  getDefender() {\r\n    var playerCell = this.defenderTable.rows[0].cells[1];\r\n    return scrapePlayer(playerCell);\r\n  }\r\n\r\n  /**\r\n   * @return {TroopCounts|null}\r\n   */\r\n  getDefenderLosses() {\r\n    if (!this.defenderUnitsTable) {\r\n      return null;\r\n    }\r\n    return scrapeTroopCounts(removeTroopsLabel(this.defenderUnitsTable.rows[2]));\r\n  }\r\n\r\n  /**\r\n   * @return {TroopCounts|null}\r\n   */\r\n  getDefenderQuantity() {\r\n    if (!this.defenderUnitsTable) {\r\n      return null;\r\n    }\r\n    return scrapeTroopCounts(removeTroopsLabel(this.defenderUnitsTable.rows[1]));\r\n  }\r\n\r\n  /**\r\n   * @return {Village}\r\n   */\r\n  getDefenderVillage() {\r\n    return scrapeVillage(this.defenderTable.rows[1].cells[1].firstChild.firstChild);\r\n  }\r\n\r\n  /**\r\n   * @return {string} color: blue, green, yellow, or red\r\n   */\r\n  getDotColor() {\r\n    return $(this.mainTable.rows[0].cells[1])\r\n      .find('img[src*=\"dots/\"]')\r\n      .attr('src')\r\n      .match(/dots\\/(.+).png/)[1];\r\n  }\r\n\r\n  /**\r\n   * @return {number} espionageLevel\r\n   *-------- level -------------\r\n   * value  significance\r\n   * 0    nothing scouted\r\n   * 1    resources\r\n   * 2    buildings\r\n   * 3    external troops\r\n   */\r\n  getEspionageLevel() {\r\n    var spied_resources = this.$gameDoc.find('#attack_spy_resources').length > 0;\r\n    var spied_buildings = this.$gameDoc.find('#attack_spy_building_data').length > 0;\r\n    var spied_external = this.$gameDoc.find('#attack_spy_away').length > 0;\r\n    return Number(Number(spied_resources) + Number(spied_buildings) + Number(spied_external));\r\n  }\r\n\r\n  /**\r\n   * @return {Resources|null}\r\n   */\r\n  getHaul() {\r\n    if (!this.resultsTable) {\r\n      return null;\r\n    }\r\n    var thElements = this.resultsTable.getElementsByTagName('th');\r\n    let haulHeader = textScraper.first(thElements, 'report.haul');\r\n    if (!haulHeader) {\r\n      return null;\r\n    }\r\n    return scrapeResources(haulHeader.parentNode.cells[1]);\r\n  }\r\n\r\n  /**\r\n   * @return {number}\r\n   */\r\n  getLuck() {\r\n    var luckString = this.luckTable.getElementsByTagName('b')[0].innerHTML;\r\n    return new Number(luckString.substring(0, luckString.indexOf('%')));\r\n  }\r\n\r\n  /**\r\n   * @return {{before:number, after:number} | null}\r\n   */\r\n  getLoyalty() {\r\n    if (!this.resultsTable) {\r\n      return null;\r\n    }\r\n    var thElements = this.resultsTable.getElementsByTagName('th');\r\n    let loyaltyHeader = textScraper.first(thElements, 'report.loyalty');\r\n    if (!loyaltyHeader) {\r\n      return null;\r\n    }\r\n    var bElements = loyaltyHeader.parentNode.getElementsByTagName('b');\r\n    return {\r\n      before: parseInt(bElements[0].innerHTML),\r\n      after: parseInt(bElements[1].innerHTML)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @return {number|null}\r\n   */\r\n  getMorale() {\r\n    let moraleContainer = this.gameDoc.getElementById('attack_moral'); // todo: there's no such thing\r\n    if (!moraleContainer) {\r\n      return null;\r\n    }\r\n    var moraleString = moraleContainer.getElementsByTagName('h4')[0].innerHTML;\r\n    return new Number(moraleString.substring(moraleString.indexOf(' ') + 1, moraleString.indexOf('%')));\r\n  }\r\n\r\n  /**\r\n   * @return {{levelBefore:number, levelAfter:number} | null}\r\n   */\r\n  getRamDamage() {\r\n    if (!this.resultsTable) {\r\n      return null;\r\n    }\r\n    var thElements = this.resultsTable.getElementsByTagName('th');\r\n    let ramHeader = textScraper.first(thElements, 'report.ramDamage');\r\n    if (!ramHeader) {\r\n      return null;\r\n    }\r\n    var bElements = ramHeader.parentNode.getElementsByTagName('b');\r\n    return {\r\n      levelBefore: parseInt(bElements[0].innerHTML),\r\n      levelAfter: parseInt(bElements[1].innerHTML)\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @return {number}\r\n   */\r\n  getReportId() {\r\n    return parseInt(this.gameDoc.URL.match(/view=(\\d+)/)[1]);\r\n  }\r\n\r\n  /**\r\n   * @return {Resources|null}\r\n   */\r\n  getResources() {\r\n    let resContainer = this.$gameDoc.find('#attack_spy_resources').find('td')[0];\r\n    if (!resContainer) {\r\n      return null;\r\n    }\r\n    return scrapeResources(resContainer);\r\n  }\r\n\r\n  /**\r\n   * \"Defender's troops in other villages\"\r\n   * Only visible if the village was conquered.\r\n   * @return {StationedTroops[]}\r\n   */\r\n  getSupportKilled() {\r\n    if (!this.supportKilledTable) {\r\n      return [];\r\n    }\r\n    let supportKilled = [];\r\n    for (let row of this.supportKilledTable.rows) {\r\n      let troopCounts = scrapeTroopCounts(removeTroopsLabel(row));\r\n      let village = scrapeVillage(row.cells[0].firstChild);\r\n      supportKilled.push(new StationedTroops(troopCounts, village));\r\n    }\r\n    return supportKilled;\r\n  }\r\n\r\n  /**\r\n   * only visible if the village was conquered\r\n   * @return {TroopCounts|null}\r\n   */\r\n  getUnitsInTransit() {\r\n    var h4elements = this.gameDoc.getElementsByTagName('h4');\r\n    let transitHeader = textScraper.first(h4elements, 'report.unitsInTransit');\r\n    if (!transitHeader) {\r\n      return null;\r\n    }\r\n    return scrapeTroopCounts(transitHeader.nextSibling.nextSibling.rows[1]);\r\n  }\r\n\r\n  /**\r\n   * @return {TroopCounts|null}\r\n   */\r\n  getUnitsOutside() {\r\n    if (this.getEspionageLevel() < 3) {\r\n      return null;\r\n    }\r\n    return scrapeTroopCounts(this.$gameDoc.find('#attack_spy_away').find('table')[0].rows[1]);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/AttackIcons.js\n\r\n\r\n\r\nlet bits = {\r\n  SENT_VIA_FA: 1,\r\n  CONTAINS_SNOB: 2,\r\n  CONTAINS_KNIGHT: 4,\r\n  SIZE_SMALL: 8,\r\n  SIZE_MEDIUM: 16,\r\n  SIZE_LARGE: 32,\r\n  CONTAINS_SPY: 64\r\n};\r\n\r\n\r\nlet sizeThresholds = [\r\n  [5001, bits.SIZE_LARGE],\r\n  [1001, bits.SIZE_MEDIUM],\r\n  [1, bits.SIZE_SMALL]\r\n];\r\n\r\n\r\nlet Icons = new Map([\r\n  [bits.SENT_VIA_FA, {\r\n    src: ImageSrc.attackSentViaFa,\r\n    description: 'Looting attack'\r\n  }],\r\n  [bits.SIZE_SMALL, {\r\n    src: ImageSrc.attackSizeSmall,\r\n    description: 'Small attack (1-1000 troops)'\r\n  }],\r\n  [bits.SIZE_MEDIUM, {\r\n    src: ImageSrc.attackSizeMedium,\r\n    description: 'Medium attack (1000-5000 troops)'\r\n  }],\r\n  [bits.SIZE_LARGE, {\r\n    src: ImageSrc.attackSizeLarge,\r\n    description: 'Large attack (5000+ troops)'\r\n  }],\r\n  [bits.CONTAINS_SNOB, {\r\n    src: ImageSrc.attackContainsSnob,\r\n    description: 'Contains Nobleman'\r\n  }],\r\n  [bits.CONTAINS_SPY, {\r\n    src: ImageSrc.attackContainsSpy,\r\n    description: 'Contains Scouts'\r\n  }],\r\n  [bits.CONTAINS_KNIGHT, {\r\n    src: ImageSrc.attackContainsKnight,\r\n    description: 'Contains Paladin'\r\n  }],\r\n]);\r\n\r\n\r\nclass AttackIcons {\r\n  constructor(mask = 0) {\r\n    this.mask = mask;\r\n  }\r\n\r\n  getIcons() {\r\n    let icons = [];\r\n    for (let [bit, icon] of Icons) {\r\n      if (this.mask & bit) {\r\n        icons.push(icon);\r\n      }\r\n    }\r\n    return icons;\r\n  }\r\n\r\n  getMask() {\r\n    return this.mask;\r\n  }\r\n\r\n  setSentViaFa() {\r\n    this.mask |= bits.SENT_VIA_FA;\r\n  }\r\n\r\n  setContainsSnob() {\r\n    this.mask |= bits.CONTAINS_SNOB;\r\n  }\r\n\r\n  setContainsSpy() {\r\n    this.mask |= bits.CONTAINS_SPY;\r\n  }\r\n\r\n  setContainsKnight() {\r\n    this.mask |= bits.CONTAINS_KNIGHT;\r\n  }\r\n\r\n  setSizeSmall() {\r\n    this.mask |= bits.SIZE_SMALL;\r\n  }\r\n\r\n  setSizeMedium() {\r\n    this.mask |= bits.SIZE_MEDIUM;\r\n  }\r\n\r\n  setSizeLarge() {\r\n    this.mask |= bits.SIZE_LARGE;\r\n  }\r\n\r\n  /**\r\n   * @param {TroopCounts} troops\r\n   * @param {boolean} wasSentViaFa\r\n   * @return {AttackIcons}\r\n   */\r\n  static fromTroopCounts(troops, wasSentViaFa = false) {\r\n    let mask = 0;\r\n    if (wasSentViaFa) {\r\n      mask |= bits.SENT_VIA_FA;\r\n    }\r\n    if (troops.snob > 0) {\r\n      mask |= bits.CONTAINS_SNOB;\r\n    }\r\n    if (troops.knight > 0) {\r\n      mask |= bits.CONTAINS_KNIGHT;\r\n    }\r\n    if (troops.spy > 0) {\r\n      mask |= bits.CONTAINS_SPY;\r\n    }\r\n    if (!wasSentViaFa) {\r\n      let sum = troops.sum();\r\n      for (let [threshold, bit] of sizeThresholds) {\r\n        if (sum >= threshold) {\r\n          mask |= bit;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return new AttackIcons(mask);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/AttackIconsScraper.js\n\r\n\r\n\r\nclass AttackIconsScraper_AttackIconsScraper {\r\n  /**\r\n   * @param {HTMLImageElement} imgElements\r\n   * @return {AttackIcons}\r\n   */\r\n  scrapeIcons(imgElements) {\r\n    let icons = new AttackIcons();\r\n\r\n    for (let img of imgElements) {\r\n      if (img.src.includes('command/farm.png')) {\r\n        icons.setSentViaFa();\r\n      } else if (img.src.includes('command/snob.png')) {\r\n        icons.setContainsSnob();\r\n      } else if (img.src.includes('command/spy.png')) {\r\n        icons.setContainsSpy();\r\n      } else if (img.src.includes('command/knight.png')) {\r\n        icons.setContainsKnight();\r\n      } else if (img.src.includes('command/attack_small.png')) {\r\n        icons.setSizeSmall();\r\n      } else if (img.src.includes('command/attack_medium.png')) {\r\n        icons.setSizeMedium();\r\n      } else if (img.src.includes('command/attack_large.png')) {\r\n        icons.setSizeLarge();\r\n      }\r\n    }\r\n\r\n    return icons;\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Scrape/BattleReportCondensedScraper.js\n\r\n\r\n\r\n\r\n/**\r\n * scrapes listed reports from\r\n *     - game.php?screen=report&mode=attack\r\n *     - game.php?screen=report&mode=defense\r\n *\r\n */\r\nclass BattleReportCondensedScraper_BattleReportCondensedScraper {\r\n\r\n  /**\r\n   * @param {ReportRenamer} reportRenamer\r\n   */\r\n  constructor(reportRenamer) {\r\n    this.reportRenamer = reportRenamer;\r\n    this.attackIconsScraper = new AttackIconsScraper_AttackIconsScraper();\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLTableElement} reportsTable\r\n   * @return {BattleReportCondensed[]}\r\n   */\r\n  scrapeReports(reportsTable) {\r\n    let reports = [];\r\n    for (var i = 1; i < reportsTable.rows.length - 1; i++) {\r\n      let report = this.scrapeReport(reportsTable.rows[i]);\r\n      reports.push(report);\r\n    }\r\n    return reports;\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLTableRowElement} row\r\n   * @return {BattleReportCondensed}\r\n   */\r\n  scrapeReport(row) {\r\n    let reportLink = row.cells[1].getElementsByTagName('a')[0];\r\n    let reportName = reportLink.getElementsByTagName('span')[0].innerHTML;\r\n    let reportIcons = [...row.cells[1].getElementsByTagName('img')];\r\n\r\n    let report = this.reportRenamer.parseName(reportName);\r\n    report.reportId = parseInt(reportLink.href.match(/view=(\\d+)/)[1]);\r\n    report.dotColor = reportIcons.find(img => img.src.includes('graphic/dots/')).src.match(/dots\\/(.+).png/)[1];\r\n    report.isForwarded = !!reportIcons.find(img => img.src.includes('graphic/forwarded.png'));\r\n    // report.isNew = $(row.cells[1]).text().trim().endsWith(textScraper.t('report.unread'));\r\n    report.isNew = row.classList.contains(`unread`);\r\n    report.unconverted = !row.cells[1].querySelector(`.quickedit-label`).innerText.trim().startsWith(`twCheese`);\r\n    report.strTimeReceived = row.cells[2].innerHTML;\r\n    report.haulStatus = this.determineHaulStatus(reportIcons);\r\n    report.attackIcons = this.attackIconsScraper.scrapeIcons(reportIcons);\r\n\r\n    return report;\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLImageElement[]} reportIcons\r\n   * @return int\r\n   */\r\n  determineHaulStatus(reportIcons) {\r\n    let lootImg = reportIcons.find(img => img.src.includes('graphic/max_loot/'));\r\n    if (!lootImg) {\r\n      // Note: non-premium users don't get an icon showing partial/full haul.\r\n      // Scout reports don't have this icon either.\r\n      return BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN\r\n    }\r\n    if (lootImg.src.includes('max_loot/0.png')) {\r\n      return BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_PARTIAL;\r\n    }\r\n    return BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_FULL;\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/KillScores.js\nlet scoreDefenderDied = {\r\n  spear: 4,\r\n  sword: 5,\r\n  axe: 1,\r\n  archer: 5,\r\n  spy: 1,\r\n  light: 5,\r\n  marcher: 6,\r\n  heavy: 23,\r\n  ram: 4,\r\n  catapult: 12,\r\n  knight: 40,\r\n  snob: 200,\r\n  militia: 4\r\n};\r\n\r\nlet scoreAttackerDied = {\r\n  spear: 1,\r\n  sword: 2,\r\n  axe: 4,\r\n  archer: 2,\r\n  spy: 2,\r\n  light: 13,\r\n  marcher: 12,\r\n  heavy: 15,\r\n  ram: 8,\r\n  catapult: 10,\r\n  knight: 20,\r\n  snob: 200,\r\n  militia: 1\r\n};\r\n\r\n\r\n/**\r\n * @param {TroopCounts} defenderLosses\r\n */\r\nfunction calcAttackerScore(defenderLosses) {\r\n  let attackerScore = 0;\r\n  for (let [unitType, count] of Object.entries(defenderLosses)) {\r\n    if (typeof scoreDefenderDied[unitType] === 'undefined') {\r\n      console.warn(`Couldn't determine ODA score for ${unitType}`);\r\n      continue;\r\n    }\r\n    attackerScore += scoreDefenderDied[unitType] * count;\r\n  }\r\n  return attackerScore;\r\n}\r\n\r\n\r\n/**\r\n * @param {TroopCounts} attackerLosses\r\n */\r\nfunction calcDefenderScore(attackerLosses) {\r\n  let defenderScore = 0;\r\n  for (let [unitType, count] of Object.entries(attackerLosses)) {\r\n    if (typeof scoreAttackerDied[unitType] === 'undefined') {\r\n      console.warn(`Couldn't determine ODD score for ${unitType}`);\r\n      continue;\r\n    }\r\n    defenderScore += scoreAttackerDied[unitType] * count;\r\n  }\r\n  return defenderScore;\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/Loyalty.js\n\r\n\r\n\r\n\r\n/**\r\n * @param {number} reportedLoyalty\r\n * @param {Date} timeReported\r\n * @param {Date} timeNow\r\n * @param {Village|{x:number, y:number}} home\r\n * @param {Village} target\r\n * @return {{loyaltyNow: number, loyaltyAtArrival: number}}\r\n */\r\nfunction calcLoyalty(reportedLoyalty, timeReported, timeNow, home, target) {\r\n  if (reportedLoyalty <= 0) {\r\n    reportedLoyalty = 25; // loyalty jumps to 25 after a village is conquered\r\n  }\r\n\r\n  let hourlyGain = gameConfig.get('speed');\r\n\r\n  let hoursPassed = (timeNow - timeReported) / 3600000;\r\n  let loyaltyNow = Math.min(100, Math.floor(reportedLoyalty + hoursPassed * hourlyGain));\r\n\r\n  let distance = target.distanceTo(home);\r\n  let travelHours = troopUtil.travelDuration('snob', distance) / 3600000;\r\n  let loyaltyAtArrival = Math.min(100, Math.floor(loyaltyNow + travelHours * hourlyGain));\r\n\r\n  return {loyaltyNow, loyaltyAtArrival};\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Util/UI.js\n\r\n\r\n\r\nfunction UI_escapeHtml(text) {\r\n  if (typeof text !== 'string') {\r\n    text = String(text);\r\n  }\r\n  // https://stackoverflow.com/a/4835406\r\n  var map = {\r\n    '&': '&amp;',\r\n    '<': '&lt;',\r\n    '>': '&gt;',\r\n    '\"': '&quot;',\r\n    \"'\": '&#039;'\r\n  };\r\n  return text.replace(/[&<>\"']/g, function (m) {\r\n    return map[m];\r\n  });\r\n}\r\n\r\n////// css //////\r\n\r\nlet cssInitd = new Set();\r\n\r\nfunction initCss(css) {\r\n  if (cssInitd.has(css)) {\r\n    return;\r\n  }\r\n  $(`<style>${css}</style>`).appendTo('head');\r\n  cssInitd.add(css);\r\n}\r\n\r\ninitCss(`\r\n    .twcheese-popup {\r\n        z-index: 13000;\r\n        display: block;\r\n        position: fixed;\r\n        top: 60px;\r\n        border: 19px solid #804000;\r\n        border-image: url(${ImageSrc.popupBorder}) 19 19 19 19 repeat;\r\n        left: 50%;\r\n        -webkit-transform: translateX(-50%);\r\n        transform: translateX(-50%);\r\n    }\r\n`);\r\n\r\n//////// faders ///////////\r\n\r\n\r\nfunction fadeGameContent() {\r\n  $('body').append('<div id=\"fader\" class=\"fader\">');\r\n};\r\n\r\n\r\nfunction unfadeGameContent() {\r\n  $('#fader').remove();\r\n  $('.twcheese-fader').remove();\r\n}\r\n\r\n\r\nfunction fadeGameContentExcept(el) {\r\n  let $el = $(el);\r\n\r\n  if ($el.length < 1) {\r\n    throw new Error('element does not exist');\r\n  }\r\n  if ($el.length > 1) {\r\n    throw new Error('expected exactly one element, got more');\r\n  }\r\n\r\n  let $faderLeft = spawnFader();\r\n  let $faderRight = spawnFader();\r\n  let $faderTopMenu = spawnFader();\r\n  let $faderTopScreen = spawnFader();\r\n  let $faderBottomScreen = spawnFader();\r\n  let $faderBottomMenu = spawnFader();\r\n\r\n  var $bottomMenu = $('#footer');\r\n  var $topMenu = $('#topContainer');\r\n  var topMenuHeight, screenWidth, screenHeight;\r\n\r\n  function updateMeasurements() {\r\n    topMenuHeight = $topMenu.outerHeight() + 3;\r\n    screenWidth = $('body').outerWidth();\r\n    screenHeight = Math.max($('#ds_body')[0].scrollHeight, document.documentElement.clientHeight);\r\n  }\r\n\r\n  function updateFaders() {\r\n    updateMeasurements();\r\n    updateFaderLeft();\r\n    updateFaderRight();\r\n    updateFaderTopMenu();\r\n    updateFaderTopScreen();\r\n    updateFaderBottomScreen();\r\n    updateFaderBottomMenu();\r\n  }\r\n\r\n\r\n  function updateFaderLeft() {\r\n    let offset = $el.offset();\r\n    $faderLeft.css({\r\n      top: 0,\r\n      left: 0,\r\n      width: offset.left,\r\n      height: screenHeight\r\n    });\r\n  }\r\n\r\n\r\n  function updateFaderRight() {\r\n    let offset = $el.offset();\r\n    $faderRight.css({\r\n      top: 0,\r\n      right: 0,\r\n      width: screenWidth - $el.outerWidth() - offset.left,\r\n      height: screenHeight\r\n    });\r\n  }\r\n\r\n\r\n  function updateFaderTopScreen() {\r\n    let offset = $el.offset();\r\n    $faderTopScreen.css({\r\n      top: topMenuHeight,\r\n      left: offset.left,\r\n      height: offset.top - topMenuHeight,\r\n      width: $el.outerWidth(),\r\n      zIndex: $('.top_bar').zIndex() - 1\r\n    });\r\n  }\r\n\r\n\r\n  function updateFaderBottomScreen() {\r\n    let offset = $el.offset();\r\n    $faderBottomScreen.css({\r\n      top: offset.top + $el.outerHeight(),\r\n      left: offset.left,\r\n      height: screenHeight - offset.top - $el.outerHeight(),\r\n      width: $el.outerWidth(),\r\n      zIndex: $bottomMenu.zIndex() - 1\r\n    });\r\n  }\r\n\r\n\r\n  function updateFaderTopMenu() {\r\n    let offset = $el.offset();\r\n    $faderTopMenu.css({\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: offset.left,\r\n      height: topMenuHeight,\r\n      width: $el.outerWidth()\r\n    });\r\n  }\r\n\r\n\r\n  function updateFaderBottomMenu() {\r\n    let offset = $el.offset();\r\n    $faderBottomMenu.css({\r\n      position: 'fixed',\r\n      bottom: 0,\r\n      left: offset.left,\r\n      height: $bottomMenu.outerHeight(),\r\n      width: $el.outerWidth()\r\n    });\r\n  }\r\n\r\n\r\n  function spawnFader() {\r\n    let css = {\r\n      position: 'absolute',\r\n      background: 'black',\r\n      opacity: 0.5,\r\n      zIndex: 12000\r\n    };\r\n    return $('<div class=\"twcheese-fader\"></div>').css(css).appendTo($('body'));\r\n  }\r\n\r\n  updateFaders();\r\n  $(window).on('resize', updateFaders);\r\n}\r\n\r\n\r\n// mousetrap ///////////////////////////////\r\n\r\nlet mouseEvents = ['click', 'mousemove', 'mousenter', 'mouseleave', 'mouseover', 'mouseout', 'mousedown', 'mouseup'];\r\nlet mouseBubbleEvents = new Set(['click', 'mousemove', 'mouseover', 'mouseout', 'mousedown', 'mouseup']);\r\nlet mouseEventsNeedSpecial = new Set(['mousenter', 'mouseleave', 'mouseover', 'mouseout']);\r\n\r\nclass Mousetrap {\r\n  constructor() {\r\n    this.$trap = $('<div class=\"twcheese-mousetrap\">').css({\r\n      position: 'fixed',\r\n      top: 0,\r\n      left: 0,\r\n      width: '100%',\r\n      height: '100%',\r\n      background: 'cyan',\r\n      opacity: 0.001,\r\n      zIndex: 12000\r\n    })\r\n    this.prevIntendedTarget;\r\n\r\n    this.watchers = {\r\n      // example:\r\n      // click: [{$elements, handler}, {$elements, handler}]\r\n      mouseout: []\r\n    }\r\n\r\n    this.setupHandling();\r\n  }\r\n\r\n  spawn() {\r\n    this.$trap.appendTo('body');\r\n    return this;\r\n  }\r\n\r\n  destruct() {\r\n    this.$trap.remove();\r\n  }\r\n\r\n  setupHandling() {\r\n    let trapEvents = mouseEvents.filter(name => !mouseEventsNeedSpecial.has(name));\r\n\r\n    this.$trap.on(trapEvents.join(' '), (e) => {\r\n      this.$trap.hide();\r\n      let intendedTarget = document.elementFromPoint(e.offsetX, e.offsetY);\r\n      this.$trap.show();\r\n\r\n      this.notifyWatchers(e.type, e, intendedTarget);\r\n\r\n      if (e.type === 'mousemove' && intendedTarget !== this.prevIntendedTarget) {\r\n        this.notifyWatchers('mousenter', e, intendedTarget);\r\n        this.notifyWatchers('mouseleave', e, this.prevIntendedTarget);\r\n        this.notifyWatchers('mouseover', e, intendedTarget);\r\n\r\n        // mouseout\r\n        for (let watcher of this.watchers.mouseout) {\r\n          watcher.$elements.each((i, el) => {\r\n            if (\r\n              this.doesElMatch(el, 'mouseover', this.prevIntendedTarget)\r\n              && !this.doesElMatch(el, 'mouseover', intendedTarget)\r\n            ) {\r\n              watcher.handler.call(el, e);\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      this.prevIntendedTarget = intendedTarget;\r\n    });\r\n  }\r\n\r\n  notifyWatchers(eventName, e, intendedTarget) {\r\n    if (typeof this.watchers[eventName] === 'undefined') {\r\n      return;\r\n    }\r\n    for (let watcher of this.watchers[eventName]) {\r\n      watcher.$elements.each((i, el) => {\r\n        if (this.doesElMatch(el, eventName, intendedTarget)) {\r\n          watcher.handler.call(el, e);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  doesElMatch(el, eventName, intendedTarget) {\r\n    return el === intendedTarget\r\n      || (mouseBubbleEvents.has(eventName) && $.contains(el, intendedTarget));\r\n  }\r\n\r\n  on(eventName, $elements, handler) {\r\n    if (typeof this.watchers[eventName] === 'undefined') {\r\n      this.watchers[eventName] = [];\r\n    }\r\n    this.watchers[eventName].push({$elements, handler});\r\n    return this;\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Transform/enhanceBattleReport.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @param {HTMLDocument} gameDoc\r\n * @param {BattleReport} report\r\n */\r\nfunction enhanceBattleReport(gameDoc, report) {\r\n\r\n  var reportTable = gameDoc.getElementById('attack_luck').parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;\r\n\r\n  /*==== surviving defenders ====*/\r\n  if (gameDoc.getElementById('attack_info_def_units')) {\r\n    var defenseUnitsTable = gameDoc.getElementById('attack_info_def_units');\r\n    let rowAbove = defenseUnitsTable.rows[defenseUnitsTable.rows.length - 1];\r\n    let survivorsRow = defenseUnitsTable.insertRow(-1);\r\n    survivorsRow.className = \"center\";\r\n    survivorsRow.insertCell(-1);\r\n    survivorsRow.cells[0].innerHTML = 'Survivors:';\r\n    survivorsRow.cells[0].align = 'left';\r\n\r\n    for (let unitType of troopUtil.troopTypesOnWorld()) {\r\n      if (survivorsRow.cells.length >= rowAbove.cells.length) {\r\n        break;\r\n      }\r\n      let cell = survivorsRow.insertCell(-1);\r\n      let unitCount = report.defenderSurvivors[unitType];\r\n      if (unitCount === 0) {\r\n        cell.className = 'hidden';\r\n      }\r\n      cell.innerHTML = unitCount;\r\n    }\r\n  }\r\n\r\n  /*==== surviving attackers ====*/\r\n  if (gameDoc.getElementById('attack_info_att_units')) {\r\n    var unit_table = gameDoc.getElementById('attack_info_att_units');\r\n    let rowAbove = unit_table.rows[unit_table.rows.length - 1];\r\n    let survivorsRow = unit_table.insertRow(-1);\r\n    survivorsRow.className = \"center\";\r\n    survivorsRow.insertCell(-1);\r\n    survivorsRow.cells[0].innerHTML = 'Survivors:';\r\n    survivorsRow.cells[0].align = 'left';\r\n\r\n    for (let unitType of troopUtil.troopTypesOnWorld()) {\r\n      if (survivorsRow.cells.length >= rowAbove.cells.length) {\r\n        break;\r\n      }\r\n      let cell = survivorsRow.insertCell(-1);\r\n      let unitCount = report.attackerSurvivors[unitType];\r\n      if (unitCount === 0) {\r\n        cell.className = 'hidden';\r\n      }\r\n      cell.innerHTML = unitCount;\r\n    }\r\n  }\r\n\r\n  /*==== population summary ====*/\r\n  if (report.espionageLevel >= 2) {\r\n    let population = report.calcPopulation();\r\n    let idleLabel = (report.espionageLevel === 3) ? 'Idle' : 'Unknown';\r\n\r\n    $(gameDoc).find('#attack_spy_buildings_right')\r\n      .after(`\r\n                <table>\r\n                    <tr>\r\n                        <th>Population:</th>\r\n                        <td>\r\n                            Buildings <b>(${population.buildings})</b>\r\n                            <br/>Military <b>(${population.troops})</b>\r\n                            <br/>${idleLabel} <b>(${population.idle})</b>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            `);\r\n  }\r\n\r\n  /*==== loyalty ====*/\r\n  if (report.loyalty) {\r\n    let now = TwCheeseDate_TwCheeseDate.newServerDate();\r\n    let loyaltyExtra = calcLoyalty(report.loyalty.after, report.battleTime, now, game_data.village, report.defenderVillage);\r\n\r\n    var resultsHeaders = gameDoc.getElementById('attack_results').getElementsByTagName('th');\r\n    var loyaltyRow = textScraper.first(resultsHeaders, 'report.loyalty').parentNode;\r\n    var loyaltyHTML = loyaltyRow.cells[1].innerHTML;\r\n    loyaltyRow.removeChild(loyaltyRow.cells[1]);\r\n    loyaltyRow.insertCell(-1);\r\n    loyaltyRow.cells[1].innerHTML = loyaltyHTML;\r\n    loyaltyRow.cells[1].innerHTML += '<br/><span title=\"the current predicted loyalty, based on time passed since this report\">@Current Time: ' + loyaltyExtra.loyaltyNow + '</span>';\r\n    loyaltyRow.cells[1].innerHTML += '<br/><span title=\"the predicted loyalty at time of arrival, should you send a nobleman from your current village right now\">@Arrival: ' + loyaltyExtra.loyaltyAtArrival + '</span>';\r\n  }\r\n\r\n  /*==== opponents defeated ====*/\r\n  var oddRow = gameDoc.getElementById('attack_info_att').insertRow(-1);\r\n  var oddHeader = document.createElement('th');\r\n  oddHeader.innerHTML = 'ODD:';\r\n  oddRow.appendChild(oddHeader);\r\n  oddRow.insertCell(-1);\r\n  oddRow.cells[1].innerHTML = `The defender gained ${calcDefenderScore(report.attackerLosses)} points.`;\r\n\r\n  var odaRow = gameDoc.getElementById('attack_info_def').insertRow(-1);\r\n  var odaHeader = document.createElement('th');\r\n  odaHeader.innerHTML = 'ODA:';\r\n  odaRow.appendChild(odaHeader);\r\n  odaRow.insertCell(-1);\r\n  if (!report.defenderQuantity) {\r\n    odaRow.cells[1].innerHTML = 'Not enough information.'\r\n  } else {\r\n    odaRow.cells[1].innerHTML = `The attacker gained ${calcAttackerScore(report.defenderLosses)} points.`;\r\n  }\r\n\r\n  /*==== timing info ====*/\r\n  let timingInfo = report.calcTimingInfo();\r\n\r\n  if (!reportTable.rows) //6.5 graphics\r\n    reportTable = reportTable.getElementsByTagName('table')[1];\r\n  var launchRow = reportTable.insertRow(2);\r\n\r\n  launchRow.insertCell(-1);\r\n  launchRow.cells[0].innerHTML = '<span title=\"the time the attacker sent the attack\">Launched</span>';\r\n  launchRow.insertCell(-1);\r\n  launchRow.cells[1].innerHTML = timingInfo.launchTime.toHtml();\r\n\r\n  /*==== determine whether return time should be displayed. ====*/\r\n  let showReturnTime = !report.attackerSurvivors.isZero();\r\n\r\n  var returnRow = reportTable.insertRow(3);\r\n  returnRow.insertCell(-1);\r\n  if (showReturnTime) {\r\n    returnRow.cells[0].innerHTML = '<span title=\"the time the attacking troops return to the attacker\\'s village\">Returns</span>';\r\n    returnRow.insertCell(-1);\r\n    returnRow.cells[1].innerHTML = timingInfo.returnTime.toHtml();\r\n  }\r\n\r\n  /*==== rally point Manage Troops link ====*/\r\n  let isDefenderMe = report.defender.name == game_data.player.name;\r\n  let wasVillageConquered = report.loyalty && report.loyalty.after <= 0;\r\n  if (isDefenderMe || wasVillageConquered) {\r\n    let url = gameUrl('place', {mode: 'units', village: report.defenderVillage.id});\r\n    let linkHtml = `<a href=\"${url}\" style=\"float: right;\">\r\n            <img title=\"manage troops\" style=\"float:right; cursor:pointer;\" src=\"${ImageSrc.buildingIcon('place')}\" />\r\n        </a>`;\r\n    let defenderVillageCell = gameDoc.getElementById('attack_info_def').rows[1].cells[1];\r\n    defenderVillageCell.appendChild($(linkHtml)[0]);\r\n  }\r\n\r\n  /*==== json representation ====*/\r\n  var jsonRow = reportTable.insertRow(5);\r\n  jsonRow.insertCell(-1);\r\n  jsonRow.cells[0].colSpan = 2;\r\n  jsonRow.cells[0].innerHTML = '<b>JSON</b><br/><textarea cols=50 readonly=true>' + UI_escapeHtml(JSON.stringify(report, null, 2)) + '</textarea>';\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Transform/spawnLegacyHelpButton.js\n\r\n\r\n\r\nvar spawnLegacyHelpButton_language = {\"twcheese\": {}};\r\nswitch (game_data.market) {\r\n  default:\r\n    /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n    spawnLegacyHelpButton_language['twcheese']['Help'] = 'Help';\r\n    break;\r\n\r\n  case 'cz':\r\n    /*==== divokekmeny.cz/ ====*/\r\n    spawnLegacyHelpButton_language['twcheese']['Help'] = 'Pomoc';\r\n    break;\r\n\r\n  case 'se':\r\n    spawnLegacyHelpButton_language['twcheese']['Help'] = 'Hjälp';\r\n    break;\r\n\r\n  /*==== fyletikesmaxes.gr/ ====*/\r\n  case 'gr':\r\n    spawnLegacyHelpButton_language['twcheese']['Help'] = 'Βοήθεια';\r\n    break;\r\n\r\n  /* Norwegian */\r\n  case 'no':\r\n    spawnLegacyHelpButton_language['twcheese']['Help'] = 'Hjelp';\r\n    break;\r\n\r\n}\r\n\r\n\r\n/**\r\n *  @param  address:String  (optional) if included, causes the button to open a new window when clicked, directing the page to the specified address\r\n */\r\nfunction spawnLegacyHelpButton(address) {\r\n  var twcheese_menu = document.createElement('div');\r\n  twcheese_menu.style.textAlign = 'center';\r\n\r\n  var twcheese_menu_text = document.createElement('p');\r\n  twcheese_menu_text.style.fontSize = '9pt';\r\n  twcheese_menu_text.innerHTML = spawnLegacyHelpButton_language['twcheese']['Help'];\r\n  twcheese_menu_text.style.fontWeight = '700';\r\n  twcheese_menu_text.style.marginTop = '3px';\r\n  twcheese_menu_text.style.color = '#422301';\r\n  twcheese_menu.appendChild(twcheese_menu_text);\r\n\r\n  twcheese_menu.style.background = `url(\"${ImageSrc.legacy.helpBackground}\")`;\r\n  twcheese_menu.style.height = '22px';\r\n  twcheese_menu.style.width = '49px';\r\n  twcheese_menu.style.display = 'block';\r\n  twcheese_menu.style.position = 'fixed';\r\n  twcheese_menu.style.left = '100%';\r\n  twcheese_menu.style.top = '100%';\r\n  twcheese_menu.style.marginTop = '-24px';\r\n  twcheese_menu.style.marginLeft = '-52px';\r\n  twcheese_menu.style.zIndex = '99999999999';\r\n\r\n  twcheese_menu.onmouseover = function () {\r\n    this.style.background = `url(\"${ImageSrc.legacy.helpBackgroundBright}\")`\r\n  };\r\n  twcheese_menu.onmouseout = function () {\r\n    this.style.background = `url(\"${ImageSrc.legacy.helpBackground}\")`\r\n  };\r\n\r\n  if (address) {\r\n    twcheese_menu.style.cursor = 'pointer';\r\n    twcheese_menu.onclick = function () {\r\n      window.open(address, 'twcheese_menu_window')\r\n    };\r\n  } else\r\n    twcheese_menu.style.cursor = 'default';\r\n\r\n  return document.body.appendChild(twcheese_menu);\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/AbstractWidget.js\nfunction afterDOMInsert(el, callback) {\r\n  let observer = new MutationObserver((mutations) => {\r\n    outerloop:\r\n      for (let mutation of mutations) {\r\n        for (let node of mutation.addedNodes) {\r\n          if (node === el || node.contains(el)) {\r\n            setTimeout(callback, 0);\r\n            observer.disconnect();\r\n            break outerloop;\r\n          }\r\n        }\r\n      }\r\n  });\r\n\r\n  observer.observe(document, {\r\n    attributes: true,\r\n    childList: true,\r\n    subtree: true\r\n  });\r\n}\r\n\r\n\r\nclass AbstractWidget {\r\n\r\n  insertBefore(el) {\r\n    this._beforeInsert();\r\n    $(el).before(this.$el);\r\n    return this;\r\n  }\r\n\r\n  insertAfter(el) {\r\n    this._beforeInsert();\r\n    $(el).after(this.$el);\r\n    return this;\r\n  }\r\n\r\n  appendTo(el) {\r\n    this._beforeInsert();\r\n    $(el).append(this.$el);\r\n    return this;\r\n  }\r\n\r\n  _beforeInsert() {\r\n    if (typeof this.afterInsert !== 'function') {\r\n      return;\r\n    }\r\n    let el = this.$el[0];\r\n    afterDOMInsert(el, () => this.afterInsert());\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportRaiderWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportRaiderWidget_ReportRaiderWidget extends AbstractWidget {\r\n  constructor(report) {\r\n    super();\r\n    this.report = report;\r\n\r\n    this.raiderTroopTypes = ['spear', 'sword', 'axe', 'archer', 'light', 'marcher', 'heavy']\r\n      .filter(troopType => troopUtil.existsOnWorld(troopType));\r\n\r\n    this.initStructure();\r\n    this.watchSelf();\r\n    this.applyUserConfig();\r\n\r\n    if (!this.mayFillRallyPoint()) {\r\n      this.$scoutsContainer.hide();\r\n    }\r\n  }\r\n\r\n  mayFillRallyPoint() {\r\n    // uk rules forbid filling units into rally point\r\n    return window.game_data.market !== 'uk';\r\n  }\r\n\r\n  initStructure() {\r\n    this.$el = $(this.createHtml().trim());\r\n    this.$raidMode = this.$el.find('#twcheese_raider_selection');\r\n    this.$haulBonus = this.$el.find('#twcheese_raider_haulBonus');\r\n    this.$period = this.$el.find('#twcheese_period');\r\n    this.$periodContainer = this.$el.find('#twcheese_periodic_options');\r\n    this.$scouts = this.$el.find('#twcheese_raider_scouts');\r\n    this.$scoutsContainer = this.$el.find('#twcheese_raider_scout');\r\n    this.$buttonSetDefault = this.$el.find('.twcheese-button-set-default');\r\n\r\n    let raiderUnitsTable = this.$el.find('#twcheese_raider_units')[0];\r\n    this.$raiderLinks = $(raiderUnitsTable.rows[0]).find('a');\r\n    this.$raiderTroopCounts = $(raiderUnitsTable.rows[1].cells);\r\n  }\r\n\r\n  createHtml() {\r\n    let report = this.report;\r\n    let travelTimes = calcTravelDurations(report.attackerVillage.distanceTo(report.defenderVillage));\r\n    let rallyPointUrl = gameUrl('place', {target: report.defenderVillage.id});\r\n\r\n    let raidModeOptions = [];\r\n    if (report.espionageLevel >= 1) { // resources were scouted\r\n      raidModeOptions.push(`<option value=\"scouted\">raid scouted resources</option>`);\r\n    }\r\n    if (report.espionageLevel >= 2) { // buildings were scouted\r\n      raidModeOptions.push(`<option value=\"predicted\">raid predicted resources</option>`);\r\n      raidModeOptions.push(`<option value=\"periodic\">periodically raid resources</option>`);\r\n    }\r\n\r\n    let iconCells = [];\r\n    let troopCountCells = [];\r\n    let travelTimeCells = [];\r\n    for (let troopType of this.raiderTroopTypes) {\r\n      if (this.mayFillRallyPoint()) {\r\n        iconCells.push(`<td width=\"35px\"><a><img src=\"${ImageSrc.troopIcon(troopType)}\"></a></td>`);\r\n      } else {\r\n        iconCells.push(`<td width=\"35px\"><img src=\"${ImageSrc.troopIcon(troopType)}\"></td>`);\r\n      }\r\n      troopCountCells.push('<td></td>');\r\n      travelTimeCells.push(`<td>${window.Format.timeSpan(travelTimes[troopType])}</td>`);\r\n    }\r\n\r\n    return `\r\n            <table id=\"twcheese_raider_calculator\">\r\n                <tr>\r\n                    <td><span align=\"center\"><h2>Raiders</h2></span></td>\r\n                </tr>\r\n                <tr align=\"center\">\r\n                    <td>\r\n                        <select id=\"twcheese_raider_selection\">\r\n                            ${raidModeOptions.join('')}\r\n                        </select>\r\n                        <a href=\"${rallyPointUrl}\">&raquo; Send troops</a>\r\n                        <div>\r\n                            Haul Bonus: <input id=\"twcheese_raider_haulBonus\" type=\"text\" size=\"5\" value=\"0\"/>%\r\n                        </div>\r\n                        <div id=\"twcheese_periodic_options\">\r\n                            Period (hours): <input id=\"twcheese_period\" type=\"text\" size=\"4\" value=\"8\"/>\r\n                        </div>\r\n                        <button class=\"twcheese-button-set-default\">Use current selection as default</button>\r\n                    </td>\r\n                </tr>\r\n                <tr align=\"center\">\r\n                    <td>\r\n                        <table id=\"twcheese_raider_units\" class=\"vis overview_table\" style=\"border: 1px solid\">\r\n                            <tr class=\"center\">${iconCells.join('')}</tr>\r\n                            <tr class=\"center\">${troopCountCells.join('')}</tr>\r\n                            <tr class=\"center\">${travelTimeCells.join('')}</tr>\r\n                        </table>\r\n                    </td>\r\n                    <td>\r\n                        <table id=\"twcheese_raider_scout\" class=\"vis overview_table\" style=\"border: 1px solid\">\r\n                            <tr class=\"center\">\r\n                                <td width=\"35px\">\r\n                                    <img src=\"${ImageSrc.troopIcon('spy')}\" title=\"Number of scouts to send when a unit icon to the left is clicked\">\r\n                                </td>\r\n                            </tr>\r\n                            <tr class=\"center\">\r\n                                <td>\r\n                                    <input id=\"twcheese_raider_scouts\" type=\"number\" size=\"3\" value=\"0\" min=\"0\">\r\n                                </td>\r\n                            </tr>\r\n                        </table>\r\n                    </td>\r\n                </tr>\r\n            </table>\r\n        `;\r\n  }\r\n\r\n  watchSelf() {\r\n    this.$raidMode.on('change', () => {\r\n      this.updateRaiders();\r\n    });\r\n\r\n    this.$haulBonus.on('input', () => {\r\n      this.updateRaiders();\r\n    });\r\n\r\n    this.$period.on('input', () => {\r\n      this.updateRaiders();\r\n    });\r\n\r\n    this.$scouts.on('input', () => {\r\n      userConfig.set('ReportRaiderWidget.raidScouts', this.getScouts());\r\n      this.updateRaiders();\r\n    });\r\n\r\n    this.$buttonSetDefault.on('click', () => {\r\n      userConfig.set('ReportRaiderWidget.raidMode', this.getRaidMode());\r\n      userConfig.set('ReportRaiderWidget.haulBonus', this.getHaulBonus());\r\n      userConfig.set('ReportRaiderWidget.raidPeriodHours', this.getPeriod());\r\n      window.UI.SuccessMessage('Settings Saved', 2000);\r\n    });\r\n  }\r\n\r\n  applyUserConfig() {\r\n    let haulBonus = userConfig.get('ReportRaiderWidget.haulBonus', 0);\r\n    this.$haulBonus.val(haulBonus);\r\n\r\n    let period = userConfig.get('ReportRaiderWidget.raidPeriodHours', 8);\r\n    this.$period.val(period);\r\n\r\n    let scouts = userConfig.get('ReportRaiderWidget.raidScouts', 0);\r\n    this.$scouts.val(scouts);\r\n\r\n    let raidMode = userConfig.get('ReportRaiderWidget.raidMode', 'scouted');\r\n    this.$raidMode.val(raidMode);\r\n\r\n    this.updateRaiders();\r\n  }\r\n\r\n  updateRaiders() {\r\n    let mode = this.getRaidMode();\r\n    let haulBonus = this.getHaulBonus();\r\n    let period = this.getPeriod();\r\n    let report = this.report;\r\n\r\n    if (mode === 'scouted') {\r\n      let raiders = report.calcRaidScouted(haulBonus);\r\n      this.setRaiders(raiders);\r\n      this.$periodContainer.hide();\r\n    } else if (mode === 'predicted') {\r\n      let raiders = report.calcRaidPredicted(window.game_data.village, TwCheeseDate_TwCheeseDate.newServerDate(), haulBonus);\r\n      this.setRaiders(raiders);\r\n      this.$periodContainer.hide();\r\n    } else if (mode === 'periodic') {\r\n      let raiders = report.calcRaidPeriodic(period, haulBonus);\r\n      this.setRaiders(raiders);\r\n      this.$periodContainer.show();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {TroopCounts} troopCounts\r\n   */\r\n  setRaiders(troopCounts) {\r\n    let spyCount = this.getScouts();\r\n    let attackUrl = (troopType, count) => {\r\n      return attackPrepUrl({spy: spyCount, [troopType]: count}, this.report.defenderVillage.id);\r\n    }\r\n\r\n    for (let [i, troopType] of Object.entries(this.raiderTroopTypes)) {\r\n      let troopCount = troopCounts[troopType];\r\n      this.$raiderTroopCounts.eq(i).text(troopCount);\r\n      if (!this.mayFillRallyPoint()) {\r\n        continue;\r\n      }\r\n      let url = attackUrl(troopType, Math.round(troopCount));\r\n      this.$raiderLinks.eq(i).attr('href', url);\r\n    }\r\n  }\r\n\r\n  getRaidMode() {\r\n    return this.$raidMode.val();\r\n  }\r\n\r\n  getHaulBonus() {\r\n    return parseFloat(this.$haulBonus.val()) || 0;\r\n  }\r\n\r\n  getPeriod() {\r\n    return parseFloat(this.$period.val()) || 0;\r\n  }\r\n\r\n  getScouts() {\r\n    return parseFloat(this.$scouts.val()) || 0;\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportRenamerWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportRenamerWidget_ReportRenamerWidget extends AbstractWidget {\r\n\r\n  /**\r\n   * @param {ReportRenamer} renamer\r\n   * @param {BattleReport} report\r\n   */\r\n  constructor(renamer, report) {\r\n    super();\r\n    this.renamer = renamer;\r\n    this.report = report;\r\n\r\n    this.initStructure();\r\n    this.watchSelf();\r\n    this.applyUserConfig();\r\n  }\r\n\r\n  initStructure() {\r\n    this.$el = $(this.createHtml().trim());\r\n    this.$note = this.$el.find('#twcheese_note');\r\n    this.$renameButton = this.$el.find('button');\r\n    this.$autoRename = this.$el.find('#twcheese_auto_rename');\r\n    this.$namePreview = this.$el.find('#twcheese_rename_preview');\r\n    this.$availableChars = this.$el.find('#twcheese_availableCharacters');\r\n  }\r\n\r\n  createHtml() {\r\n    let renamer = this.renamer;\r\n    let name = renamer.createName(this.report, '');\r\n\r\n    return `\r\n            <div id=\"twcheese_renamer\" align=\"center\">\r\n                <span align=\"center\"><h2>Renamer</h2></span>\r\n                note <input id=\"twcheese_note\" type=\"text\"/>\r\n                <button>rename</button>\r\n                <input id=\"twcheese_auto_rename\" type=\"checkbox\" />auto rename\r\n                <img id=\"twcheese_autoRenameInfo\" src=\"${ImageSrc.info}\" width=\"13\" height=\"13\" title=\"automatically rename reports when the BRE is used\" />\r\n                <br/> characters available: <span id=\"twcheese_availableCharacters\">${renamer.availableChars(name)}</span>\r\n                <br/><b>Preview: </b><span id=\"twcheese_rename_preview\">${UI_escapeHtml(name)}</span>\r\n            </div>\r\n        `;\r\n  }\r\n\r\n  watchSelf() {\r\n    let renamer = this.renamer;\r\n\r\n    this.$note.on('input', () => {\r\n      let name = renamer.createName(this.report, this.$note.val());\r\n      this.$namePreview.text(name);\r\n      this.$availableChars.text(renamer.availableChars(name));\r\n    });\r\n\r\n    this.$renameButton.on('click', () => {\r\n      this.renamer.rename(this.report, this.$note.val());\r\n    });\r\n\r\n    this.$autoRename.on('click', function () {\r\n      userConfig.set('BattleReportEnhancer.autoRename', this.checked);\r\n    });\r\n  }\r\n\r\n  applyUserConfig() {\r\n    let autoRename = userConfig.get('BattleReportEnhancer.autoRename', false);\r\n    this.$autoRename.prop('checked', autoRename);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportToolsWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportToolsWidget_ReportToolsWidget extends AbstractWidget {\r\n\r\n  /**\r\n   * @param {BattleReport} report\r\n   * @param {ReportRenamer} renamer\r\n   */\r\n  constructor(report, renamer) {\r\n    super();\r\n    this.report = report;\r\n    this.renamer = renamer;\r\n    this.initStructure();\r\n    this.watchSelf();\r\n    this.applyUserConfig();\r\n    this.initChildWidgets();\r\n  }\r\n\r\n  initStructure() {\r\n    this.$el = $(this.createHtml().trim());\r\n    this.$content = this.$el.find('.widget_content');\r\n    this.$toggleIcon = this.$el.find('.twcheese-toggle-icon');\r\n    this.$raiderContainer = this.$el.find('.twcheese-raider-container');\r\n    this.$renamerContainer = this.$el.find('.twcheese-renamer-container');\r\n  }\r\n\r\n  createHtml() {\r\n    return `\r\n            <div id=\"twcheese_show_report_tools\" class=\"vis widget\">\r\n                <h4>\r\n                    Report Tools\r\n                    <img class=\"twcheese-toggle-icon\" src=\"${ImageSrc.plus}\" style=\"float:right; cursor:pointer;\">\r\n                </h4>\r\n                <div class=\"widget_content\" style=\"display: none\">\r\n                    <table id=\"twcheese_BRE_tools\" border=\"1\">\r\n                        <tr>\r\n                            <td class=\"twcheese-raider-container\" valign=\"top\"></td>\r\n                            <td valign=\"top\">\r\n                                ${this.createDemolitionTableHtml()}\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td class=\"twcheese-renamer-container\" colspan=\"2\" valign=\"top\"></td>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        `;\r\n  }\r\n\r\n  createDemolitionTableHtml() {\r\n    let report = this.report;\r\n    if (!report.buildingLevels) {\r\n      return '';\r\n    }\r\n\r\n    if (report.buildingLevels) {\r\n      let catHeaders = [];\r\n      let ramHeaders = [];\r\n      let catRowOne = [];\r\n      let catRowTwo = [];\r\n      let ramRowOne = [];\r\n      let ramRowTwo = [];\r\n\r\n      let suggestedCounts = report.suggestSiegeUnits();\r\n\r\n      for (let buildingType of buildingUtil.buildingTypesOnWorld()) {\r\n        let siegeWeapon = (buildingType === 'wall') ? 'ram' : 'catapult';\r\n\r\n        let headerInnerHtml;\r\n        if (game_data.market == 'uk') {\r\n          headerInnerHtml = '<img src=\"' + ImageSrc.buildingIcon(buildingType) + '\" />';\r\n        } else {\r\n          let troopCounts = {[siegeWeapon]: suggestedCounts.oneShotUpgraded[buildingType]};\r\n          let rallyPointUrl = attackPrepUrl(troopCounts, report.defenderVillage.id);\r\n          headerInnerHtml = '<a href=\"' + rallyPointUrl + '\"><img src=\"' + ImageSrc.buildingIcon(buildingType) + '\" /></a>';\r\n        }\r\n        let headers = (siegeWeapon === 'ram') ? ramHeaders : catHeaders;\r\n        headers.push(`<td style=\"width: 35px;\">${headerInnerHtml}</td>`);\r\n\r\n        let rowOne = (siegeWeapon === 'ram') ? ramRowOne : catRowOne;\r\n        let rowTwo = (siegeWeapon === 'ram') ? ramRowTwo : catRowTwo;\r\n        rowOne.push(`<td>${suggestedCounts.oneShotScouted[buildingType]}</td>`);\r\n        rowTwo.push(`<td>${suggestedCounts.oneShotUpgraded[buildingType]}</td>`);\r\n      }\r\n\r\n      let demolitionHtml = `\r\n                <table id=\"twcheese_demolition_calculator\">\r\n                    <tr>\r\n                        <td><span align=\"center\"><h2>Demolition</h2></span></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <table id=\"twcheese_demolition_units\" class=\"vis overview_table\" style=\"border: 1px solid;\">\r\n                                <tr class=\"center\">\r\n                                    <td colspan=\"${catHeaders.length}\">\r\n                                        <img src=\"${ImageSrc.troopIcon('catapult')}\" alt=\"catapults\" />\r\n                                    </td>\r\n                                    <td colspan=\"${ramHeaders.length}\">\r\n                                        <img src=\"${ImageSrc.troopIcon('ram')}\" alt=\"rams\" />\r\n                                    </td>\r\n                                </tr>\r\n                                <tr class=\"center\">${catHeaders.join('') + ramHeaders.join('')}</tr>\r\n                                <tr class=\"center\">${catRowOne.join('') + ramRowOne.join('')}</tr>\r\n                                <tr class=\"center\">${catRowTwo.join('') + ramRowTwo.join('')}<tr/>\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            `;\r\n\r\n      return demolitionHtml.trim();\r\n    }\r\n  }\r\n\r\n  watchSelf() {\r\n    this.$toggleIcon.on('click', () => {\r\n      this.toggleCollapsed();\r\n    });\r\n  }\r\n\r\n  applyUserConfig() {\r\n    if (!userConfig.get('ReportToolsWidget.collapse', false)) {\r\n      this.toggleCollapsed();\r\n    }\r\n  }\r\n\r\n  toggleCollapsed() {\r\n    this.$content.toggle({\r\n      duration: 200,\r\n      start: () => {\r\n        let willCollapse = this.$toggleIcon.attr('src').includes(ImageSrc.minus);\r\n        this.$toggleIcon.attr('src', willCollapse ? ImageSrc.plus : ImageSrc.minus);\r\n        userConfig.set('ReportToolsWidget.collapse', willCollapse);\r\n      }\r\n    });\r\n  }\r\n\r\n  initChildWidgets() {\r\n    (new ReportRenamerWidget_ReportRenamerWidget(this.renamer, this.report))\r\n      .appendTo(this.$renamerContainer);\r\n\r\n    (new ReportRaiderWidget_ReportRaiderWidget(this.report))\r\n      .appendTo(this.$raiderContainer);\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/columnCategories.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar columnCategories_language = {\"twcheese\": {}};\r\nswitch (game_data.market) {\r\n  default:\r\n    /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n    columnCategories_language['twcheese']['Building'] = 'Building';\r\n    break;\r\n\r\n  case 'cz':\r\n    /*==== divokekmeny.cz/ ====*/\r\n    columnCategories_language['twcheese']['Building'] = 'budově';\r\n    break;\r\n\r\n  case 'se':\r\n    columnCategories_language['twcheese']['Building'] = 'Byggnad';\r\n    break;\r\n\r\n  /*==== fyletikesmaxes.gr/ ====*/\r\n  case 'gr':\r\n    columnCategories_language['twcheese']['Building'] = 'Κτίριο';\r\n    break;\r\n\r\n  /* Norwegian */\r\n  case 'no':\r\n    columnCategories_language['twcheese']['Building'] = 'Bygning';\r\n    break;\r\n\r\n}\r\n\r\n\r\nfunction centeredImg(src, tooltip = '') {\r\n  return `<img style=\"display:block; margin-left:auto; margin-right:auto\" src=\"${src}\" title=\"${tooltip}\">`;\r\n}\r\n\r\n\r\nfunction villageLink(village) {\r\n  let url = gameUrl('info_village', {id: village.id});\r\n  return `<a href=\"${url}\">${village.x}|${village.y}</a>`;\r\n}\r\n\r\n\r\nclass ColumnCategories extends Map {\r\n\r\n  getHideableCategories() {\r\n    return this.toArray().filter(category => category.hideable);\r\n  }\r\n\r\n  toArray() {\r\n    return [...this.values()];\r\n  }\r\n}\r\n\r\n\r\nlet columnCategories_cfg = [\r\n  {\r\n    key: 'essential',\r\n    hideable: false,\r\n    cols: [{\r\n      width: 120,\r\n      header: '',\r\n      createCellHtml(report) {\r\n        let icons = [`<img src=\"${ImageSrc.dotIcon(report.dotColor)}\">`];\r\n        if (report.haulStatus !== BattleReportCondensed_BattleReportCondensed.HAUL_STATUS_UNKNOWN) {\r\n          icons.push(`<img src=\"${report.haulStatusIconSrc()}\">`);\r\n        }\r\n        if (report.isForwarded) {\r\n          icons.push('<img src=\"graphic/forwarded.png?1\">');\r\n        }\r\n        let html = `<input name=\"id_${report.reportId}\" type=\"checkbox\"> ${icons.join(' ')}\r\n                    <a href=\"${gameUrl('report', {mode: game_data.mode, view: report.reportId})}\"> view</a>\r\n                `;\r\n        if (report.defenderName && report.defenderVillage) {\r\n          let isDefenderMe = report.defenderName == game_data.player.name;\r\n          let wasVillageConquered = report.loyalty && report.loyalty.after <= 0;\r\n          if (isDefenderMe || wasVillageConquered) {\r\n            html += `<a href=\"${gameUrl('place', {mode: 'units', village: report.defenderVillage.id})}\">\r\n                            <img title=\"manage troops\" style=\"float:right; cursor:pointer;\" src=\"${ImageSrc.buildingIcon('place')}\" />\r\n                        </a>`;\r\n          }\r\n        }\r\n        return html;\r\n      }\r\n    }]\r\n  },\r\n\r\n  {\r\n    key: 'attackIcons',\r\n    hideable: true,\r\n    description: 'Attack icons',\r\n    cols: [{\r\n      width: 50,\r\n      header: '',\r\n      createCellHtml: (report) => {\r\n        return report.attackIcons.getIcons().map(icon => {\r\n          return `<img title=\"${escapeHtml(icon.description)}\" src=\"${icon.src}\">`\r\n        }).join(' ');\r\n      }\r\n    }]\r\n  },\r\n\r\n  {\r\n    key: 'distance',\r\n    hideable: true,\r\n    description: 'Distance',\r\n    cols: [{\r\n      width: 60,\r\n      header: 'Distance',\r\n      createCellHtml: (report) => report.defenderDistance(game_data.village)\r\n    }]\r\n  },\r\n\r\n  {\r\n    key: 'repeatLinks',\r\n    hideable: true,\r\n    description: 'Links to repeat attack',\r\n    cols: [{\r\n      width: 50,\r\n      header: 'Repeat',\r\n      createCellHtml(report) {\r\n        if (report.attackerName !== game_data.player.name) {\r\n          return '';\r\n        }\r\n        let url = gameUrl('place', {try: 'confirm', type: 'same', report_id: report.reportId});\r\n        let html = `<a title=\"repeat attack, from current village\" href=\"${url}\"><img src=\"${ImageSrc.attack}\"></a>`;\r\n        if (report.attackerVillage && report.attackerVillage.id) {\r\n          let url = gameUrl('place', {\r\n            try: 'confirm',\r\n            type: 'same',\r\n            report_id: report.reportId,\r\n            village: report.attackerVillage.id\r\n          });\r\n          html += ` | <a title=\"repeat attack, from original village\" href=\"${url}\"><img src=\"${ImageSrc.attack}\"></a>`;\r\n        }\r\n        return html;\r\n      }\r\n    }]\r\n  },\r\n\r\n  {\r\n    key: 'fullSubject',\r\n    hideable: true,\r\n    startHidden: true,\r\n    description: 'Full subject',\r\n    cols: [{\r\n      width: 400,\r\n      header: 'Subject',\r\n      createCellHtml: (report) => report.subject\r\n    }]\r\n  },\r\n  {\r\n    key: 'note',\r\n    hideable: true,\r\n    startHidden: true,\r\n    description: 'Note',\r\n    cols: [{\r\n      width: 200,\r\n      header: 'Note',\r\n      createCellHtml: (report) => report.note || ''\r\n    }]\r\n  },\r\n  {\r\n    key: 'attackerName',\r\n    hideable: true,\r\n    description: 'Attacker',\r\n    cols: [{\r\n      width: 150,\r\n      header: 'Attacker',\r\n      createCellHtml: (report) => report.attackerName || ''\r\n    }]\r\n  },\r\n  {\r\n    key: 'defenderName',\r\n    hideable: true,\r\n    description: 'Defender',\r\n    cols: [{\r\n      width: 150,\r\n      header: 'Defender',\r\n      createCellHtml: (report) => report.defenderName || ''\r\n    }]\r\n  },\r\n  {\r\n    key: 'attackerVillage',\r\n    hideable: true,\r\n    description: `Attacker's village`,\r\n    cols: [{\r\n      width: 70,\r\n      header: 'Origin',\r\n      createCellHtml(report) {\r\n        if (!report.attackerVillage) {\r\n          return '';\r\n        }\r\n        return villageLink(report.attackerVillage);\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'defenderVillage',\r\n    hideable: true,\r\n    description: `Defender's village`,\r\n    cols: [{\r\n      width: 70,\r\n      header: 'Target',\r\n      createCellHtml(report) {\r\n        if (!report.defenderVillage) {\r\n          return '';\r\n        }\r\n        return villageLink(report.defenderVillage);\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'feint',\r\n    hideable: true,\r\n    description: 'Feint',\r\n    cols: [{\r\n      width: 50,\r\n      header: 'Feint',\r\n      createCellHtml(report) {\r\n        if (report.wasAttackFeint) {\r\n          return centeredImg('graphic/dots/grey.png?1', 'The attack contained only a small amount of units');\r\n        }\r\n        return '';\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'deadNoble',\r\n    hideable: true,\r\n    description: 'Attacking noble died',\r\n    cols: [{\r\n      width: 50,\r\n      header: 'Noble',\r\n      createCellHtml(report) {\r\n        if (!report.attackerNobleDied) {\r\n          return '';\r\n        }\r\n        let img = centeredImg(ImageSrc.troopIcon('priest'), 'An attacking nobleman died.');\r\n        if (report.attackerVillage && report.attackerName === game_data.player.name) {\r\n          let url = gameUrl('snob', {village: report.attackerVillage.id});\r\n          return `<a href=\"${url}\">${img}</a>`;\r\n        }\r\n        return img;\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'loyalty',\r\n    hideable: true,\r\n    description: 'Loyalty reported',\r\n    cols: [{\r\n      width: 50,\r\n      header: 'Loyalty',\r\n      createCellHtml(report) {\r\n        if (report.loyalty) {\r\n          return '<span class=\"icon ally lead\" title=\"Loyalty change\"></span> ' + report.loyalty.after;\r\n        }\r\n        return '';\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'defenderSurvivors',\r\n    hideable: true,\r\n    description: 'Troops: Defense remaining',\r\n    title: 'Defense remaining',\r\n    cols: troopUtil.troopTypesOnWorld().map(troopType => {\r\n      return {\r\n        width: 20,\r\n        align: 'center',\r\n        header: centeredImg(ImageSrc.troopIcon(troopType)),\r\n        createCellHtml(report) {\r\n          if (!report.defenderSurvivors) {\r\n            return '';\r\n          }\r\n          let survivorCount = report.defenderSurvivors[troopType];\r\n          return survivorCount;\r\n        },\r\n        cssClass(report) {\r\n          if (!report.defenderSurvivors) {\r\n            return '';\r\n          }\r\n          let survivorCount = report.defenderSurvivors[troopType];\r\n          return (survivorCount === 0) ? 'unit-item hidden' : '';\r\n        }\r\n      };\r\n    })\r\n  },\r\n\r\n  ...buildingUtil.buildingTypesOnWorld().map(function (buildingType) {\r\n    return {\r\n      key: 'buildingLevels.' + buildingType,\r\n      hideable: true,\r\n      description: columnCategories_language['twcheese']['Building'] + ': ' + textScraper.t(`buildings.${buildingType}`),\r\n      cols: [{\r\n        width: 20,\r\n        align: 'center',\r\n        header: centeredImg(ImageSrc.buildingIcon(buildingType)),\r\n        createCellHtml(report) {\r\n          if (!report.buildingLevels) {\r\n            return '';\r\n          }\r\n          let level = report.buildingLevels[buildingType];\r\n          if (level === '?') {\r\n            return '';\r\n          }\r\n          return level;\r\n        },\r\n        cssClass(report) {\r\n          if (!report.buildingLevels) {\r\n            return '';\r\n          }\r\n          let level = report.buildingLevels[buildingType];\r\n          return ['?', 0].includes(level) ? 'hidden' : '';\r\n        }\r\n      }]\r\n    };\r\n  }),\r\n\r\n  ...Resources_Resources.TYPES.map(function (resType) {\r\n    let resName = {wood: 'Timber', stone: 'Clay', iron: 'Iron'}[resType];\r\n    return {\r\n      key: `resources.${resType}`,\r\n      hideable: true,\r\n      description: `Resources: ${resName}`,\r\n      cols: [{\r\n        width: 16,\r\n        align: 'center',\r\n        header: centeredImg(ImageSrc[resType]),\r\n        createCellHtml(report) {\r\n          if (!report.resources) {\r\n            return '';\r\n          }\r\n          return window.Format.number(report.resources[resType].amount);\r\n        },\r\n        cssClass(report) {\r\n          if (!report.resources) {\r\n            return '';\r\n          }\r\n          return (report.resources[resType].amount === 0) ? 'hidden' : '';\r\n        }\r\n      }]\r\n    };\r\n  }),\r\n\r\n  {\r\n    key: 'resources.sum',\r\n    hideable: true,\r\n    description: 'Resources: Total',\r\n    cols: [{\r\n      width: 40,\r\n      align: 'center',\r\n      header: 'Total',\r\n      createCellHtml(report) {\r\n        if (!report.resources) {\r\n          return '';\r\n        }\r\n        return window.Format.number(report.resources.sum());\r\n      },\r\n      cssClass(report) {\r\n        if (!report.resources) {\r\n          return '';\r\n        }\r\n        return (report.resources.sum() === 0) ? 'hidden' : '';\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'timelaunched',\r\n    hideable: true,\r\n    description: 'Time: Attack launched',\r\n    cols: [{\r\n      width: 170,\r\n      header: 'Launched',\r\n      createCellHtml(report) {\r\n        if (!report.timeLaunched) {\r\n          return '';\r\n        }\r\n        return report.timeLaunched.toHtml(false);\r\n      }\r\n    }]\r\n  },\r\n  {\r\n    key: 'strTimeReceived',\r\n    hideable: true,\r\n    description: 'Time: Report received',\r\n    cols: [{\r\n      width: 140,\r\n      header: 'Received',\r\n      createCellHtml: (report) => report.strTimeReceived || ''\r\n    }]\r\n  }\r\n];\r\n\r\nlet columnCategories = new ColumnCategories();\r\nfor (let category of columnCategories_cfg) {\r\n  columnCategories.set(category.key, category);\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportListWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction cellAtIndex(row, i) {\r\n  let endIndex = -1;\r\n  for (let cell of row.cells) {\r\n    let initialColSpan = cell.initialColSpan || cell.colSpan;\r\n    endIndex += initialColSpan;\r\n    if (endIndex >= i) {\r\n      return cell;\r\n    }\r\n  }\r\n}\r\n\r\n\r\nclass ReportListWidget_ReportListWidget extends AbstractWidget {\r\n  /**\r\n   * @param {Map.<number, BattleReportCondensed>} reports\r\n   */\r\n  constructor(reports) {\r\n    super();\r\n    this.reports = reports;\r\n    this.columnIndexes = new Map();\r\n\r\n    this.initStructure();\r\n    this.$el.resizable();\r\n    this.watchSelf();\r\n  }\r\n\r\n  initStructure() {\r\n    var reportsFolderDisplay = document.createElement('div');\r\n    reportsFolderDisplay.id = 'twcheese_reportsFolderDisplay';\r\n    reportsFolderDisplay.style.overflow = 'hidden';\r\n    reportsFolderDisplay.style.position = 'relative';\r\n    reportsFolderDisplay.style.width = '646px';\r\n    reportsFolderDisplay.style.height = '400px';\r\n    reportsFolderDisplay.style.minHeight = '100px';\r\n    reportsFolderDisplay.style.minWidth = '100px';\r\n\r\n    /*==== reports table header ====*/\r\n    var reportsTableHeaderDiv = document.createElement('div');\r\n    reportsFolderDisplay.appendChild(reportsTableHeaderDiv);\r\n    reportsTableHeaderDiv.style.overflow = 'hidden';\r\n\r\n    var reportsTableHeader = document.createElement('table');\r\n    reportsTableHeaderDiv.appendChild(reportsTableHeader);\r\n    reportsTableHeader.style.tableLayout = 'fixed';\r\n    reportsTableHeader.style.width = '2370px';\r\n    reportsTableHeader.id = 'twcheese_reportsTable_header';\r\n\r\n    /*==== create headers ====*/\r\n    reportsTableHeader.insertRow(-1);\r\n    reportsTableHeader.insertRow(-1);\r\n    reportsTableHeader.insertRow(-1);\r\n\r\n    let cellIndex = 0;\r\n    for (let category of columnCategories.values()) {\r\n      let titleTh = document.createElement('th');\r\n      titleTh.innerHTML = category.title || '';\r\n      titleTh.initialColSpan = category.cols.length;\r\n      titleTh.colSpan = category.cols.length;\r\n      reportsTableHeader.rows[1].appendChild(titleTh);\r\n\r\n      let widthSum = 0;\r\n      let colIndexes = [];\r\n      for (let col of category.cols) {\r\n        let alignmentTh = document.createElement('th');\r\n        alignmentTh.style.width = col.width + 'px';\r\n        alignmentTh.style.paddingTop = 0;\r\n        alignmentTh.style.paddingBottom = 0;\r\n        reportsTableHeader.rows[0].appendChild(alignmentTh);\r\n\r\n        let lowerTh = document.createElement('th');\r\n        lowerTh.innerHTML = col.header;\r\n        reportsTableHeader.rows[2].appendChild(lowerTh);\r\n\r\n        widthSum += col.width;\r\n        colIndexes.push(cellIndex);\r\n        cellIndex++;\r\n      }\r\n      let borderSpacing = 2 * (category.cols.length - 1);\r\n      titleTh.style.width = (widthSum + borderSpacing) + 'px';\r\n      this.columnIndexes.set(category.key, colIndexes);\r\n    }\r\n\r\n    /*==== reports table body ====*/\r\n    var reportsTableBodyDiv = document.createElement('div');\r\n    reportsFolderDisplay.appendChild(reportsTableBodyDiv);\r\n    reportsTableBodyDiv.style.overflow = 'hidden';\r\n    reportsTableBodyDiv.style.height = Number(400 - 20 - reportsTableHeaderDiv.clientHeight) + 'px';\r\n    reportsTableBodyDiv.style.width = '646px';\r\n    reportsTableBodyDiv.id = 'twcheese_reportsTable';\r\n\r\n\r\n    var reportsTableBody = document.createElement('table');\r\n    reportsTableBodyDiv.appendChild(reportsTableBody);\r\n    reportsTableBody.style.tableLayout = 'fixed';\r\n    reportsTableBody.style.width = '2370px';\r\n    reportsTableBody.id = 'twcheese_reportsTable_body';\r\n    reportsTableBody.className = 'vis';\r\n\r\n    /*==== create first row to match widths to header table ====*/\r\n    reportsTableBody.insertRow(-1);\r\n    for (let alignmentTh of reportsTableHeader.rows[0].cells) {\r\n      let alignmentCell = reportsTableBody.rows[0].insertCell(-1);\r\n      alignmentCell.style.width = alignmentTh.style.width;\r\n      alignmentCell.style.paddingTop = 0;\r\n      alignmentCell.style.paddingBottom = 0;\r\n    }\r\n\r\n    /*==== y scroll panel====*/\r\n    var yScrollPanel = document.createElement('div');\r\n    yScrollPanel.id = 'twcheese_reportsDisplay_yScrollPanel';\r\n    reportsFolderDisplay.appendChild(yScrollPanel);\r\n    yScrollPanel.style.overflowY = 'scroll';\r\n    yScrollPanel.style.overflowX = 'hidden';\r\n    yScrollPanel.style.background = 'transparent';\r\n    yScrollPanel.style.position = 'absolute';\r\n    yScrollPanel.style.right = 0;\r\n    yScrollPanel.style.scrollbarWidth = 'thin';\r\n\r\n    /*==== y table emulator ====*/\r\n    var yTableEmulator = document.createElement('div');\r\n    yTableEmulator.id = 'twcheese_reportsDisplay_y-table-emulator';\r\n    yScrollPanel.appendChild(yTableEmulator);\r\n    yTableEmulator.style.overflow = 'hidden';\r\n    yTableEmulator.style.position = 'relative';\r\n    yTableEmulator.innerHTML = '&nbsp;';\r\n\r\n    /*==== x scroll panel ====*/\r\n    var xScrollPanel = document.createElement('div');\r\n    xScrollPanel.id = 'twcheese_reportsDisplay_xScrollPanel';\r\n    reportsFolderDisplay.appendChild(xScrollPanel);\r\n    xScrollPanel.style.height = '40px';\r\n    xScrollPanel.style.width = `calc(100% - 18px)`;\r\n    xScrollPanel.style.marginTop = '-23px';\r\n    xScrollPanel.style.overflowX = 'scroll';\r\n    xScrollPanel.style.overflowY = 'hidden';\r\n    xScrollPanel.style.marginTop = 'expression(\\'0px\\')';// IE 7 fix\r\n    xScrollPanel.style.height = 'expression(\\'17px\\')'; // IE 7 fix\r\n\r\n    /*==== x table emulator ====*/\r\n    var xTableEmulator = document.createElement('div');\r\n    xTableEmulator.id = 'twcheese_reportsDisplay_x-table-emulator';\r\n    xScrollPanel.appendChild(xTableEmulator);\r\n    xTableEmulator.style.width = reportsTableHeader.clientWidth + 'px';\r\n    xTableEmulator.innerHTML = '&nbsp;';\r\n\r\n    this.$el = $(reportsFolderDisplay);\r\n    this.$head = this.$el.find('#twcheese_reportsTable_header');\r\n    this.$body = this.$el.find('#twcheese_reportsTable_body');\r\n    this.$bodyPane = this.$el.find('#twcheese_reportsTable');\r\n    this.$xBodyEmulator = this.$el.find('#twcheese_reportsDisplay_x-table-emulator');\r\n    this.$yBodyEmulator = this.$el.find('#twcheese_reportsDisplay_y-table-emulator');\r\n    this.$xScrollPanel = this.$el.find('#twcheese_reportsDisplay_xScrollPanel');\r\n    this.$yScrollPanel = this.$el.find('#twcheese_reportsDisplay_yScrollPanel');\r\n  }\r\n\r\n\r\n  afterInsert() {\r\n    let $headContainer = this.$head.parent();\r\n    this.$yScrollPanel.css({\r\n      top: $headContainer.outerHeight() + 2\r\n    });\r\n    this.populateReportsTable();\r\n    this.applySettings();\r\n  }\r\n\r\n\r\n  watchSelf() {\r\n    this.$el.on('resize', (e) => {\r\n      this.fitDisplayComponents();\r\n      userConfig.set('ReportListWidget.size.width', this.$el.width());\r\n      userConfig.set('ReportListWidget.size.height', this.$el.height());\r\n    });\r\n\r\n    this.$bodyPane.on('scroll', (e) => {\r\n      this.$xScrollPanel.scrollTop(this.$bodyPane.scrollTop());\r\n    });\r\n\r\n    this.$yScrollPanel.on('scroll', (e) => {\r\n      this.$bodyPane.scrollTop(this.$yScrollPanel.scrollTop());\r\n    });\r\n\r\n    this.$xScrollPanel.on('scroll', (e) => {\r\n      this.$bodyPane.scrollLeft(this.$xScrollPanel.scrollLeft());\r\n      this.$head.parent().scrollLeft(this.$xScrollPanel.scrollLeft());\r\n    });\r\n\r\n    this.$bodyPane.on('wheel', (e) => {\r\n      e.preventDefault();\r\n      let deltaY = 90 * Math.sign(e.originalEvent.deltaY);\r\n\r\n      let timeStart = performance.now();\r\n      let animDurationMs = 250;\r\n      let y = 0;\r\n\r\n      let scrollStep = () => {\r\n        let msElapsed = performance.now() - timeStart;\r\n        let targetY = deltaY * Math.min(1, msElapsed / animDurationMs);\r\n        let stepY = targetY - y;\r\n\r\n        y += stepY;\r\n        this.$yScrollPanel[0].scrollTop += stepY;\r\n        this.$bodyPane[0].scrollTop += stepY;\r\n\r\n        if (msElapsed < animDurationMs) {\r\n          window.requestAnimationFrame(scrollStep);\r\n        }\r\n      }\r\n      window.requestAnimationFrame(scrollStep);\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * fills body with information\r\n   */\r\n  populateReportsTable() {\r\n    let minimal = new Set(['essential', 'attackIcons', 'repeatLinks', 'distance', 'fullSubject', 'strTimeReceived']);\r\n\r\n    let fallbackSubjectColSpan = columnCategories.toArray().reduce(function (acc, category) {\r\n      if (category.key !== 'fullSubject' && minimal.has(category.key)) {\r\n        return acc;\r\n      }\r\n      return acc + category.cols.length;\r\n    }, 0);\r\n\r\n    for (let report of this.reports.values()) {\r\n      let row = this.$body[0].insertRow(-1);\r\n      row.twcheeseReport = report;\r\n      let hasDecentInfo = report.attackerName && report.defenderName && report.attackerVillage && report.defenderVillage;\r\n\r\n      for (let category of columnCategories.values()) {\r\n        if (!hasDecentInfo && !minimal.has(category.key)) {\r\n          continue;\r\n        }\r\n        for (let col of category.cols) {\r\n          let cell = row.insertCell(-1);\r\n          cell.innerHTML = col.createCellHtml(report);\r\n          if (typeof col.align === 'string') {\r\n            cell.style.textAlign = col.align;\r\n          }\r\n          if (typeof col.cssClass === 'function') {\r\n            cell.className = col.cssClass(report);\r\n          }\r\n          if (!hasDecentInfo && category.key === 'fullSubject') {\r\n            cell.initialColSpan = fallbackSubjectColSpan;\r\n            cell.colSpan = cell.initialColSpan;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.alignForTroops();\r\n    this.alignForResources();\r\n    this.adjustScrollbars();\r\n  }\r\n\r\n\r\n  /**\r\n   * hides columns and resizes to user's preferences\r\n   */\r\n  applySettings() {\r\n    for (let category of columnCategories.values()) {\r\n      if (!userConfig.get(`ReportListWidget.showCols.${category.key}`, !category.startHidden)) {\r\n        this.hideColumns(category.key);\r\n      }\r\n    }\r\n\r\n    this.$el.css({\r\n      width: userConfig.get('ReportListWidget.size.width', '720px'),\r\n      height: userConfig.get('ReportListWidget.size.height', '250px')\r\n    });\r\n\r\n    this.fitDisplayComponents();\r\n    this.adjustScrollbars();\r\n  }\r\n\r\n\r\n  adjustScrollbars() {\r\n    this.$xBodyEmulator.width(this.$body.width());\r\n    this.$yBodyEmulator.height(this.$body.height());\r\n  }\r\n\r\n\r\n  toggleReportsColumns(settingName) {\r\n    let startHidden = columnCategories.get(settingName).startHidden;\r\n    let configKey = `ReportListWidget.showCols.${settingName}`;\r\n    let show = !userConfig.get(configKey, !startHidden);\r\n    userConfig.set(configKey, show);\r\n\r\n    for (let i of this.columnIndexes.get(settingName)) {\r\n      if (show) {\r\n        this.showColumn(i);\r\n      } else {\r\n        this.hideColumn(i);\r\n      }\r\n    }\r\n    this.adjustScrollbars();\r\n  }\r\n\r\n\r\n  hideColumns(settingName) {\r\n    for (let i of this.columnIndexes.get(settingName)) {\r\n      this.hideColumn(i);\r\n    }\r\n  }\r\n\r\n\r\n  showColumn(column) {\r\n    var body = this.$body[0];\r\n    var head = this.$head[0];\r\n\r\n    var tableWidth = head.style.width.split('px')[0];\r\n\r\n    /*==== header ====*/\r\n    let alignmentTh = cellAtIndex(head.rows[0], column);\r\n    let columnWidth = alignmentTh.style.width.split('px')[0];\r\n    tableWidth = parseFloat(tableWidth) + parseFloat(columnWidth);\r\n    head.style.width = tableWidth + 'px';\r\n\r\n    alignmentTh.style.display = \"table-cell\";\r\n    cellAtIndex(head.rows[1], column).style.display = \"table-cell\";\r\n    head.rows[2].cells[column].style.display = \"table-cell\";\r\n\r\n    /*==== body ====*/\r\n    body.style.width = tableWidth + 'px';\r\n    for (let row of body.rows) {\r\n      let cell = cellAtIndex(row, column);\r\n\r\n      if (cell.initialColSpan && cell.initialColSpan > 1) {\r\n        cell.colSpan += 1;\r\n      } else {\r\n        cell.style.display = 'table-cell';\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  hideColumn(column) {\r\n    var body = this.$body[0];\r\n    var head = this.$head[0];\r\n\r\n    var tableWidth = head.style.width.split('px')[0];\r\n\r\n    /*==== header ====*/\r\n    let alignmentTh = cellAtIndex(head.rows[0], column);\r\n    let columnWidth = alignmentTh.style.width.split('px')[0];\r\n    tableWidth = parseFloat(tableWidth) - parseFloat(columnWidth);\r\n    head.style.width = tableWidth + 'px';\r\n\r\n    alignmentTh.style.display = \"none\";\r\n    cellAtIndex(head.rows[1], column).style.display = \"none\";\r\n    head.rows[2].cells[column].style.display = \"none\";\r\n\r\n    /*==== body ====*/\r\n    body.style.width = tableWidth + 'px';\r\n    for (let row of body.rows) {\r\n      let cell = cellAtIndex(row, column);\r\n\r\n      if (cell.initialColSpan && cell.initialColSpan > 1) {\r\n        cell.colSpan -= 1;\r\n      } else {\r\n        cell.style.display = 'none';\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  getSelectedReportIds() {\r\n    return this.$body.find('input:checked')\r\n      .toArray()\r\n      .map(el => parseInt(el.name.match(/\\d+/)[0]));\r\n  }\r\n\r\n  refreshContents() {\r\n    this.$body.find('tr:not(:first)').remove();\r\n    this.populateReportsTable();\r\n    this.applySettings();\r\n  }\r\n\r\n  /**\r\n   * sets display components styles to fill the display zone and ensure scrolling functionality\r\n   */\r\n  fitDisplayComponents() {\r\n    let bodyPaneHeight = this.$el.height() - 67;\r\n\r\n    this.$bodyPane.css({\r\n      width: this.$el.width(),\r\n      height: bodyPaneHeight\r\n    });\r\n\r\n    this.$yScrollPanel.css({height: bodyPaneHeight});\r\n  }\r\n\r\n\r\n  /**\r\n   * adjust widths for troop counts\r\n   */\r\n  alignForTroops() {\r\n    let colIndexes = this.columnIndexes.get('defenderSurvivors');\r\n\r\n    let maxChars = Array(colIndexes.length).fill(2);\r\n\r\n    for (let r = 1; r < this.$body[0].rows.length; r++) {\r\n      let row = this.$body[0].rows[r];\r\n      if (!row.twcheeseReport.defenderSurvivors) {\r\n        continue;\r\n      }\r\n      for (let [i, col] of Object.entries(colIndexes)) {\r\n        let chars = String(row.cells[col].innerHTML).length;\r\n        maxChars[i] = Math.max(chars, maxChars[i]);\r\n      }\r\n    }\r\n\r\n    this.alignCols(colIndexes, maxChars);\r\n  }\r\n\r\n\r\n  /**\r\n   * adjust widths for resources\r\n   */\r\n  alignForResources() {\r\n    let colIndexes = [\r\n      ...this.columnIndexes.get('resources.wood'),\r\n      ...this.columnIndexes.get('resources.stone'),\r\n      ...this.columnIndexes.get('resources.iron'),\r\n      ...this.columnIndexes.get('resources.sum'),\r\n    ];\r\n\r\n    let maxChars = [2, 2, 2, 2];\r\n\r\n    for (let r = 1; r < this.$body[0].rows.length; r++) {\r\n      let row = this.$body[0].rows[r];\r\n      if (!row.twcheeseReport.resources) {\r\n        continue;\r\n      }\r\n      for (let [i, col] of Object.entries(colIndexes)) {\r\n        let chars = row.cells[col].innerText.length;\r\n        maxChars[i] = Math.max(chars, maxChars[i]);\r\n      }\r\n    }\r\n\r\n    this.alignCols(colIndexes, maxChars);\r\n  }\r\n\r\n\r\n  alignCols(colIndexes, maxChars) {\r\n    let charWidth = 8;\r\n    let widthSum = 0;\r\n    for (let [i, col] of Object.entries(colIndexes)) {\r\n      let width = charWidth * maxChars[i];\r\n      width = Math.max(20, width);\r\n      widthSum += width;\r\n\r\n      let alignmentTh = this.$head[0].rows[0].cells[col];\r\n      let bodyCell = this.$body[0].rows[0].cells[col];\r\n\r\n      alignmentTh.style.width = width + 'px';\r\n      bodyCell.style.width = width + 'px';\r\n    }\r\n\r\n    let padding = 3 * 2 * colIndexes.length;\r\n    let borderSpacing = 2 * (colIndexes.length - 1);\r\n    let width = widthSum + borderSpacing + padding;\r\n\r\n    let titleTh = cellAtIndex(this.$head[0].rows[1], colIndexes[0]);\r\n    titleTh.style.width = width + 'px';\r\n  }\r\n\r\n\r\n  selectMatchingReports(isReportMatch) {\r\n    for (let report of this.reports.values()) {\r\n      if (isReportMatch(report)) {\r\n        $(`input[name='id_${report.reportId}']`).prop('checked', true);\r\n      }\r\n    }\r\n  }\r\n\r\n  deselectAllReports() {\r\n    for (let report of this.reports.values()) {\r\n      $(`input[name='id_${report.reportId}']`).prop('checked', false);\r\n    }\r\n  }\r\n\r\n}\r\n\r\n\r\n// jquery-ui. Used for resizable\r\ninitCss(`\r\n    .ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\r\n\r\n    /* Icons\r\n    ----------------------------------*/\r\n\r\n    .ui-icon {\r\n        display: block;\r\n        text-indent: -99999px;\r\n        overflow: hidden;\r\n        background-repeat: no-repeat;\r\n    }\r\n\r\n    .ui-icon {\r\n        width: 16px;\r\n        height: 16px;\r\n    }\r\n    .ui-icon,\r\n    .ui-widget-content .ui-icon {\r\n        background-image: url(${ImageSrc.jq.darkGrey});\r\n    }\r\n    .ui-widget-header .ui-icon {\r\n        background-image: url(${ImageSrc.jq.black});\r\n    }\r\n    .ui-state-default .ui-icon {\r\n        background-image: url(${ImageSrc.jq.grey});\r\n    }\r\n    .ui-state-hover .ui-icon,\r\n    .ui-state-focus .ui-icon {\r\n        background-image: url(${ImageSrc.jq.darkGrey});\r\n    }\r\n    .ui-state-active .ui-icon {\r\n        background-image: url(${ImageSrc.jq.darkGrey});\r\n    }\r\n    .ui-state-highlight .ui-icon {\r\n        background-image: url(${ImageSrc.jq.blue});\r\n    }\r\n    .ui-state-error .ui-icon,\r\n    .ui-state-error-text .ui-icon {\r\n        background-image: url(${ImageSrc.jq.red});\r\n    }\r\n\r\n    /* Overlays */\r\n    .ui-widget-overlay {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .ui-resizable {\r\n        position: relative;\r\n    }\r\n    .ui-resizable-handle {\r\n        position: absolute;\r\n        font-size: 0.1px;\r\n        display: block;\r\n    }\r\n    .ui-resizable-disabled .ui-resizable-handle,\r\n    .ui-resizable-autohide .ui-resizable-handle {\r\n        display: none;\r\n    }\r\n    .ui-resizable-n {\r\n        cursor: n-resize;\r\n        height: 7px;\r\n        width: 100%;\r\n        top: -5px;\r\n        left: 0;\r\n    }\r\n    .ui-resizable-s {\r\n        cursor: s-resize;\r\n        height: 7px;\r\n        width: 100%;\r\n        bottom: -5px;\r\n        left: 0;\r\n    }\r\n    .ui-resizable-e {\r\n        cursor: e-resize;\r\n        width: 7px;\r\n        right: -5px;\r\n        top: 0;\r\n        height: 100%;\r\n    }\r\n    .ui-resizable-w {\r\n        cursor: w-resize;\r\n        width: 7px;\r\n        left: -5px;\r\n        top: 0;\r\n        height: 100%;\r\n    }\r\n    .ui-resizable-se {\r\n        cursor: se-resize;\r\n        width: 12px;\r\n        height: 12px;\r\n        right: 1px;\r\n        bottom: 1px;\r\n    }\r\n    .ui-resizable-sw {\r\n        cursor: sw-resize;\r\n        width: 9px;\r\n        height: 9px;\r\n        left: -5px;\r\n        bottom: -5px;\r\n    }\r\n    .ui-resizable-nw {\r\n        cursor: nw-resize;\r\n        width: 9px;\r\n        height: 9px;\r\n        left: -5px;\r\n        top: -5px;\r\n    }\r\n    .ui-resizable-ne {\r\n        cursor: ne-resize;\r\n        width: 9px;\r\n        height: 9px;\r\n        right: -5px;\r\n        top: -5px;\r\n    }\r\n`);\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/DisplayConfigurer.js\n\r\n\r\n\r\n\r\n\r\nclass DisplayConfigurer_DisplayConfigurer {\r\n  /**\r\n   * @param {ReportListWidget} reportListWidget\r\n   */\r\n  constructor(reportListWidget) {\r\n    this.widget = reportListWidget;\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   * @return {boolean}\r\n   */\r\n  shouldShowColumn(key) {\r\n    let startHidden = columnCategories.get(key).startHidden;\r\n    return userConfig.get(`ReportListWidget.showCols.${key}`, !startHidden);\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   */\r\n  toggleColumn(key) {\r\n    this.widget.toggleReportsColumns(key);\r\n  }\r\n\r\n  /**\r\n   * @return {{key:string, description:string}}\r\n   */\r\n  getHideableColumns() {\r\n    return columnCategories.getHideableCategories()\r\n      .map(category => {\r\n        return {\r\n          key: category.key,\r\n          description: category.description\r\n        }\r\n      });\r\n  }\r\n\r\n  refreshDisplay() {\r\n    this.widget.refreshContents();\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/DisplayConfigWidget.js\n\r\n\r\n\r\nclass DisplayConfigWidget_DisplayConfigWidget extends AbstractWidget {\r\n\r\n  /**\r\n   * @param {DisplayConfigurer} displayConfigurer\r\n   */\r\n  constructor(displayConfigurer) {\r\n    super();\r\n\r\n    var reportsFolderSettingsDiv = document.createElement('div');\r\n    reportsFolderSettingsDiv.id = 'twcheese_reportsFolderSettings';\r\n    reportsFolderSettingsDiv.style.display = 'none';\r\n    reportsFolderSettingsDiv.style.columnWidth = '200px';\r\n    this.$el = $(reportsFolderSettingsDiv);\r\n\r\n    function insertCheckbox(key, text) {\r\n      let $el = $(`<div style=\"white-space:nowrap\"><label><input type=\"checkbox\"> ${text}</label></div>`);\r\n      $el.find('input')\r\n        .prop('checked', displayConfigurer.shouldShowColumn(key))\r\n        .on('click', () => {\r\n          displayConfigurer.toggleColumn(key);\r\n        });\r\n\r\n      reportsFolderSettingsDiv.appendChild($el[0]);\r\n    }\r\n\r\n    for (let col of displayConfigurer.getHideableColumns()) {\r\n      insertCheckbox(col.key, col.description);\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/Exporter.js\n\r\n\r\n\r\nclass Exporter_Exporter {\r\n\r\n  /**\r\n   * @param {BattleReportCondensed[]} reports\r\n   * @param {string} attackFrom\r\n   * @param {string} headerText\r\n   * @return {string}\r\n   */\r\n  buildExportText(reports, attackFrom, headerText) {\r\n    let exportText = this.buildHeader(headerText);\r\n\r\n    for (let report of reports) {\r\n      if (!report.defenderVillage) {\r\n        continue; // not enough information\r\n      }\r\n      if (report.attackerName !== game_data.player.name) {\r\n        continue; // can't repeat somebody else's attack\r\n      }\r\n      if (attackFrom === Exporter_Exporter.ATTACK_FROM_CURRENT) {\r\n        exportText += \"\\n\" + this.buildEntryCurrentVillage(report);\r\n      } else if (attackFrom === Exporter_Exporter.ATTACK_FROM_ORIGINAL && report.attackerVillage) {\r\n        exportText += \"\\n\" + this.buildEntryOriginalVillage(report);\r\n      }\r\n    }\r\n\r\n    exportText += \"\\n\" + this.buildFooter();\r\n    return exportText;\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  urlCurrentVillage(report) {\r\n    return gameUrl('place', {try: 'confirm', type: 'same', report_id: report.reportId});\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  urlOriginalVillage(report) {\r\n    return gameUrl('place', {\r\n      try: 'confirm',\r\n      type: 'same',\r\n      report_id: report.reportId,\r\n      village: report.attackerVillage.id\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {string} text\r\n   * @return {string}\r\n   */\r\n  buildHeader(text) {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryCurrentVillage(report) {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryOriginalVillage(report) {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @return {string}\r\n   */\r\n  buildFooter() {\r\n    throw Error('not implemented');\r\n  }\r\n\r\n}\r\n\r\nExporter_Exporter.ATTACK_FROM_CURRENT = 'current';\r\nExporter_Exporter.ATTACK_FROM_ORIGINAL = 'original';\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/ExporterBBCode.js\n\r\n\r\n\r\nclass ExporterBBCode_ExporterBBCode extends Exporter_Exporter {\r\n\r\n  /**\r\n   * @param {string} text\r\n   * @return {string}\r\n   */\r\n  buildHeader(text) {\r\n    return `[b][u][size=12]${text}[/size][/u][/b]`;\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryCurrentVillage(report) {\r\n    return '[url=' + this.urlCurrentVillage(report) + ']repeat attack ' + report.reportId + ' from (' + game_data.village.coord + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')[/url]';\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryOriginalVillage(report) {\r\n    return '[url=' + this.urlOriginalVillage(report) + ']repeat attack ' + report.reportId + ' from (' + report.attackerVillage.x + '|' + report.attackerVillage.y + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')[/url]';\r\n  }\r\n\r\n  /**\r\n   * @return {string}\r\n   */\r\n  buildFooter() {\r\n    return '';\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/ExporterPlainText.js\n\r\n\r\n\r\nclass ExporterPlainText_ExporterPlainText extends Exporter_Exporter {\r\n\r\n  /**\r\n   * @param {string} text\r\n   * @return {string}\r\n   */\r\n  buildHeader(text) {\r\n    return text;\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryCurrentVillage(report) {\r\n    return this.urlCurrentVillage(report);\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryOriginalVillage(report) {\r\n    return this.urlOriginalVillage(report);\r\n  }\r\n\r\n  /**\r\n   * @return {string}\r\n   */\r\n  buildFooter() {\r\n    return '';\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Models/RepeatAttackLinks/ExporterHTML.js\n\r\n\r\n\r\nclass ExporterHTML_ExporterHTML extends Exporter_Exporter {\r\n\r\n  /**\r\n   * @param {string} text\r\n   * @return {string}\r\n   */\r\n  buildHeader(text) {\r\n    return [\r\n      '<!DOCTYPE NETSCAPE-Bookmark-file-1>\\n<META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; charset=UTF-8\">',\r\n      `\\n<DT><H3>${text}</H3></DT>\\n<DL><P>`\r\n    ].join('');\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryCurrentVillage(report) {\r\n    let leadingZero = '';\r\n    let distance = report.defenderDistance(game_data.village);\r\n    if (distance < 10) {\r\n      leadingZero = '0';\r\n    }\r\n    return '<DT><A HREF=\"' + this.urlCurrentVillage(report) + '\" >' + leadingZero + distance + ' Repeat Attack ' + report.reportId + ' from (' + game_data.village.coord + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')</A></DT>';\r\n  }\r\n\r\n  /**\r\n   * @param {BattleReportCondensed} report\r\n   * @return {string}\r\n   */\r\n  buildEntryOriginalVillage(report) {\r\n    return '<DT><A HREF=\"' + this.urlOriginalVillage(report) + '\" >Repeat Attack ' + report.reportId + ' from (' + report.attackerVillage.x + '|' + report.attackerVillage.y + ') to (' + report.defenderVillage.x + '|' + report.defenderVillage.y + ')</A></DT>';\r\n  }\r\n\r\n  /**\r\n   * @return {string}\r\n   */\r\n  buildFooter() {\r\n    return '</P></DL>';\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ExportRepeatLinksWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\nclass ExportRepeatLinksWidget_ExportRepeatLinksWidget extends AbstractWidget {\r\n\r\n  /**\r\n   * @param {Map.<BattleReportCondensed>} reports\r\n   */\r\n  constructor(reports) {\r\n    super();\r\n    this.reports = reports;\r\n    this.defaultHeader = 'new cheesy attack group';\r\n\r\n    this.exporters = {\r\n      bbcode: new ExporterBBCode_ExporterBBCode(),\r\n      plainLink: new ExporterPlainText_ExporterPlainText(),\r\n      html: new ExporterHTML_ExporterHTML()\r\n    };\r\n\r\n    this.initStructure();\r\n    this.watchSelf();\r\n    this.updateExportText();\r\n  }\r\n\r\n  initStructure() {\r\n    this.$el = $(this.createHtml().trim());\r\n    this.$exportText = this.$el.find('.twcheese-export-text');\r\n    this.$buttonCopy = this.$el.find('.twcheese-button-copy');\r\n    this.$headerInput = this.$el.find('#twcheese_export_header');\r\n    this.$formatOptions = this.$el.find(\"input[name='twcheese-repeat-attack-export-format']\");\r\n    this.$attackingVillageOptions = this.$el.find(\"input[name='twcheese-repeat-attack-export-village']\");\r\n  }\r\n\r\n  createHtml() {\r\n    return `\r\n            <table id=\"twcheese_reportsFolderExport\" style=\"display: none;\">\r\n                <td>\r\n                    <textarea class=\"twcheese-export-text\" rows=\"10\" cols=\"40\" readonly=\"true\" />\r\n                </td>\r\n                <td>\r\n                    <table id=\"twcheese_exportConfigTable\">\r\n                        <tr>\r\n                            <th>Format</th>\r\n                            <th>Attacking Village</th>\r\n                        </tr>\r\n                        <tr>\r\n                            <td>\r\n                                <input type=\"radio\" name=\"twcheese-repeat-attack-export-format\" checked=\"true\" value=\"bbcode\"/> BBCode\r\n                                <br/><input type=\"radio\" name=\"twcheese-repeat-attack-export-format\" value=\"plainLink\"/> plain links\r\n                                <br/><input type=\"radio\" name=\"twcheese-repeat-attack-export-format\" value=\"html\"/> HTML\r\n                            </td>\r\n                            <td>\r\n                                <input type=\"radio\" name=\"twcheese-repeat-attack-export-village\" checked=\"true\" value=\"current\"/> current village\r\n                                <br/><input type=\"radio\" name=\"twcheese-repeat-attack-export-village\" value=\"original\"/> original village\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td colspan=\"2\">\r\n                                Header: <input type=\"text\" id=\"twcheese_export_header\" value=\"${this.defaultHeader}\" />\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <td colspan=\"2\" style=\"text-align: center; padding-top: 20px;\">\r\n                                <a class=\"twcheese-button-copy btn btn-default\" href=\"#\">Copy to clipboard</a>\r\n                            </td>\r\n                        </tr>\r\n                    </table>\r\n                </td>\r\n            </table>\r\n        `;\r\n  }\r\n\r\n  watchSelf() {\r\n    this.$headerInput.on('click', () => {\r\n      if (this.$headerInput.val() === this.defaultHeader) {\r\n        this.$headerInput.val('');\r\n      }\r\n      this.updateExportText();\r\n    });\r\n\r\n    this.$headerInput.on('input', (e) => {\r\n      this.updateExportText();\r\n    });\r\n\r\n    this.$formatOptions.on('change', (e) => {\r\n      this.updateExportText();\r\n    });\r\n\r\n    this.$attackingVillageOptions.on('change', (e) => {\r\n      this.updateExportText();\r\n    });\r\n\r\n    this.$buttonCopy.on('click', (e) => {\r\n      e.preventDefault();\r\n      this.$exportText.select();\r\n      document.execCommand('copy');\r\n      window.UI.SuccessMessage('Copied to clipboard');\r\n    });\r\n  }\r\n\r\n  updateExportText() {\r\n    let format = this.$formatOptions.filter(':checked').val();\r\n    let attackFrom = this.$attackingVillageOptions.filter(':checked').val();\r\n    let headerText = this.$headerInput.val();\r\n\r\n    let exporter = this.exporters[format];\r\n    let exportText = exporter.buildExportText(this.reports.values(), attackFrom, headerText);\r\n    this.$exportText.val(exportText);\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportSelector.js\nclass ReportSelector {\r\n\r\n  /**\r\n   * @param {ReportListWidget} reportListWidget\r\n   */\r\n  constructor(reportListWidget) {\r\n    this.widget = reportListWidget;\r\n  }\r\n\r\n  /**\r\n   * @return {number[]}\r\n   */\r\n  getSelectedReportIds() {\r\n    return this.widget.getSelectedReportIds();\r\n  }\r\n\r\n  selectNew() {\r\n    this.widget.selectMatchingReports((report) => {\r\n      // console.log(`Report: ${JSON.stringify(report)} and reportIsNew ${report.isNew}`);\r\n      return report.isNew;\r\n    });\r\n  }\r\n\r\n  selectUnconverted() {\r\n    this.widget.selectMatchingReports((report) => {\r\n      return report.unconverted;\r\n    });\r\n  }\r\n\r\n  selectOld() {\r\n    this.widget.selectMatchingReports(report => !report.isNew);\r\n  }\r\n\r\n  selectAll() {\r\n    this.widget.selectMatchingReports(report => true);\r\n  }\r\n\r\n  selectNone() {\r\n    this.widget.deselectAllReports();\r\n  }\r\n\r\n  selectDotColor(dotColor) {\r\n    this.widget.selectMatchingReports(report => report.dotColor === dotColor);\r\n  }\r\n\r\n  selectForwarded() {\r\n    this.widget.selectMatchingReports(report => report.isForwarded);\r\n  }\r\n\r\n  /**\r\n   * @param {number} haulStatus 0 for non full haul, 1 for full haul\r\n   */\r\n  selectLoot(haulStatus) {\r\n    this.widget.selectMatchingReports(report => report.haulStatus === haulStatus);\r\n  }\r\n\r\n  selectFeint() {\r\n    this.widget.selectMatchingReports(report => report.wasAttackFeint);\r\n  }\r\n\r\n  selectDeadNoble() {\r\n    this.widget.selectMatchingReports(report => report.attackerNobleDied);\r\n  }\r\n\r\n  selectLoyalty() {\r\n    this.widget.selectMatchingReports(report => report.loyalty !== null);\r\n  }\r\n\r\n  selectCleared() {\r\n    this.widget.selectMatchingReports(report => report.wasDefenderCleared());\r\n  }\r\n\r\n  selectText(text) {\r\n    let textLower = text.toLowerCase();\r\n    this.widget.selectMatchingReports(report => report.subject.toLowerCase().includes(textLower));\r\n  }\r\n\r\n  selectAttacker(attackerName) {\r\n    let nameLower = attackerName.toLowerCase();\r\n    this.widget.selectMatchingReports(report => report.attackerName && report.attackerName.toLowerCase().includes(nameLower));\r\n  }\r\n\r\n  selectDefender(defenderName) {\r\n    let nameLower = defenderName.toLowerCase();\r\n    this.widget.selectMatchingReports(report => report.defenderName && report.defenderName.toLowerCase().includes(nameLower));\r\n  }\r\n\r\n  selectAttackerVillage(coordinates) {\r\n    let [, x, y] = coordinates.match(/(\\d+)\\|(\\d+)/);\r\n    x = parseInt(x);\r\n    y = parseInt(y);\r\n\r\n    this.widget.selectMatchingReports(report => {\r\n      if (!report.attackerVillage) {\r\n        return false;\r\n      }\r\n\r\n      return report.attackerVillage.x === x\r\n        && report.attackerVillage.y === y;\r\n    });\r\n  }\r\n\r\n  selectDefenderVillage(coordinates) {\r\n    let [, x, y] = coordinates.match(/(\\d+)\\|(\\d+)/);\r\n    x = parseInt(x);\r\n    y = parseInt(y);\r\n\r\n    this.widget.selectMatchingReports(report => {\r\n      if (!report.defenderVillage) {\r\n        return false;\r\n      }\r\n\r\n      return report.defenderVillage.x === x\r\n        && report.defenderVillage.y === y;\r\n    });\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportSelectorWidget.js\n\r\n\r\n\r\n\r\nclass ReportSelectorWidget_ReportSelectorWidget extends AbstractWidget {\r\n  /**\r\n   * @param {ReportSelector} reportSelector\r\n   */\r\n  constructor(reportSelector) {\r\n    super();\r\n\r\n    var reportsSelectorBar = document.createElement('div');\r\n    this.$el = $(reportsSelectorBar);\r\n    reportsSelectorBar.id = 'twcheese_reportsSelectorBar';\r\n    reportsSelectorBar.style.borderStyle = 'solid';\r\n    reportsSelectorBar.style.borderWidth = '1px';\r\n\r\n    /*==== label ====*/\r\n    var reportsSelectorBarLabel = document.createElement('div');\r\n    reportsSelectorBar.appendChild(reportsSelectorBarLabel);\r\n    reportsSelectorBarLabel.style.backgroundColor = 'rgb(193, 162, 100) !important';\r\n    reportsSelectorBarLabel.style.backgroundImage = 'linear-gradient(rgb(229,194,126), rgb(193,162,100))';\r\n    reportsSelectorBarLabel.style.backgroundRepeat = 'repeat-x';\r\n    reportsSelectorBarLabel.style.fontSize = '9pt';\r\n    reportsSelectorBarLabel.style.fontWeight = '700';\r\n    reportsSelectorBarLabel.innerHTML = 'SELECT';\r\n    reportsSelectorBarLabel.style.height = '18px';\r\n    reportsSelectorBarLabel.style.paddingLeft = '3px';\r\n\r\n    /*==== clicky table ====*/\r\n    var selectorClickyTable = document.createElement('table');\r\n    reportsSelectorBar.appendChild(selectorClickyTable);\r\n    selectorClickyTable.className = 'vis';\r\n    selectorClickyTable.insertRow(-1);\r\n\r\n    let imgHtml = src => `<img style=\"display:block; margin-left:auto; margin-right:auto\" src=\"${src}\"/>`;\r\n\r\n    let clickyOptions = new Map([\r\n      ['all', {\r\n        click: () => reportSelector.selectAll(),\r\n        html: 'all'\r\n      }],\r\n      ['none', {\r\n        click: () => reportSelector.selectNone(),\r\n        html: 'none'\r\n      }],\r\n      ['new', {\r\n        click: () => reportSelector.selectNew(),\r\n        html: 'new'\r\n      }],\r\n      ['old', {\r\n        click: () => reportSelector.selectOld(),\r\n        html: 'old'\r\n      }],\r\n      ['unconverted', {\r\n        click: () => reportSelector.selectUnconverted(),\r\n        html: 'unconverted'\r\n      }],\r\n      ['dotGreen', {\r\n        click: () => reportSelector.selectDotColor('green'),\r\n        html: imgHtml('graphic/dots/green.png')\r\n      }],\r\n      ['dotYellow', {\r\n        click: () => reportSelector.selectDotColor('yellow'),\r\n        html: imgHtml('graphic/dots/yellow.png')\r\n      }],\r\n      ['dotRed', {\r\n        click: () => reportSelector.selectDotColor('red'),\r\n        html: imgHtml('graphic/dots/red.png')\r\n      }],\r\n      ['dotBlue', {\r\n        click: () => reportSelector.selectDotColor('blue'),\r\n        html: imgHtml('graphic/dots/blue.png')\r\n      }],\r\n      ['forwarded', {\r\n        click: () => reportSelector.selectForwarded(),\r\n        html: imgHtml('graphic/forwarded.png'),\r\n        tooltip: 'forwarded report'\r\n      }],\r\n      ['haulPartial', {\r\n        click: () => reportSelector.selectLoot(BattleReportCondensed.HAUL_STATUS_PARTIAL),\r\n        html: imgHtml('graphic/max_loot/0.png')\r\n      }],\r\n      ['haulFull', {\r\n        click: () => reportSelector.selectLoot(BattleReportCondensed.HAUL_STATUS_FULL),\r\n        html: imgHtml('graphic/max_loot/1.png')\r\n      }],\r\n      ['feint', {\r\n        click: () => reportSelector.selectFeint(),\r\n        html: imgHtml('graphic/dots/grey.png'),\r\n        tooltip: 'feint'\r\n      }],\r\n      ['deadNoble', {\r\n        click: () => reportSelector.selectDeadNoble(),\r\n        html: imgHtml(ImageSrc.troopIcon('priest')),\r\n        tooltip: 'dead noble'\r\n      }],\r\n      ['loyalty', {\r\n        click: () => reportSelector.selectLoyalty(),\r\n        html: '<span style=\"display:block; margin-left:auto; margin-right:auto\" class=\"icon ally lead\"/>',\r\n        tooltip: 'loyalty change'\r\n      }],\r\n      ['cleared', {\r\n        click: () => reportSelector.selectCleared(),\r\n        html: 'defenseless'\r\n      }]\r\n    ]);\r\n\r\n    for (let [descriptor, option] of clickyOptions) {\r\n      let optionEl = $(`<a href=\"#\">${option.html}</a>`)[0];\r\n      if (option.tooltip) {\r\n        optionEl.title = option.tooltip;\r\n      }\r\n      optionEl.addEventListener('click', function (e) {\r\n        e.preventDefault();\r\n        option.click();\r\n      });\r\n\r\n      let cell = selectorClickyTable.rows[0].insertCell(-1);\r\n      cell.style.width = '25px';\r\n      cell.style.textAlign = 'center';\r\n      cell.appendChild(optionEl);\r\n    }\r\n\r\n    /*==== input table ====*/\r\n    var selectorInputTable = document.createElement('table');\r\n    reportsSelectorBar.appendChild(selectorInputTable);\r\n    selectorInputTable.className = 'vis';\r\n    selectorInputTable.insertRow(-1);\r\n\r\n    let inputOptions = [\r\n      {\r\n        hintInput: 'contains text',\r\n        hintButton: 'select text',\r\n        use: (text) => reportSelector.selectText(text),\r\n        sprite: [-140, 0]\r\n      },\r\n      {\r\n        hintInput: 'attacker',\r\n        hintButton: 'select attacking player',\r\n        use: (attackerName) => reportSelector.selectAttacker(attackerName),\r\n        sprite: [-80, 0]\r\n      },\r\n      {\r\n        hintInput: 'defender',\r\n        hintButton: 'select defending player',\r\n        use: (defenderName) => reportSelector.selectDefender(defenderName),\r\n        sprite: [-80, 0]\r\n      },\r\n      {\r\n        hintInput: 'origin',\r\n        hintButton: 'select attacking village',\r\n        placeholder: 'x|y',\r\n        use: (coords) => reportSelector.selectAttackerVillage(coords),\r\n        sprite: [-120, 0]\r\n      },\r\n      {\r\n        hintInput: 'target',\r\n        hintButton: 'select defending village',\r\n        placeholder: 'x|y',\r\n        use: (coords) => reportSelector.selectDefenderVillage(coords),\r\n        sprite: [-120, 0]\r\n      }\r\n    ];\r\n\r\n    for (let option of inputOptions) {\r\n      let input = document.createElement('input');\r\n      input.type = 'text';\r\n      input.size = 10;\r\n      input.value = option.hintInput;\r\n      input.placeholder = option.placeholder || '';\r\n      let alreadyCleared = false;\r\n      input.addEventListener('mousedown', function () {\r\n        if (alreadyCleared) {\r\n          return;\r\n        }\r\n        this.value = '';\r\n        alreadyCleared = true;\r\n      });\r\n\r\n      let $button = $(`<a href=\"#\" title=\"${option.hintButton}\"></a>`)\r\n        .on('click', function (e) {\r\n          e.preventDefault();\r\n          option.use(input.value);\r\n        });\r\n\r\n      let $buttonIcon = $('<span>&nbsp;</span>')\r\n        .css({\r\n          display: 'inline-block',\r\n          background: `url(graphic/bbcodes/bbcodes.png) no-repeat ${option.sprite[0]}px ${option.sprite[1]}px`,\r\n          paddingLeft: 0,\r\n          paddingBottom: 0,\r\n          margin: 3,\r\n          width: 20,\r\n          height: 20\r\n        });\r\n\r\n      $button.append($buttonIcon);\r\n\r\n      let cell = selectorInputTable.rows[0].insertCell(-1);\r\n      cell.appendChild(input);\r\n      cell.appendChild($button[0]);\r\n    }\r\n  }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/MassRenamerWidget.js\n\r\n\r\n\r\n\r\n\r\nvar MassRenamerWidget_language = {\"twcheese\": {}};\r\nswitch (game_data.market) {\r\n  default:\r\n    /*==== tribalwars.net, tribalwars.us, tribalwars.co.uk, beta.tribalwars.net ====*/\r\n    MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'You haven\\'t selected any reports to be renamed.';\r\n    break;\r\n\r\n  case 'cz':\r\n    /*==== divokekmeny.cz/ ====*/\r\n    MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Nejdříve si musíte vybrat, které zprávy přejmenovat.';\r\n    break;\r\n\r\n  case 'se':\r\n    MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Du har inte valt några rapporter som skall döpas om.';\r\n    break;\r\n\r\n  /*==== fyletikesmaxes.gr/ ====*/\r\n  case 'gr':\r\n    MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Δεν έχεις επιλέξει  καμιά αναφορά για μετονομασία';\r\n    break;\r\n\r\n  /* Norwegian */\r\n  case 'no':\r\n    MassRenamerWidget_language['twcheese']['noReportsSelected'] = 'Du har ikke valgt hvilke rapporter som skal endres navn på.';\r\n    break;\r\n\r\n}\r\n\r\n\r\nclass MassRenamerWidget_MassRenamerWidget extends AbstractWidget {\r\n\r\n  /**\r\n   * @param {Map.<number, BattleReportCondensed>} reports\r\n   * @param {ReportRenamer} renamer\r\n   * @param {ReportSelector} reportSelector\r\n   * @param {DisplayConfigurer} displayConfigurer\r\n   */\r\n  constructor(reports, renamer, reportSelector, displayConfigurer) {\r\n    super();\r\n    this.reports = reports;\r\n    this.renamer = renamer;\r\n    this.reportSelector = reportSelector;\r\n    this.displayConfigurer = displayConfigurer;\r\n\r\n    this.initStructure();\r\n    this.watchSelf();\r\n  }\r\n\r\n  initStructure() {\r\n    this.$el = $(`\r\n            <table class=\"vis\">\r\n                <tbody>\r\n                    <tr>\r\n                        <td>\r\n                            <a class=\"twcheese-button-rename\" href=\"#\">&raquo; Rename</a>\r\n                            <img src=\"/graphic/questionmark.png?1\" width=\"13\" height=\"13\" title=\"rename selected reports to twCheese format\">\r\n                        </td>\r\n                        <td style=\"textAlign: right;\">Progress:</td>\r\n                        <td style=\"width: 40px;\"><span id=\"twcheese_progress_percent\">0</span>%</td>\r\n                        <td style=\"width: 136px;\">(<span id=\"twcheese_progress_count\">0</span>/<span id=\"twcheese_progress_count_max\">0</span> reports)</td>\r\n                        <td>time remaining: <span id=\"twcheese_time_remaining\">00:00</span></td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n        `.trim());\r\n\r\n    this.$buttonRename = this.$el.find('.twcheese-button-rename');\r\n    this.$progressCount = this.$el.find('#twcheese_progress_count');\r\n    this.$targetCount = this.$el.find('#twcheese_progress_count_max');\r\n    this.$progressPercent = this.$el.find('#twcheese_progress_percent');\r\n    this.$timeRemaining = this.$el.find('#twcheese_time_remaining');\r\n  }\r\n\r\n  watchSelf() {\r\n    this.$buttonRename.on('click', (e) => {\r\n      e.preventDefault();\r\n      this.massRename();\r\n    });\r\n  }\r\n\r\n  async massRename() {\r\n    let reportIds = this.reportSelector.getSelectedReportIds();\r\n    let total = reportIds.length;\r\n    let progress = 0;\r\n\r\n    if (total === 0) {\r\n      window.UI.ErrorMessage(MassRenamerWidget_language['twcheese']['noReportsSelected'], 3000);\r\n      return;\r\n    }\r\n\r\n    this.$progressCount.text(0);\r\n    this.$targetCount.text(total);\r\n\r\n    var estimatedTimeRemaining;\r\n\r\n    /*==== rename reports 1 by 1 ====*/\r\n\r\n    for (let reportId of reportIds) {\r\n      let startTime = performance.now();\r\n\r\n      try {\r\n        let reportDoc = await requestDocument(gameUrl('report', {mode: game_data.mode, view: reportId}));\r\n\r\n        let scraper = new BattleReportScraper_BattleReportScraper(reportDoc);\r\n        let fullReport = scraper.scrapeReport();\r\n        let name = await this.renamer.rename(fullReport, '');\r\n\r\n        $('.quickedit[data-id=\"' + reportId + '\"]')\r\n          .find('.quickedit-label').html(name);\r\n\r\n        /*==== update reports information so row can be redrawn with updated information====*/\r\n\r\n        let oldReport = this.reports.get(reportId);\r\n\r\n        let report = this.renamer.parseName(name);\r\n        report.reportId = reportId;\r\n        report.attackIcons = oldReport.attackIcons;\r\n        report.dotColor = oldReport.dotColor;\r\n        report.haulStatus = oldReport.haulStatus;\r\n        report.isForwarded = oldReport.isForwarded;\r\n        report.strTimeReceived = oldReport.strTimeReceived;\r\n\r\n        this.reports.set(report.reportId, report);\r\n\r\n\r\n        /*==== update progress display ====*/\r\n        progress++;\r\n        var millisElapsed = performance.now() - startTime;\r\n        estimatedTimeRemaining = (millisElapsed * (total - progress)) / 1000;\r\n        var minutesRemaining = Math.floor(estimatedTimeRemaining / 60);\r\n        var secondsRemaining = Math.round(estimatedTimeRemaining - (minutesRemaining * 60));\r\n        if (minutesRemaining < 10)\r\n          minutesRemaining = '0' + minutesRemaining;\r\n        if (secondsRemaining < 10)\r\n          secondsRemaining = '0' + secondsRemaining;\r\n        this.$timeRemaining.text(`${minutesRemaining}:${secondsRemaining}`);\r\n        this.$progressCount.text(progress);\r\n        this.$progressPercent.text(Math.round(progress / total * 100));\r\n      } catch (e) {\r\n        console.error('error renaming report:', e);\r\n      }\r\n\r\n    }\r\n\r\n    this.displayConfigurer.refreshDisplay();\r\n  }\r\n\r\n}\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/Widget/ReportsFolder/ReportsFolderWidget.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass ReportsFolderWidget_ReportsFolderWidget extends AbstractWidget {\r\n  constructor(reports, renamer) {\r\n    super();\r\n    this.reports = reports;\r\n\r\n    let reportListWidget = new ReportListWidget_ReportListWidget(this.reports);\r\n    let displayConfigurer = new DisplayConfigurer_DisplayConfigurer(reportListWidget);\r\n    let reportSelector = new ReportSelector(reportListWidget);\r\n\r\n    /*==== create twcheese reports folder ====*/\r\n    var reportsFolder = document.createElement('div');\r\n    reportsFolder.id = 'twcheese_reportsFolder';\r\n    this.$el = $(reportsFolder);\r\n\r\n    /*==== reports folder toolbar ====*/\r\n    var reportsFolderToolbar = document.createElement('div');\r\n    reportsFolder.appendChild(reportsFolderToolbar);\r\n    reportsFolderToolbar.id = 'twcheese_reportsFolderToolbar';\r\n\r\n    reportsFolderToolbar.currentPanel = 'none';\r\n    reportsFolderToolbar.toggleDisplayConfig = function () {\r\n      if (this.currentPanel == 'displayConfig') {\r\n        document.getElementById('twcheese_displayConfig_tab').className = '';\r\n        document.getElementById('twcheese_reportsFolderSettings').style.display = 'none';\r\n        this.currentPanel = 'none';\r\n      } else {\r\n        document.getElementById('twcheese_displayConfig_tab').className = 'selected';\r\n        document.getElementById('twcheese_export_tab').className = '';\r\n        document.getElementById('twcheese_reportsFolderSettings').style.display = '';\r\n        document.getElementById('twcheese_reportsFolderExport').style.display = 'none';\r\n        this.currentPanel = 'displayConfig';\r\n      }\r\n    };\r\n\r\n    reportsFolderToolbar.toggleExport = function () {\r\n      if (this.currentPanel == 'exportLinks') {\r\n        document.getElementById('twcheese_export_tab').className = '';\r\n        document.getElementById('twcheese_reportsFolderExport').style.display = 'none';\r\n        this.currentPanel = 'none';\r\n      } else {\r\n        document.getElementById('twcheese_export_tab').className = 'selected';\r\n        document.getElementById('twcheese_displayConfig_tab').className = '';\r\n        document.getElementById('twcheese_reportsFolderExport').style.display = '';\r\n        document.getElementById('twcheese_reportsFolderSettings').style.display = 'none';\r\n        this.currentPanel = 'exportLinks';\r\n      }\r\n    };\r\n\r\n    /*==== toolbar tabs ====*/\r\n    reportsFolderToolbar.innerHTML += `\r\n            <table style=\"border-style:solid; border-width:0px;\" class=\"vis modemenu\">\r\n                <tbody>\r\n                    <tr>\r\n                        <td id=\"twcheese_displayConfig_tab\" style=\"border-style:solid; border-width:1px; cursor:default;\" onclick=\"document.getElementById(\\'twcheese_reportsFolderToolbar\\').toggleDisplayConfig();\">\r\n                            <a>configure display</a>\r\n                        </td>\r\n                        <td id=\"twcheese_export_tab\" style=\"border-style:solid; border-width:1px; cursor:default;\" onclick=\"document.getElementById(\\'twcheese_reportsFolderToolbar\\').toggleExport();\">\r\n                            <a>export repeat-attack links</a>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>`;\r\n\r\n\r\n    /*==== export links to repeat attacks ====*/\r\n    let exportLinksWidget = new ExportRepeatLinksWidget_ExportRepeatLinksWidget(this.reports);\r\n    exportLinksWidget.appendTo(reportsFolderToolbar);\r\n\r\n    /*==== display settings ====*/\r\n    (new DisplayConfigWidget_DisplayConfigWidget(displayConfigurer))\r\n      .appendTo(reportsFolderToolbar);\r\n\r\n    /*==== reports display ====*/\r\n    reportListWidget\r\n      .appendTo(reportsFolder);\r\n\r\n    /*==== reports selector bar ====*/\r\n    (new ReportSelectorWidget_ReportSelectorWidget(reportSelector))\r\n      .appendTo(reportsFolder);\r\n\r\n    /*==== mass renamer ====*/\r\n    (new MassRenamerWidget_MassRenamerWidget(this.reports, renamer, reportSelector, displayConfigurer))\r\n      .appendTo(reportsFolder);\r\n\r\n  }\r\n}\r\n\r\n\r\ninitCss(`\r\n    #twcheese_reportsFolder {\r\n        margin-bottom: 30px;\r\n    }\r\n`);\r\n\r\n\r\n\r\n\n// EXTERNAL MODULE: ./src/Models/Debug/Build/ProcessFactory.js\nvar ProcessFactory = __webpack_require__(3);\n\n// CONCATENATED MODULE: ./dist/tool/cfg/debug/BRE/Default.js\nlet processCfg = { phases: [{\"type\":\"PhaseQuestion\",\"internalName\":\"Entry\",\"questions\":[{\"type\":\"QuestionFreeForm\",\"ask\":\"What's broken?\",\"placeholderText\":\"e.g. \\\"it shows wrong OD scores\\\"\",\"minResponseLength\":10}]}] };\r\n\r\n\n// CONCATENATED MODULE: ./src/Prompt/suggestRedirect.js\n\r\n\r\n\r\n\r\nfunction suggestRedirect(options) {\r\n  let {message, screen, screenName, uriParams, skippableId} = options;\r\n  message = message || '{{Some genius forgot to write a message here}}';\r\n  screenName = screenName || '{{Screen Name goes here}}';\r\n  uriParams = uriParams || {};\r\n  if (!screen) {\r\n    throw Error('screen must be specified!');\r\n  }\r\n\r\n  if (skippableId && userConfig.get(skipKey(skippableId), false)) {\r\n    window.UI.InfoMessage(`Redirecting to <strong>${screenName}</strong>...`);\r\n    setTimeout(() => window.TribalWars.redirect(screen, uriParams), 200);\r\n    return;\r\n  }\r\n\r\n  let buttonConfirm = {\r\n    text: 'Take me there!',\r\n    callback: () => {\r\n      if (skippableId) {\r\n        let skipNextTime = $('#twcheese-suggest-redirect-skip').prop('checked');\r\n        userConfig.set(skipKey(skippableId), skipNextTime);\r\n      }\r\n      window.TribalWars.redirect(screen, uriParams);\r\n    },\r\n    confirm: true\r\n  };\r\n  let buttonCancel = {\r\n    text: 'Whatever...',\r\n    callback: () => {\r\n    }\r\n  };\r\n  window.UI.ConfirmationBox(buildContent(message, options), [buttonConfirm, buttonCancel], 'twcheese_suggest_redirect', true, true);\r\n}\r\n\r\n\r\nfunction skipKey(skippableId) {\r\n  return 'suggestRedirect.skip.' + skippableId;\r\n}\r\n\r\n\r\nfunction buildContent(message, options) {\r\n  let html = message;\r\n  if (options.skippableId) {\r\n    html += `<div class=\"twcheese-suggest-redirect-skip-container\">\r\n            <input id=\"twcheese-suggest-redirect-skip\" type=\"checkbox\">\r\n            <span>Don't ask, just take me there next time.</span>\r\n        </div>`\r\n  }\r\n  return html;\r\n}\r\n\r\n\r\ninitCss(`\r\n    .twcheese-suggest-redirect-skip-container {\r\n        margin-top: 20px;\r\n        font-size: 10px;\r\n    }\r\n\r\n    .twcheese-suggest-redirect-skip-container > * {\r\n        vertical-align: middle;\r\n    }\r\n`);\r\n\r\n\r\n\r\n\n// CONCATENATED MODULE: ./src/ToolSetup/BRE.js\n/* global $, game_data */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet initialized = false;\r\nlet reportEnhanced = false;\r\nlet reportsFolderEnhanced = false;\r\n\r\nasync function useTool() {\r\n  if (!initialized) {\r\n    await ensureRemoteConfigsUpdated();\r\n    initBRE();\r\n    initialized = true;\r\n  }\r\n\r\n  if (game_data.screen == 'report' && document.URL.includes('&view=')) {\r\n    // user is viewing single report\r\n    if (!reportEnhanced) {\r\n      enhanceReport();\r\n      reportEnhanced = true;\r\n    }\r\n  } else if ((game_data.screen == 'report' && (game_data.mode == 'attack' || game_data.mode == 'defense'))) {\r\n    // user is viewing reports folder with 'Attacks' or \"Defenses\" filter on\r\n    if (!reportsFolderEnhanced) {\r\n      enhanceReportsFolder();\r\n      reportsFolderEnhanced = true;\r\n    }\r\n  } else if (document.URL.includes(`screen=report`) && (document.URL.includes(`mode=attack`) || document.URL.includes(`mode=defense`))) {\r\n    // user is viewing reports folder with 'Attacks' or \"Defenses\" filter on\r\n    console.warn(`BRE: Reached here because game_data was not set properly: ${game_data}`);\r\n    if (!reportsFolderEnhanced) {\r\n      enhanceReportsFolder();\r\n      reportsFolderEnhanced = true;\r\n    }\r\n  } else {\r\n    suggestRedirect({\r\n      message: 'try using this on:\\n1) a battle report\\n2) a reports folder, with the \"Attacks\" filter on\\n3) a reports folder, with the \"Defenses\" filter on',\r\n      screen: 'report',\r\n      screenName: 'Attacks Report Folder',\r\n      uriParams: {\r\n        mode: 'attack',\r\n      },\r\n      skippableId: 'Tool:BRE'\r\n    });\r\n    // alert('try using this on:\\n1) a battle report\\n2) a reports folder, with the \"Attacks\" filter on\\n3) a reports folder, with the \"Defenses\" filter on');\r\n  }\r\n}\r\n\r\n\r\nfunction initBRE() {\r\n\r\n  /*==== contact information ====*/\r\n  var narcismDiv = document.createElement('div');\r\n  document.getElementById('content_value').insertBefore(narcismDiv, document.getElementById('content_value').firstChild);\r\n  narcismDiv.innerHTML = 'BRE created by <a href=\"https://forum.tribalwars.net/index.php?members/28484\">cheesasaurus</a>' +\r\n    ' and maintained by <a target=\"_blank\" href=\"https://www.github.com/Jopika\">Jopika</a>';\r\n  narcismDiv.style.fontSize = '10px';\r\n\r\n  /*==== help ====*/\r\n  spawnLegacyHelpButton('https://forum.tribalwars.net/index.php?threads/256225/');\r\n}\r\n\r\n\r\nfunction enhanceReport() {\r\n  let scraper = new BattleReportScraper_BattleReportScraper(document);\r\n  let report = scraper.scrapeReport();\r\n\r\n  let renamer = new ReportRenamer_ReportRenamer();\r\n\r\n  $(renamer).on('report-renamed', function (e) {\r\n    $('.quickedit[data-id=\"' + e.reportId + '\"]')\r\n      .find('.quickedit-label')\r\n      .html(e.newName);\r\n  });\r\n\r\n  if (userConfig.get('BattleReportEnhancer.autoRename', false)) {\r\n    renamer.rename(report, '');\r\n  }\r\n\r\n  enhanceBattleReport(document, report);\r\n\r\n  (new ReportToolsWidget_ReportToolsWidget(report, renamer))\r\n    .insertBefore($('#content_value').find('h2').eq(0));\r\n}\r\n\r\n\r\nfunction enhanceReportsFolder() {\r\n  let renamer = new ReportRenamer_ReportRenamer();\r\n\r\n  let oldReportsList = document.getElementById('report_list');\r\n  let reportsForm = oldReportsList.parentNode;\r\n\r\n  // scrape listed reports\r\n  let reportScraper = new BattleReportCondensedScraper_BattleReportCondensedScraper(renamer);\r\n  let reports = new Map();\r\n  for (let report of reportScraper.scrapeReports(oldReportsList)) {\r\n    reports.set(report.reportId, report);\r\n  }\r\n\r\n  // enhance list and add tools\r\n  reportsForm.removeChild(oldReportsList);\r\n\r\n  (new ReportsFolderWidget_ReportsFolderWidget(reports, renamer))\r\n    .insertBefore(reportsForm.firstChild);\r\n}\r\n\r\n\r\n// register tool ///////////////////////////////////////////////////////\r\n\r\nlet processFactory = new ProcessFactory[\"a\" /* ProcessFactory */]({});\r\n\r\nfunction newDebugProcess() {\r\n  let name = 'Tool: Battle Report Enhancer';\r\n  return processFactory.create(name, processCfg, true);\r\n}\r\n\r\n\r\nwindow.TwCheese.registerTool({\r\n  id: 'BRE',\r\n  use: useTool,\r\n  getDebugProcess: newDebugProcess\r\n});\r\n\n\n/***/ })\n/******/ ]);"]}