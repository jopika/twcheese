!function(e){var t={};function s(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=8)}([function(e,t,s){"use strict";s.d(t,"a",function(){return r});const r={PHASE_COMPLETION_READY:"phase_completion_ready",PHASE_COMPLETION_NOT_READY:"phase_completion_not_ready",PHASE_CHANGED:"phase_changed",QUESTION_ANSWERED:"question_answered",QUESTION_NOT_ANSWERED:"question_not_answered",OPTION_VALUE_CHANGED:"answer_value_changed",BUG_REPORT_SUCCEEDED:"bug_report_succeeded",BUG_REPORT_FAILED:"bug_report_failed",USER_REJECTED:"user_rejected"}},function(e,t,s){"use strict";s.d(t,"a",function(){return r});class r{constructor(e){this.name=e,this.followsUpOn=null,this.autoComplete=!1}setFollowsUpOn(e){return this.followsUpOn=e,this}setAutoComplete(e){return this.autoComplete=e,this}getType(){throw Error("notimplemented")}start(){throw Error("not implemented")}checkCompletionReady(){throw Error("not implemented")}getThingsToFollowUpOn(){throw Error("not implemented")}getSummary(){throw Error("not implemented")}}},function(e,t,s){"use strict";s.d(t,"a",function(){return r});const r={ATTEMPT:"attempt",QUESTION:"question",REPORT:"report"}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ProcessFactory});var _src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6),_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7),_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5);function lazyEvalUsingParent(parentPhase){return str=>()=>{let parentResult=parentPhase.result;return eval(str)}}class ProcessFactory{constructor(e){this.phaseFactory=new _src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__.a(e)}create(e,t,s){let r=new _src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__.a(e);for(let e of t.phases)r.enqueuePhase(this.createPhase(e));if(s){let e=new _src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__.a(r);r.enqueuePhase(_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__.a.create(e))}return r}createPhase(e,t){let s=this.phaseFactory.create(e,t);return this.addFollowUpPhasesForSuccess(s,e),this.addFollowUpPhasesForAnswers(s,e),s}addFollowUpPhasesForSuccess(e,t){if("PhaseAttempt"===t.type&&t.success)for(let s of t.success){let t=this.createPhase(s,lazyEvalUsingParent(e));e.addSuccessFollowUp(t)}}addFollowUpPhasesForAnswers(e,t){if("PhaseQuestion"===t.type)for(let[s,r]of Object.entries(t.questions))if("QuestionSelect"===r.type)for(let[t,a]of Object.entries(r.options))if(a.followUp)for(let r of a.followUp){let a=e.questions[s].options[t],n=this.createPhase(r,lazyEvalUsingParent(e));a.addFollowUp(n)}}}},function(e,t,s){"use strict";s.d(t,"a",function(){return a});var r=s(0);class a{constructor(e){this.name=e,this.phases=[],this.currentPhaseIndex=-1}enqueuePhase(e){return this.phases.push(e),this.watchPhase(e),this}insertPhase(e){return this.phases.splice(this.currentPhaseIndex+1,0,e),this.watchPhase(e),this}watchPhase(e){let t=[r.a.PHASE_COMPLETION_READY,r.a.PHASE_COMPLETION_NOT_READY,r.a.PHASE_CHANGED];$(e).on(t.join(" "),e=>$(this).trigger(e.type,e)),$(e).on(r.a.PHASE_COMPLETION_READY,()=>{e.autoComplete&&this.goToNextPhase()})}start(){this.currentPhaseIndex=-1,this.goToNextPhase()}goToNextPhase(){if(this.currentPhaseIndex>=0)for(let e of this.getCurrentPhase().getThingsToFollowUpOn())for(let t of e.followUpPhases)this.insertPhase(t);if(!this.hasNextPhase())throw Error("there's no next phase");this.currentPhaseIndex++,$(this).trigger(r.a.PHASE_CHANGED),this.getCurrentPhase().checkCompletionReady(),this.getCurrentPhase().start()}hasNextPhase(){return this.currentPhaseIndex<this.phases.length-1}getCurrentPhase(){return this.phases[this.currentPhaseIndex]}getSummarySoFar(){return this.phases.slice(0,this.currentPhaseIndex).map(e=>e.getSummary())}static create(e){return new a(e)}}},function(e,t,s){"use strict";s.d(t,"a",function(){return o});var r=s(1),a=s(0),n=s(2);const i={SUCCESS:"success",FAIL:"fail",NOT_ATTEMPTED:"not_attempted"};class o extends r.a{constructor(e){super("send bug report"),this.bugReporter=e,this.status=i.NOT_ATTEMPTED,this.error}getType(){return n.a.REPORT}start(){let e=this.bugReporter.buildReport();this.bugReporter.submitReport(e).then(e=>{this.status=i.SUCCESS,$(this).trigger({type:a.a.BUG_REPORT_SUCCEEDED,url:e.html_url})}).catch(e=>{this.error=e,this.status=i.FAIL,$(this).trigger(a.a.BUG_REPORT_FAILED)}).finally(()=>this.checkCompletionReady())}checkCompletionReady(){this.status!==i.NOT_ATTEMPTED?$(this).trigger(a.a.PHASE_COMPLETION_READY):$(this).trigger(a.a.PHASE_COMPLETION_NOT_READY)}getThingsToFollowUpOn(){return[]}getSummary(){return{phaseName:this.name}}static create(e){return new o(e)}}},function(e,t,s){"use strict";var r=s(1),a=s(0),n=s(2);const i={SUCCESS:"success",FAIL:"fail",NOT_ATTEMPTED:"not_attempted"};class o extends r.a{constructor(e,t){super(e),this.instructions,this.attempt=t,this.success=(async()=>{}),this.fail=(async()=>{}),this.status=i.NOT_ATTEMPTED,this.autoComplete=!0,this._error,this._result,this.summarizeData=(e=>e),this.ctrl={},this.successFollowUpPhases=[]}getType(){return n.a.ATTEMPT}get result(){if(this.status===i.NOT_ATTEMPTED)throw new Error("tried to get result before the attempt settled");if(this.status===i.FAIL)throw new Error("tried to get result of an attempt that failed");return this._result}async doAttempt(){try{let e=await this.abortableAttempt();this.status=i.SUCCESS,this._result=e,await this.success(e)}catch(e){console.warn(e),this.status=i.FAIL,this._error=e,await this.fail(e)}this.checkCompletionReady()}async abortableAttempt(){return new Promise(async(e,t)=>{$(this.ctrl).on(a.a.USER_REJECTED,()=>t("user rejected"));try{let s;this.followsUpOn&&(s=this.followsUpOn.result),e(await this.attempt(s,this.ctrl))}catch(e){t(e)}})}userAbort(){$(this.ctrl).trigger(a.a.USER_REJECTED)}setInstructions(e){return this.instructions=e,this}setDataSummarizer(e){return this.summarizeData=e,this}onSuccess(e){return this.success=e,this}addSuccessFollowUp(e){return this.successFollowUpPhases.push(e),e.setFollowsUpOn(this),this}get followUpPhases(){return this.status===i.SUCCESS?this.successFollowUpPhases:[]}onFail(e){return this.fail=e,this}start(){this.doAttempt()}checkCompletionReady(){this.status!==i.NOT_ATTEMPTED?$(this).trigger(a.a.PHASE_COMPLETION_READY):$(this).trigger(a.a.PHASE_COMPLETION_NOT_READY)}getThingsToFollowUpOn(){return[this]}getSummary(){return{phaseName:this.name,status:this.status,data:void 0===this._result?this._result:this.summarizeData(this._result),error:this.summarizeError()}}summarizeError(){let e=this._error;return e instanceof Error?{message:e.message,name:e.name,extra:e.extra,stack:e.stack}:e}static create(e,t){return new o(e,t)}}class l extends r.a{constructor(e){super(e),this.questions=[],this._examinedHtml}getType(){return n.a.QUESTION}lookAt(e){return this._examinedHtml=e,this}get examinedHtml(){return"function"==typeof this._examinedHtml?this._examinedHtml():this._examinedHtml}addQuestion(e){return this.questions.push(e),$(e).on(a.a.QUESTION_ANSWERED,()=>{this.checkCompletionReady()}),$(e).on(a.a.QUESTION_NOT_ANSWERED,()=>{this.checkCompletionReady()}),this}start(){}checkCompletionReady(){for(let e of this.questions)if(!e.isAnswered())return void $(this).trigger(a.a.PHASE_COMPLETION_NOT_READY);$(this).trigger(a.a.PHASE_COMPLETION_READY)}getThingsToFollowUpOn(){return this.questions.reduce((e,t)=>e.concat(t.getThingsToFollowUpOn()),[])}getSummary(){return{phaseName:this.name,questions:this.questions.map(e=>e.getSummary())}}static create(e){return new l(e)}}const c={VALUE:"value",FREE_FORM:"free_form",SELECT:"select"};class u{constructor(e){this.text=e,this.options=[],this.selectedOptionIndex=null}getType(){throw Error("not implemented")}addOption(e){return this.options.push(e),this}setSelectedOption(e){return this.selectedOptionIndex=e,$(this).trigger(a.a.QUESTION_ANSWERED),this}isAnswered(){return null!==this.selectedOptionIndex}getSelectedOption(){return this.options[this.selectedOptionIndex]}getThingsToFollowUpOn(){let e=this.getSelectedOption();return e.followUpPhases.length>0?[e]:[]}getSummary(){return{question:this.text,answer:this.getSelectedOption().value}}static create(e){return new u(e)}}class h extends u{getType(){return c.SELECT}static create(e){return new h(e)}}class p{constructor(e,t,s=""){this.text=e,this.value=t,this.className=s,this.followUpPhases=[]}addFollowUp(e){return this.followUpPhases.push(e),e.setFollowsUpOn(this),this}setValue(e){this.value=e,$(this).trigger(a.a.OPTION_VALUE_CHANGED)}static create(e,t,s){return new p(e,t,s)}}class d extends u{constructor(e,t,s=0){super(e),this.minResponseLength=s,this.options=[p.create(t,"","free-form")],this.setSelectedOption(0),this.watchSelectedOption()}getType(){return c.FREE_FORM}watchSelectedOption(){$(this.getSelectedOption()).on(a.a.OPTION_VALUE_CHANGED,()=>{this.isAnswered()?$(this).trigger(a.a.QUESTION_ANSWERED):$(this).trigger(a.a.QUESTION_NOT_ANSWERED)})}isAnswered(){return super.isAnswered()&&this.options[0].value.length>=this.minResponseLength}static create(e,t,s){return new d(e,t,s)}}const g={CORRECT:"correct",INCORRECT:"incorrect",NOT_SURE:"not_sure"},_=1;class m extends u{constructor(e,t){super(e),this._valueQuestioned=t,this.options=[p.create("Correct",g.CORRECT,"correct"),p.create("Incorrect",g.INCORRECT,"incorrect"),p.create("Not sure",g.NOT_SURE,"not-sure")]}get value(){return"function"==typeof this._valueQuestioned?this._valueQuestioned():this._valueQuestioned}getType(){return c.VALUE}addFollowUp(e){return this.options[_].addFollowUp(e),this}getSummary(){return Object.assign(super.getSummary(),{valueChecked:this.value})}static create(e,t){return new m(e,t)}}class E{create(e,t){switch(e.type){case"QuestionFreeForm":return this.createQuestionFreeForm(e);case"QuestionSelect":return this.createQuestionSelect(e);case"QuestionValue":return this.createQuestionValue(e,t);default:throw`unrecognized question type: ${e.type}`}}createQuestionFreeForm(e){let t=e.minResponseLength||0;return d.create(e.ask,e.placeholderText,t)}createQuestionSelect(e){let t=h.create(e.ask);for(let s of e.options)t.addOption(p.create(s.answer,s.value));return t}createQuestionValue(e,t){let s=t(e.examine);return m.create(e.ask,s)}}s.d(t,"a",function(){return f});class f{constructor(e){this.actions=e,this.questionFactory=new E}create(e,t){switch(e.type){case"PhaseAttempt":return this.createPhaseAttempt(e);case"PhaseQuestion":return this.createPhaseQuestion(e,t);case"PhaseReport":return this.createPhaseReport(e);default:throw Error(`unrecognized phase type ${e.type}`)}}createPhaseAttempt(e){let t=this.actions[e.action];if(void 0===t)throw Error(`unrecognized action: ${e.action}`);let s=o.create(e.internalName,t.execute);return t.summarizeResult&&s.setDataSummarizer(t.summarizeResult),e.instructions&&s.setInstructions(e.instructions),s}createPhaseQuestion(e,t){let s=l.create(e.internalName);e.lookAt&&s.lookAt(t(e.lookAt));for(let r of e.questions){let e=this.questionFactory.create(r,t);s.addQuestion(e)}return s}}},function(e,t,s){"use strict";class r{constructor(e){this.process=e,this.censoredProps=new Set(["csrf","birthdate"])}getCollectibleData(){return this.scrub(this.buildData())}buildData(){let e=window.navigator;return{process:this.process.getSummarySoFar(),contentHtml:document.getElementById("contentContainer").outerHTML,navigator:{appCodeName:e.app,appName:e.appName,appVersion:e.appVersion,platfrom:e.platfrom,userAgent:e.userAgent,languages:$.extend(!0,[],e.languages),oscpu:e.oscpu},gameData:$.extend(!0,{},window.game_data)}}scrub(e){if("object"==typeof e&&null!==e)for(let t of Object.keys(e))this.censoredProps.has(t)?e[t]="CENSORED":e[t]=this.scrub(e[t]);return"string"==typeof e?this.censorCsrfInString(e):e}censorCsrfInString(e){return e.replace(/((&|&amp;)h=)(\w+)/g,"$1CENSORED").replace(/(\?h=)(\w+)(&|&amp;)/g,"$1CENSORED$3").replace(/(csrf_token = ')(\w+)/g,"$1CENSORED").replace(/("csrf":")(\w+)/g,"$1CENSORED")}}let a={bugReport:{url:"https://56hqsw3c2c.execute-api.us-east-2.amazonaws.com/prod/bugreport"}};s.d(t,"a",function(){return n});class n{constructor(e){this.process=e}buildReport(){return{title:"[Bug report] "+this.process.name,dataCollected:new r(this.process).getCollectibleData()}}async submitReport(e){let t=["|game version|world|player|twcheese|","|---|---|---|---|",`|${game_data.majorVersion}|${game_data.world}|${game_data.player.name}|${window.TwCheese.version}|`,"```"+JSON.stringify(e.dataCollected,null,2)+"```"].join("\n");return await this.createIssue(e.title,t)}async createIssue(e,t){let s=await fetch(a.bugReport.url,{method:"POST",body:JSON.stringify({title:e,message:t})});if(!s.ok)throw new Error(`Failed to create issue. [${s.status}: ${s.statusText}]`);return await s.json()}}},function(e,t,s){"use strict";s.r(t);var r=s(3);let a={phases:[{type:"PhaseQuestion",internalName:"Entry",questions:[{type:"QuestionFreeForm",ask:"What's broken?",placeholderText:'e.g. "nothing gets renamed"',minResponseLength:10}]}]};if(!n)var n={};n.MassTag={widget:{},format:"",config:{options:[{name:"unit",description:"The estimated slowest unit speed",defaultLabel:" ",enabled:!0},{name:"coords",description:"The coordinates of village sending troops",defaultLabel:" ",enabled:!0},{name:"player",description:"The player sending troops",defaultLabel:" ",enabled:!0},{name:"duration",description:"The duration of the attack",defaultLabel:" ",enabled:!1},{name:"distance",description:"The distance (fields) between villages",defaultLabel:" ",enabled:!1},{name:"return",description:"The estimated date and time the troops return",defaultLabel:" ",enabled:!1},{name:"sent",description:"The estimated date and time the troops were sent",defaultLabel:" ",enabled:!1},{name:"arrival",description:"The arrival date and time",defaultLabel:" ",enabled:!1},{name:"origin",description:"sending village: name (xxx|yyy) KYX",defaultLabel:" ",enabled:!1},{name:"destination",description:"target village: name (xxx|yyy) KYX",defaultLabel:" ",enabled:!1}]},init:function(){this.loadConfig(),this.widget=this.createWidget(),this.preview()},createWidget:function(){console.log("opening config widget");var e=document.createElement("div");e.id="twcheese_tag_config_container",e.style.display="block",e.style.position="fixed",e.style.zIndex=13e3,e.style.top="60px",e.style.left="50%",e.style.width="600px",e.style.marginLeft="-300px",e.style.borderStyle="solid",e.style.borderWidth="1px",e.style.borderRadius="8px 8px 4px 4px",e.style.borderColor="#804000 #603000 #402000 #804000",e.style.backgroundColor="#f7eed3";var t=document.createElement("div");t.style.backgroundColor="#dfcca6",t.style.borderRadius="8px 8px 0px 0px",t.style.cursor="move";var s=document.createElement("span");s.innerHTML="Configure Label",s.style.fontWeight=700,s.style.fontSize="14px",s.marginLeft="10px",t.appendChild(s),n.style.popupTitleBar(t,function(){n.MassTag.closeWidget()});var r=document.createElement("span");r.innerHTML=' created by <a href="http://forum.tribalwars.net/member.php?u=28484">cheesasaurus</a> and maintained by <a target="_blank" href="https://www.github.com/Jopika">Jopika</a>',r.style.fontSize="10px",r.style.cssFloat="right",r.style.marginRight="5px",t.appendChild(r),e.appendChild(t),$(e).draggable({handle:".twcheese_title_bar"});var a=document.createElement("div");a.id="twcheese_tag_config";var i=document.createElement("div");i.innerHTML="<b>Preview: </b>",i.style.margin="10px";var o=document.createElement("span");o.id="twcheese_MassTag_preview",o.innerHTML="blahblahblah",i.appendChild(o),a.appendChild(i);var l=this.config.options,c=document.createElement("table");c.style.marginLeft="10px",c.style.width="580px",c.id="twcheese_config_table";for(var u=0;u<n.MassTag.config.options.length;u++){c.insertRow(-1),c.rows[u].optionData=l[u],c.rows[u].insertCell(-1),c.className="vis";var h=document.createElement("input");h.type="checkbox",h.checked=l[u].enabled,h.onchange=function(){n.MassTag.preview(),this.parentNode.parentNode.optionData.enabled=this.checked,n.MassTag.saveConfig()},c.rows[u].cells[0].appendChild(h),c.rows[u].insertCell(-1);var p=document.createElement("input");p.type="text",p.size=10,null!=l[u].label?p.value=l[u].label:p.value=l[u].defaultLabel,p.onkeyup=function(){n.MassTag.preview(),this.value?this.parentNode.parentNode.optionData.label=this.value:this.parentNode.parentNode.optionData.label="",n.MassTag.saveConfig()},c.rows[u].cells[1].appendChild(p),c.rows[u].insertCell(-1),c.rows[u].cells[2].innerHTML=l[u].name,c.rows[u].insertCell(-1),c.rows[u].cells[3].innerHTML=l[u].description,c.rows[u].insertCell(-1),c.rows[u].cells[4].innerHTML='<div style="width: 11px; height:11px; background-image: url('+image_base+'sorthandle.png); cursor:move" class="qbhandle" title="drag to re-order"> </div>'}a.appendChild(c);var d=document.createElement("div");d.style="text-align:center; margin:10px;";var g=document.createElement("a");return g.className="btn",g.style.marginRight="5px",g.innerHTML="Label",g.onclick=function(){n.MassTag.label(n.MassTag.getFormat())},d.appendChild(g),a.appendChild(d),e.appendChild(a),document.getElementById("content_value").appendChild(e),$("#twcheese_config_table > tbody").sortable({handle:".qbhandle",placeholder:"sortable-placeholder"}),$("#twcheese_config_table > tbody").on("sortstop",function(){n.MassTag.preview(),n.MassTag.saveConfig()}),document.getElementById("twcheese_tag_config")},closeWidget:function(){$("#twcheese_tag_config_container").remove()},getFormat:function(){for(var e="",t=this.widget.getElementsByTagName("input"),s=this.widget.getElementsByTagName("tr"),r=0;r<n.MassTag.config.options.length;r++)t[2*r].checked&&(e+=t[2*r+1].value,e+="%"+s[r].optionData.name+"%");return e},preview:function(){document.getElementById("twcheese_MassTag_preview").innerHTML=this.getFormat()},saveConfig:function(){for(var e=this.widget.getElementsByTagName("tr"),t=new Array,s=0;s<n.MassTag.config.options.length;s++)t[s]=e[s].optionData;this.config.options=t,localStorage.setItem("twcheese.MassTag.config",JSON.stringify(this.config)),console.log("config saved")},loadConfig:function(){return!!localStorage.getItem("twcheese.MassTag.config")&&(this.config=JSON.parse(localStorage.getItem("twcheese.MassTag.config")),!0)},label:function(e){$("#select_all").click(),$("input[name=label_format]").val(e).parents("form").find("input[name=label]").click()}},n.style||(n.style={}),n.style.bgVertGradient=function(e,t,s){var r;e.style.backgroundColor=s,/Chrome/.test(navigator.userAgent)||/AppleWebKit/.test(navigator.userAgent)?r="webkit":/Firefox/.test(navigator.userAgent)?r="moz":window.opera?r="o":/MSIE/.test(navigator.userAgent)&&(r="ms"),r&&(e.style.background="-"+r+"-linear-gradient(top, "+t+", "+s+")")},n.style.popupTitleBar=function(e,t){e.className="twcheese_title_bar",n.style.bgVertGradient(e,"#DEC378","#BDA666"),e.style.height="22px",e.style.padding="4px";var s=document.createElement("span");s.style.backgroundImage='url("'+image_base+'login_close.png")',s.style.height="20px",s.style.width="20px",s.style.display="inline-block",s.style.cssFloat="right",s.style.cursor="pointer",s.onclick=t,e.appendChild(s)};let i=new r.a({});window.TwCheese.registerTool({id:"MassTagIncomings",use(){"overview_villages"==game_data.screen&&"incomings"==game_data.mode?n.MassTag.init():(UI.InfoMessage("Going to Incoming overview ...",3e3,"success"),document.location=game_data.link_base_pure+"overview_villages&mode=incomings")},getDebugProcess:()=>i.create("Tool: Mass Tag Incomings",a,!0)})}]);
//# sourceMappingURL=https://jopika.github.io/twcheese/dist/tool/setup-only/sourcemaps/MassTagIncomings.min.js.map
