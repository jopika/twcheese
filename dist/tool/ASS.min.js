!function(){let toolId="ASS";if(void 0===window.TwCheese){function handleJqXhrError(e){return function(t){e(new Error(`[${t.status} ${t.statusText}] ${this.type} ${this.url}`))}}window.TwCheese={ROOT:"https://jopika.github.io/twcheese",version:"v1.9-21-ga016902",tools:{},lastToolUsedId:null,async loadVendorLibs(){return new Promise((e,t)=>{$.ajax(`${this.ROOT}/dist/vendor.js`,{complete:e,error:handleJqXhrError(t)})})},async loadVendorLibsMinified(e){return new Promise((t,n)=>{$.ajax(`${this.ROOT}/dist/vendor.min.js?${e}`,{cache:!0,complete:t,error:handleJqXhrError(n)})})},async loadTool(e){return new Promise(t=>{let n=document.createElement("script");n.type="module",n.onload=t,n.src=`${this.ROOT}/src/ToolSetup/${e}.js`,document.head.appendChild(n)})},async loadToolCompiled(e,t){return new Promise((n,s)=>{$.ajax(`${this.ROOT}/dist/tool/setup-only/${e}.min.js?${t}`,{cache:!0,complete:n,error:handleJqXhrError(s)})})},hasTool(e){return void 0!==this.tools[e]},registerTool(e){this.tools[e.id]=e},useTool(e){this.lastToolUsedId=e,this.tools[e].use()},tryUseTool(e){return!!this.hasTool(e)&&(this.useTool(e),!0)},newDebugProcess(e){return this.hasTool(e)?this.tools[e].getDebugProcess():null}},function(){this.twcheeseExampleLib={nice:()=>69}}.call(window)}if(!TwCheese.hasTool(toolId)){let sidebarInitd=TwCheese.hasTool("Sidebar");!function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t,n){"use strict";n.d(t,"a",function(){return s});const s={PHASE_COMPLETION_READY:"phase_completion_ready",PHASE_COMPLETION_NOT_READY:"phase_completion_not_ready",PHASE_CHANGED:"phase_changed",QUESTION_ANSWERED:"question_answered",QUESTION_NOT_ANSWERED:"question_not_answered",OPTION_VALUE_CHANGED:"answer_value_changed",BUG_REPORT_SUCCEEDED:"bug_report_succeeded",BUG_REPORT_FAILED:"bug_report_failed",USER_REJECTED:"user_rejected"}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var s=n(3);function r(e){"string"!=typeof e&&(e=String(e));var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}let i=new Set;function o(e){i.has(e)||($(`<style>${e}</style>`).appendTo("head"),i.add(e))}o(`\n            .twcheese-popup {\n                z-index: 13000;\n                display: block;\n                position: fixed;\n                top: 60px;\n                border: 19px solid #804000;\n                border-image: url(${s.a.popupBorder}) 19 19 19 19 repeat;\n                left: 50%;\n                -webkit-transform: translateX(-50%);\n                transform: translateX(-50%);\n            }\n        `);new Set(["click","mousemove","mouseover","mouseout","mousedown","mouseup"]),new Set(["mousenter","mouseleave","mouseover","mouseout"])},function(e,t,n){"use strict";n.d(t,"a",function(){return s});class s{insertBefore(e){return this._beforeInsert(),$(e).before(this.$el),this}insertAfter(e){return this._beforeInsert(),$(e).after(this.$el),this}appendTo(e){return this._beforeInsert(),$(e).append(this.$el),this}_beforeInsert(){if("function"!=typeof this.afterInsert)return;!function(e,t){let n=new MutationObserver(s=>{e:for(let r of s)for(let s of r.addedNodes)if(s===e||s.contains(e)){setTimeout(t,0),n.disconnect();break e}});n.observe(document,{attributes:!0,childList:!0,subtree:!0})}(this.$el[0],()=>this.afterInsert())}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});let s=window.image_base,r=window.TwCheese.ROOT+"/assets/images/",i={plus:s+"plus.png",minus:s+"minus.png",wood:s+"holz.png",stone:s+"lehm.png",iron:s+"eisen.png",attack:s+"command/attack.png",haulPartial:s+"max_loot/0.png",haulFull:s+"max_loot/1.png",info:s+"questionmark.png",attackSentViaFa:s+"command/farm.png",attackSizeSmall:s+"command/attack_small.png",attackSizeMedium:s+"command/attack_medium.png",attackSizeLarge:s+"command/attack_large.png",attackContainsSnob:s+"command/snob.png",attackContainsSpy:s+"command/spy.png",attackContainsKnight:s+"command/knight.png",popupBackground:s+"popup/content_background.png",popupBorder:s+"popup/border.png",servant:s+"paladin_new.png",loadingSpinner:s+"throbber.gif",calendar:r+"calendar.png",sidebarMain:r+"sidebar/gear.png",sidebarBug:r+"sidebar/bug.png",sidebarGithub:r+"sidebar/github.png",jq:{blue:r+"jquery/ui-icons_2e83ff_256x240.png",black:r+"jquery/ui-icons_222222_256x240.png",darkGrey:r+"jquery/ui-icons_454545_256x240.png",grey:r+"jquery/ui-icons_888888_256x240.png",red:r+"jquery/ui-icons_cd0a0a_256x240.png"},legacy:{helpBackground:r+"legacy/help_background.png",helpBackgroundBright:r+"legacy/help_background_highlight.png"},buildingIcon:e=>s+`buildings/${e}.png`,troopIcon:e=>s+`unit/unit_${e}.png`,dotIcon:e=>s+`dots/${e}.png`,scavengeOption:e=>s+`scavenging/options/${e}.png`}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});const s={VALUE:"value",FREE_FORM:"free_form",SELECT:"select"}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});const s={ATTEMPT:"attempt",QUESTION:"question",REPORT:"report"}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});class s{constructor(e){this.name=e,this.followsUpOn=null,this.autoComplete=!1}setFollowsUpOn(e){return this.followsUpOn=e,this}setAutoComplete(e){return this.autoComplete=e,this}getType(){throw Error("notimplemented")}start(){throw Error("not implemented")}checkCompletionReady(){throw Error("not implemented")}getThingsToFollowUpOn(){throw Error("not implemented")}getSummary(){throw Error("not implemented")}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ProcessFactory});var _src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8),_src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(10),_src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11),_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9);function lazyEvalUsingParent(parentPhase){return str=>()=>{let parentResult=parentPhase.result;return eval(str)}}class ProcessFactory{constructor(e){this.phaseFactory=new _src_Models_Debug_Build_PhaseFactory_js__WEBPACK_IMPORTED_MODULE_1__.a(e)}create(e,t,n){let s=new _src_Models_Debug_DebugProcess_js__WEBPACK_IMPORTED_MODULE_0__.a(e);for(let e of t.phases)s.enqueuePhase(this.createPhase(e));if(n){let e=new _src_Models_Debug_BugReporter_js__WEBPACK_IMPORTED_MODULE_2__.a(s);s.enqueuePhase(_src_Models_Debug_PhaseReport_js__WEBPACK_IMPORTED_MODULE_3__.a.create(e))}return s}createPhase(e,t){let n=this.phaseFactory.create(e,t);return this.addFollowUpPhasesForSuccess(n,e),this.addFollowUpPhasesForAnswers(n,e),n}addFollowUpPhasesForSuccess(e,t){if("PhaseAttempt"===t.type&&t.success)for(let n of t.success){let t=this.createPhase(n,lazyEvalUsingParent(e));e.addSuccessFollowUp(t)}}addFollowUpPhasesForAnswers(e,t){if("PhaseQuestion"===t.type)for(let[n,s]of Object.entries(t.questions))if("QuestionSelect"===s.type)for(let[t,r]of Object.entries(s.options))if(r.followUp)for(let s of r.followUp){let r=e.questions[n].options[t],i=this.createPhase(s,lazyEvalUsingParent(e));r.addFollowUp(i)}}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var s=n(0);class r{constructor(e){this.name=e,this.phases=[],this.currentPhaseIndex=-1}enqueuePhase(e){return this.phases.push(e),this.watchPhase(e),this}insertPhase(e){return this.phases.splice(this.currentPhaseIndex+1,0,e),this.watchPhase(e),this}watchPhase(e){let t=[s.a.PHASE_COMPLETION_READY,s.a.PHASE_COMPLETION_NOT_READY,s.a.PHASE_CHANGED];$(e).on(t.join(" "),e=>$(this).trigger(e.type,e)),$(e).on(s.a.PHASE_COMPLETION_READY,()=>{e.autoComplete&&this.goToNextPhase()})}start(){this.currentPhaseIndex=-1,this.goToNextPhase()}goToNextPhase(){if(this.currentPhaseIndex>=0)for(let e of this.getCurrentPhase().getThingsToFollowUpOn())for(let t of e.followUpPhases)this.insertPhase(t);if(!this.hasNextPhase())throw Error("there's no next phase");this.currentPhaseIndex++,$(this).trigger(s.a.PHASE_CHANGED),this.getCurrentPhase().checkCompletionReady(),this.getCurrentPhase().start()}hasNextPhase(){return this.currentPhaseIndex<this.phases.length-1}getCurrentPhase(){return this.phases[this.currentPhaseIndex]}getSummarySoFar(){return this.phases.slice(0,this.currentPhaseIndex).map(e=>e.getSummary())}static create(e){return new r(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var s=n(6),r=n(0),i=n(5);const o={SUCCESS:"success",FAIL:"fail",NOT_ATTEMPTED:"not_attempted"};class a extends s.a{constructor(e){super("send bug report"),this.bugReporter=e,this.status=o.NOT_ATTEMPTED,this.error}getType(){return i.a.REPORT}start(){let e=this.bugReporter.buildReport();this.bugReporter.submitReport(e).then(e=>{this.status=o.SUCCESS,$(this).trigger({type:r.a.BUG_REPORT_SUCCEEDED,url:e.html_url})}).catch(e=>{this.error=e,this.status=o.FAIL,$(this).trigger(r.a.BUG_REPORT_FAILED)}).finally(()=>this.checkCompletionReady())}checkCompletionReady(){this.status!==o.NOT_ATTEMPTED?$(this).trigger(r.a.PHASE_COMPLETION_READY):$(this).trigger(r.a.PHASE_COMPLETION_NOT_READY)}getThingsToFollowUpOn(){return[]}getSummary(){return{phaseName:this.name}}static create(e){return new a(e)}}},function(e,t,n){"use strict";var s=n(6),r=n(0),i=n(5);const o={SUCCESS:"success",FAIL:"fail",NOT_ATTEMPTED:"not_attempted"};class a extends s.a{constructor(e,t){super(e),this.instructions,this.attempt=t,this.success=(async()=>{}),this.fail=(async()=>{}),this.status=o.NOT_ATTEMPTED,this.autoComplete=!0,this._error,this._result,this.summarizeData=(e=>e),this.ctrl={},this.successFollowUpPhases=[]}getType(){return i.a.ATTEMPT}get result(){if(this.status===o.NOT_ATTEMPTED)throw new Error("tried to get result before the attempt settled");if(this.status===o.FAIL)throw new Error("tried to get result of an attempt that failed");return this._result}async doAttempt(){try{let e=await this.abortableAttempt();this.status=o.SUCCESS,this._result=e,await this.success(e)}catch(e){console.warn(e),this.status=o.FAIL,this._error=e,await this.fail(e)}this.checkCompletionReady()}async abortableAttempt(){return new Promise(async(e,t)=>{$(this.ctrl).on(r.a.USER_REJECTED,()=>t("user rejected"));try{let n;this.followsUpOn&&(n=this.followsUpOn.result),e(await this.attempt(n,this.ctrl))}catch(e){t(e)}})}userAbort(){$(this.ctrl).trigger(r.a.USER_REJECTED)}setInstructions(e){return this.instructions=e,this}setDataSummarizer(e){return this.summarizeData=e,this}onSuccess(e){return this.success=e,this}addSuccessFollowUp(e){return this.successFollowUpPhases.push(e),e.setFollowsUpOn(this),this}get followUpPhases(){return this.status===o.SUCCESS?this.successFollowUpPhases:[]}onFail(e){return this.fail=e,this}start(){this.doAttempt()}checkCompletionReady(){this.status!==o.NOT_ATTEMPTED?$(this).trigger(r.a.PHASE_COMPLETION_READY):$(this).trigger(r.a.PHASE_COMPLETION_NOT_READY)}getThingsToFollowUpOn(){return[this]}getSummary(){return{phaseName:this.name,status:this.status,data:void 0===this._result?this._result:this.summarizeData(this._result),error:this.summarizeError()}}summarizeError(){let e=this._error;return e instanceof Error?{message:e.message,name:e.name,extra:e.extra,stack:e.stack}:e}static create(e,t){return new a(e,t)}}class c extends s.a{constructor(e){super(e),this.questions=[],this._examinedHtml}getType(){return i.a.QUESTION}lookAt(e){return this._examinedHtml=e,this}get examinedHtml(){return"function"==typeof this._examinedHtml?this._examinedHtml():this._examinedHtml}addQuestion(e){return this.questions.push(e),$(e).on(r.a.QUESTION_ANSWERED,()=>{this.checkCompletionReady()}),$(e).on(r.a.QUESTION_NOT_ANSWERED,()=>{this.checkCompletionReady()}),this}start(){}checkCompletionReady(){for(let e of this.questions)if(!e.isAnswered())return void $(this).trigger(r.a.PHASE_COMPLETION_NOT_READY);$(this).trigger(r.a.PHASE_COMPLETION_READY)}getThingsToFollowUpOn(){return this.questions.reduce((e,t)=>e.concat(t.getThingsToFollowUpOn()),[])}getSummary(){return{phaseName:this.name,questions:this.questions.map(e=>e.getSummary())}}static create(e){return new c(e)}}var h=n(4);class l{constructor(e){this.text=e,this.options=[],this.selectedOptionIndex=null}getType(){throw Error("not implemented")}addOption(e){return this.options.push(e),this}setSelectedOption(e){return this.selectedOptionIndex=e,$(this).trigger(r.a.QUESTION_ANSWERED),this}isAnswered(){return null!==this.selectedOptionIndex}getSelectedOption(){return this.options[this.selectedOptionIndex]}getThingsToFollowUpOn(){let e=this.getSelectedOption();return e.followUpPhases.length>0?[e]:[]}getSummary(){return{question:this.text,answer:this.getSelectedOption().value}}static create(e){return new l(e)}}class u extends l{getType(){return h.a.SELECT}static create(e){return new u(e)}}class d{constructor(e,t,n=""){this.text=e,this.value=t,this.className=n,this.followUpPhases=[]}addFollowUp(e){return this.followUpPhases.push(e),e.setFollowsUpOn(this),this}setValue(e){this.value=e,$(this).trigger(r.a.OPTION_VALUE_CHANGED)}static create(e,t,n){return new d(e,t,n)}}class p extends l{constructor(e,t,n=0){super(e),this.minResponseLength=n,this.options=[d.create(t,"","free-form")],this.setSelectedOption(0),this.watchSelectedOption()}getType(){return h.a.FREE_FORM}watchSelectedOption(){$(this.getSelectedOption()).on(r.a.OPTION_VALUE_CHANGED,()=>{this.isAnswered()?$(this).trigger(r.a.QUESTION_ANSWERED):$(this).trigger(r.a.QUESTION_NOT_ANSWERED)})}isAnswered(){return super.isAnswered()&&this.options[0].value.length>=this.minResponseLength}static create(e,t,n){return new p(e,t,n)}}const g={CORRECT:"correct",INCORRECT:"incorrect",NOT_SURE:"not_sure"},m=1;class f extends l{constructor(e,t){super(e),this._valueQuestioned=t,this.options=[d.create("Correct",g.CORRECT,"correct"),d.create("Incorrect",g.INCORRECT,"incorrect"),d.create("Not sure",g.NOT_SURE,"not-sure")]}get value(){return"function"==typeof this._valueQuestioned?this._valueQuestioned():this._valueQuestioned}getType(){return h.a.VALUE}addFollowUp(e){return this.options[m].addFollowUp(e),this}getSummary(){return Object.assign(super.getSummary(),{valueChecked:this.value})}static create(e,t){return new f(e,t)}}class w{create(e,t){switch(e.type){case"QuestionFreeForm":return this.createQuestionFreeForm(e);case"QuestionSelect":return this.createQuestionSelect(e);case"QuestionValue":return this.createQuestionValue(e,t);default:throw`unrecognized question type: ${e.type}`}}createQuestionFreeForm(e){let t=e.minResponseLength||0;return p.create(e.ask,e.placeholderText,t)}createQuestionSelect(e){let t=u.create(e.ask);for(let n of e.options)t.addOption(d.create(n.answer,n.value));return t}createQuestionValue(e,t){let n=t(e.examine);return f.create(e.ask,n)}}n.d(t,"a",function(){return b});class b{constructor(e){this.actions=e,this.questionFactory=new w}create(e,t){switch(e.type){case"PhaseAttempt":return this.createPhaseAttempt(e);case"PhaseQuestion":return this.createPhaseQuestion(e,t);case"PhaseReport":return this.createPhaseReport(e);default:throw Error(`unrecognized phase type ${e.type}`)}}createPhaseAttempt(e){let t=this.actions[e.action];if(void 0===t)throw Error(`unrecognized action: ${e.action}`);let n=a.create(e.internalName,t.execute);return t.summarizeResult&&n.setDataSummarizer(t.summarizeResult),e.instructions&&n.setInstructions(e.instructions),n}createPhaseQuestion(e,t){let n=c.create(e.internalName);e.lookAt&&n.lookAt(t(e.lookAt));for(let s of e.questions){let e=this.questionFactory.create(s,t);n.addQuestion(e)}return n}}},function(e,t,n){"use strict";class s{constructor(e){this.process=e,this.censoredProps=new Set(["csrf","birthdate"])}getCollectibleData(){return this.scrub(this.buildData())}buildData(){let e=window.navigator;return{process:this.process.getSummarySoFar(),contentHtml:document.getElementById("contentContainer").outerHTML,navigator:{appCodeName:e.app,appName:e.appName,appVersion:e.appVersion,platfrom:e.platfrom,userAgent:e.userAgent,languages:$.extend(!0,[],e.languages),oscpu:e.oscpu},gameData:$.extend(!0,{},window.game_data)}}scrub(e){if("object"==typeof e&&null!==e)for(let t of Object.keys(e))this.censoredProps.has(t)?e[t]="CENSORED":e[t]=this.scrub(e[t]);return"string"==typeof e?this.censorCsrfInString(e):e}censorCsrfInString(e){return e.replace(/((&|&amp;)h=)(\w+)/g,"$1CENSORED").replace(/(\?h=)(\w+)(&|&amp;)/g,"$1CENSORED$3").replace(/(csrf_token = ')(\w+)/g,"$1CENSORED").replace(/("csrf":")(\w+)/g,"$1CENSORED")}}let r={bugReport:{url:"https://56hqsw3c2c.execute-api.us-east-2.amazonaws.com/prod/bugreport"}};n.d(t,"a",function(){return i});class i{constructor(e){this.process=e}buildReport(){return{title:"[Bug report] "+this.process.name,dataCollected:new s(this.process).getCollectibleData()}}async submitReport(e){let t=["|game version|world|player|twcheese|","|---|---|---|---|",`|${game_data.majorVersion}|${game_data.world}|${game_data.player.name}|${window.TwCheese.version}|`,"```"+JSON.stringify(e.dataCollected,null,2)+"```"].join("\n");return await this.createIssue(e.title,t)}async createIssue(e,t){let n=await fetch(r.bugReport.url,{method:"POST",body:JSON.stringify({title:e,message:t})});if(!n.ok)throw new Error(`Failed to create issue. [${n.status}: ${n.statusText}]`);return await n.json()}}},function(e,t,n){n(13),e.exports=n(14)},function(e,t,n){"use strict";n.r(t);class s{constructor(e){this.id=e,this.props={},this._loadCachedData()}get(e,t){return function(e,t,n){let s=t.split(".");for(let t=0;t<s.length-1;t++){let r=s[t];if("object"!=typeof e[r]||null===r)return n;e=e[r]}let r=e[s[s.length-1]];return void 0===r?n:r}(this.props,e,t)}set(e,t){!function(e,t,n){let s=t.split(".");for(let t=0;t<s.length-1;t++){let n=s[t];"object"==typeof e[n]&&null!==n||(e[n]={}),e=e[n]}e[s[s.length-1]]=n}(this.props,e,t),this._save()}initProps(e){this.props=e}_loadCachedData(){let e=window.localStorage.getItem(this.id);if(e){let t=JSON.parse(e);return this.props=t.props||t,t}return null}_save(){this._beforeSave(),window.localStorage.setItem(this.id,JSON.stringify(this._getCacheableData()))}_beforeSave(){}_getCacheableData(){return{props:this.props}}}let r=new class{constructor(e){this.maxBurstsPerSecond=e,this.recentRequests=new Array(e)}requestWasMade(){this.recentRequests.unshift(performance.now()),this.recentRequests.pop()}async sleepIfNeeded(){let e=this.recentRequests[this.maxBurstsPerSecond-1];if(void 0===e)return;let t=e+1e3-performance.now();return t<=0?void 0:new Promise(function(e,n){setTimeout(e,t)})}}(5),i=window.fetch;window.fetch=function(){return r.requestWasMade(),i.apply(this,arguments)};class o extends s{setUrl(e){return this.url=e,this}setTtl(e){return this.ttl=1e3*e,this}async ensureUpdated(){this.needsUpdate()&&await this.update()}needsUpdate(){let e=(new Date).getTime(),t=this.ttl||86400;return!this.timeUpdated||t<e-this.timeUpdated}async update(){let e=await async function(e){await r.sleepIfNeeded();let t=await fetch(e),n=await t.text(),s=(new DOMParser).parseFromString(n,"text/xml");return Object.defineProperty(s,"URL",{get:()=>e}),s}(this.url);this._processXml(e),this._save()}_processXml(e){this.props=function e(t){if(0===t.children.length)return parseFloat(t.innerHTML)||null;let n={};for(let s of t.children)n[s.tagName]=e(s);return n}(e).config}_loadCachedData(){let e=super._loadCachedData();e&&(this.timeUpdated=e.timeUpdated)}_beforeSave(){this.timeUpdated=(new Date).getTime()}_getCacheableData(){return Object.assign({},super._getCacheableData(),{timeUpdated:this.timeUpdated})}}let a=new s("twcheese.userConfig"),c=new o("twcheese.gameConfig").setUrl(`https://${document.domain}/interface.php?func=get_config`).setTtl(28800),h=new o("twcheese.buildingConfig").setUrl(`https://${document.domain}/interface.php?func=get_building_info`).setTtl(28800),l=new o("twcheese.troopConfig").setUrl(`https://${document.domain}/interface.php?func=get_unit_info`).setTtl(28800);var u=n(1);function d(e){return"suggestRedirect.skip."+e}Object(u.b)("\n            .twcheese-suggest-redirect-skip-container {\n                margin-top: 20px;\n                font-size: 10px;\n            }\n        \n            .twcheese-suggest-redirect-skip-container > * {\n                vertical-align: middle;\n            }\n        ");class p{constructor(e){this.base=e,this.id=e.id}getName(){return this.base.name}getLootPercent(){return 100*this.base.loot_factor}getLootFactor(){return this.base.loot_factor}calcDurationSeconds(e){let t=e**2*this.getLootPercent()*this.base.loot_factor,n=Math.pow(t,this.base.duration_exponent)+this.base.duration_initial_seconds;return Math.round(n*this.base.duration_factor)}calcTargetCapacity(e){let t=(e/this.base.duration_factor-this.base.duration_initial_seconds)**(1/this.base.duration_exponent);return Math.round(Math.sqrt(t/this.getLootPercent()/this.base.loot_factor))}}let g=["spear","sword","axe","archer","spy","light","marcher","heavy","ram","catapult","knight","snob","militia"];function m(e){let t=l.get(e);return void 0===t?0:t.speed}function f(e){let t=l.get(e);return void 0===t?0:t.carry}class w{constructor(){for(let e of g)this[e]=0}clone(){return Object.assign(new w,this)}filter(e){let t=new w;for(let n of g)e.includes(n)&&(t[n]=this[n]);return t}isZero(){for(let e of Object.values(this))if(0!==e)return!1;return!0}sum(){let e=0;for(let t of Object.values(this))e+=t;return e}each(e){for(let t of g){e(t,this[t])}}carryCapacity(){let e=0;for(let t of g)e+=this[t]*f(t);return e}populationUsed(){return g.reduce((e,t)=>e+function(e){let t=l.get(e);return void 0===t?0:t.pop}(t)*this[t],0)}travelDuration(e,t="attack"){return b(this.travelMinutesPerField(t),e)}travelMinutesPerField(e="attack"){if("support"===e&&this.knight>0)return m("knight");let t=g.filter(e=>this[e]>0).map(e=>m(e));return Math.max(...t)}subtract(e){let t=new w;for(let[n,s]of Object.entries(this))t[n]=s-e[n];return t}zeroNegatives(){let e=new w;for(let[t,n]of Object.entries(this))e[t]=Math.max(0,n);return e}toArray(){return g.map(e=>this[e])}static fromArray(e){let t=new w;return e.forEach((e,n)=>{t[g[n]]=e}),t}}function b(e,t){return 1e3*Math.round(t*e*60)}let _={troopTypesOnWorld:()=>window.game_data.units,existsOnWorld:e=>void 0!==l.get(e),countToCarry(e,t,n=0){let s=t/(f(e)*(100+n)/100);return Math.round(10*s)/10},carryCapacity:(e,t=1)=>f(e)*t,travelDuration:(e,t)=>b(m(e),t)};function v(e){let t=function(e){let t=function(e){let t=e.getElementsByTagName("script");for(let e of t){let t=e.innerHTML;if(t.includes("new ScavengeScreen"))return t}}(e),n=function(e){let t,n=e.indexOf("{"),s=T(e,n,"{","}"),r=n+s.length;for(;r<e.length;r++)if("{"===e[r]){t=T(e,r,"{","}");break}return{optionsConfig:JSON.parse(s),troops:JSON.parse(t)}}(function(e){let t=e.indexOf("new ScavengeScreen")+"new ScavengeScreen".length;return T(e,t,"(",")")}(t)),s=function(e){let t=e.indexOf("var village = ")+"var village = ".length;return T(e,t,"{","}")}(t);return{optionsConfig:n.optionsConfig,troops:n.troops,village:JSON.parse(s)}}(e),n=t.optionsConfig,s=new Map;for(let e of Object.keys(n))s.set(parseInt(e),new p(n[e]));return{options:s,sendableTroopTypes:Object.keys(t.troops),haulFactor:t.village.unit_carry_factor}}function T(e,t,n="(",s=")"){let r=1,i=0,o=-1;for(let a=t+1;a<e.length;a++){let c=e[a];if(c===n&&r++,c===s&&(i++,o=a),i===r)return e.substring(t,o+1)}}class x{constructor(e){this._sendableTroopTypes=e,this.reset()}reset(){this.mode=x.MODE_SANE_PERSON,this.allowedOptionIds=new Set([1,2,3,4]),this.targetDurationSeconds=7200,this.initTroops(),this.troopOrder=[["axe","light","marcher"],["spear","sword","archer"],["heavy"],["knight"]]}initTroops(){this.troops={};for(let e of this._sendableTroopTypes)this.troops[e]={maySend:!0,reserved:0}}setMode(e){this.mode=e,$(this).trigger("change")}isOptionAllowed(e){return this.allowedOptionIds.has(e)}setOptionAllowed(e,t=!0){t?this.allowedOptionIds.add(e):this.allowedOptionIds.delete(e),$(this).trigger("change")}setTargetDuration(e){this.targetDurationSeconds=e,$(this).trigger("change")}getAllowedTroopTypes(){return this._sendableTroopTypes.filter(e=>this.troops[e].maySend)}isTroopTypeAllowed(e){return this.troops[e].maySend}setTroopAllowed(e,t){this.troops[e].maySend=t,$(this).trigger("change")}getReservedTroopCounts(){let e=new w;for(let t of this._sendableTroopTypes)e[t]=this.troops[t].reserved;return e}getReservedCount(e){return this.troops[e].reserved}setReservedCount(e,t){this.troops[e].reserved=t,$(this).trigger("change")}setTroopOrder(e){this.troopOrder=e,$(this).trigger("change")}export(){return{mode:this.mode,allowedOptionIds:[...this.allowedOptionIds.values()],targetDurationSeconds:this.targetDurationSeconds,troops:this.troops,troopOrder:this.troopOrder}}import(e){this.mode=e.mode,this.allowedOptionIds=new Set(e.allowedOptionIds),this.targetDurationSeconds=e.targetDurationSeconds,this.troops=e.troops,this.troopOrder=e.troopOrder}}x.MODE_SANE_PERSON="sane_person",x.MODE_ADDICT="addict";class E{constructor(e,t,n){this.options=e,this.sendableTroopTypes=t,this.troopUtil=n,this.preferences=new x(t)}adjustAvailableTroopCounts(e){return e.filter(this.preferences.getAllowedTroopTypes()).subtract(this.preferences.getReservedTroopCounts()).zeroNegatives()}adjustUsableOptionIds(e){return e.filter(e=>this.preferences.isOptionAllowed(e))}areTroopsSufficient(e){return(e=this.adjustAvailableTroopCounts(e)).populationUsed()>=10}assignTroops(e,t,n=1){return e=this.adjustUsableOptionIds(e),t=this.adjustAvailableTroopCounts(t),this.preferences.mode===x.MODE_ADDICT?this.assignTroopsForAddict(e,t,n):this.assignTroopsForSanePerson(e,t,n)}assignTroopsForSanePerson(e,t,n=1){let s=new Map,r=[...this.options.keys()].reverse();for(let i of r){let r;if(e.includes(i)){let e=this.options.get(i).calcTargetCapacity(this.preferences.targetDurationSeconds);r=this.chunkTroopsToHaul(e,t,n)}else r=new w;s.set(i,r),t=t.subtract(r)}return s}assignTroopsForAddict(e,t,n=1){let s=new Map,r=[...this.options.keys()].reverse(),i=t.carryCapacity()*n,o=this.preferences.targetDurationSeconds,a=0,c={},h=0;for(let t of r){if(!e.includes(t))continue;let n=this.options.get(t);c[t]=1/n.getLootFactor(),h+=c[t],a+=n.calcTargetCapacity(o)}let l=Math.min(1,a/i);for(let o of r){let r;if(e.includes(o)){let e=l*(c[o]/h)*i;r=this.chunkTroopsToHaul(e,t,n)}else r=new w;s.set(o,r),t=t.subtract(r)}return s}chunkTroopsToHaul(e,t,n=1){let s=new w,r={};for(let i of this.preferences.troopOrder){if(e<0)break;let o=0;for(let e of i){let s=t[e];r[e]=this.troopUtil.carryCapacity(e,n),o+=s*r[e]}let a=Math.min(1,e/o);for(let n of i){let i=t[n];s[n]=Math.floor(i*a),e-=s[n]*r[n]}e>0&&this.troopsToTopOff(e,t,s,i,r).each(function(t,n){e-=n*(r[t]||0),s[t]+=n})}return s}troopsToTopOff(e,t,n,s,r){let i=new w;for(;e>0;){let o=!1,a=null,c=Number.MAX_SAFE_INTEGER;for(let h of s)if(t[h]>n[h]+i[h]){o=!0;let t=Math.abs(e-r[h]);t<c&&(c=t,a=h)}if(!o)break;if(e<Math.abs(e-r[a]))break;i[a]+=1,e-=r[a]}return i}}var O=n(2),y=n(3);class S extends O.a{constructor(e,t,n){super(),this.preferences=e,this.scavengeOptions=t,this.sendableTroopTypes=n,this.initStructure(),this.initTroopOrder(),this.watchSelf()}initStructure(){this.$el=$(this.createHtml().trim()),this.$targetDuration=this.$el.find(".target-duration"),this.$options=this.$el.find(".options-section input"),this.$modes=this.$el.find("input[name='mode']"),this.$troopsAllowed=this.$el.find(".troop-allowed"),this.$troopsReserved=this.$el.find(".troop-reserved"),this.$troopGroups=this.$el.find(".troop-group")}createHtml(){return`<div class="twcheese-scavenge-preferences-widget">\n                    <h3>Preferences</h3>\n                    ${this.createTimingSectionHtml()}\n                    <br/>\n                    ${this.createOptionsSectionHtml()}\n                    <br/>\n                    <table style="width: 100%;">\n                        <tr>\n                            <td>${this.createTroopsSectionHtml()}</td>\n                            <td style="width: 20px;"></td>\n                            <td>${this.createTroopsOrderSectionHtml()}</td>\n                        </tr>\n                    </table>\n                </div>`}createTimingSectionHtml(){let e=this.preferences.targetDurationSeconds,t=Math.floor(e/3600),n=String(Math.floor(e/60)%60).padStart(2,"0"),s=this.preferences.mode,r=x.MODE_SANE_PERSON,i=x.MODE_ADDICT;return`\n                    <table class="vis timing-section">\n                        <tr><th>Timing</th></tr>\n                        <tr>\n                            <td>\n                                Target duration:\n                                <input type="text" class="target-duration" value="${t}:${n}" placeholder="2:00" required pattern="\\d+:\\d{2}">\n                                hours:minutes\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <label>\n                                    <input type="radio" name="mode" value="${r}" ${s===r?"checked":""}>\n                                    Max-out duration of best options first.\n                                    <br/><span class="hint">(recommended if you'll be afk)</span>\n                                </label>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <label>\n                                    <input type="radio" name="mode" value="${i}" ${s===i?"checked":""}>\n                                    Aim for same duration across all options.\n                                    <br/><span class="hint">(recommended if you can immediately resend whenever)</span>\n                                </label>    \n                            </td>\n                        </tr>\n                    </table>\n                `}createOptionsSectionHtml(){return`\n                    <table class="vis options-section">\n                        <tr><th colspan="2">Options to use</th></tr>\n                        ${[...this.scavengeOptions.values()].map(e=>this.createOptionRowHtml(e)).join("")}\n                    </table>\n                `}createOptionRowHtml(e){let t="";return this.preferences.isOptionAllowed(e.id)&&(t="checked"),`<tr>\n                    <td>\n                        <label>\n                            <input type="checkbox" ${t} data-option-id="${e.id}">\n                            <img src="${y.a.scavengeOption(e.id)}">\n                            <span>${e.getName()}</span>\n                        </label>\n                    </td>\n                    <td>(${e.getLootPercent()}% carry capacity)</td>\n                </tr>`}createTroopsSectionHtml(){let e=["Reserved troops won't be sent scavenging.","<br/>","<br/>Example:"," :: You have 500 spears and 100 are reserved. At most, 400 spears would be sent scavenging."].join("");return`\n                    <table class="vis troops-section">\n                        <tr>\n                            <th>Use</th>\n                            <th>Reserved <img src="${y.a.info}" title="${e}" class="tooltip info"></th>\n                        </tr>\n                        ${this.sendableTroopTypes.map(e=>this.createTroopRowHtml(e)).join("")}\n                    </table>\n                `}createTroopRowHtml(e){let t=this.preferences.isTroopTypeAllowed(e)?"checked":"",n=this.preferences.getReservedCount(e);return`<tr>\n                    <td>\n                        <input class="troop-allowed" type="checkbox" value="${e}" ${t}>\n                        <img src="${y.a.troopIcon(e)}">\n                    </td>\n                    <td><input class="troop-reserved" data-troop-type="${e}" type="number" min="0" value="${n}"></td>\n                </tr>`}createTroopsOrderSectionHtml(){let e=["Troops in upper groups will be sent before troops in lower groups.","<br/>","<br/>Troops within the same group will be split proportionally by count available."].join("");return`\n                    <table class="vis troop-order-section">\n                        <tr>\n                            <th>Order <img src="${y.a.info}" title="${e}" class="tooltip info"></th>\n                        </tr>\n                        ${this.sendableTroopTypes.map(()=>'<tr><td><div class="troop-group"></div></td></tr>').join("")}\n                    </table>\n                `}initTroopOrder(){for(let[e,t]of Object.entries(this.preferences.troopOrder)){let n=this.$troopGroups.eq(e);for(let e of t){if(!_.existsOnWorld(e))continue;let t=$(`<img class="troop" draggable="true" data-troop-type="${e}" src="${y.a.troopIcon(e)}">`);n.append(t)}}let e;this.$troopGroups.on("dragover",function(e){e.preventDefault()}).on("dragenter",function(e){$(this).addClass("dragging-over")}).on("dragleave",function(e){$(this).removeClass("dragging-over")}).on("drop",function(n){n.preventDefault(),$(this).append(e),$(this).removeClass("dragging-over"),t()}),this.$troopGroups.find(".troop").on("dragstart",function(t){let n=t.originalEvent.dataTransfer;e=$(this),n.setDragImage(e.clone()[0],0,0),n.dropEffect="move",e.addClass("dragging")}).on("dragend",function(t){e.removeClass("dragging"),e=null});let t=()=>{let e=n();this.preferences.setTroopOrder(e)},n=()=>{let e=[];return this.$troopGroups.each(function(){let t=$(this).find(".troop");if(t.length<1)return;let n=[];t.each(function(){n.push($(this).data("troopType"))}),e.push(n)}),e}}watchSelf(){let e=this.preferences;this.$targetDuration.on("change",function(){if(!this.checkValidity())return;let[,t,n]=this.value.match(/(\d+):(\d+)/),s=3600*parseInt(t)+60*parseInt(n);s<3600?this.setCustomValidity("must be at least 1 hour"):(this.setCustomValidity(""),e.setTargetDuration(s))}),this.$options.on("change",function(){let t=$(this);e.setOptionAllowed(t.data("optionId"),t.prop("checked"))}),this.$modes.on("change",()=>{let t=this.$modes.filter(":checked").val();e.setMode(t)}),this.$troopsAllowed.on("change",function(){let t=$(this);e.setTroopAllowed(t.val(),t.prop("checked"))}),this.$troopsReserved.on("input",function(){if(!this.checkValidity())return;let t=parseInt(this.value)||0;e.setReservedCount(this.dataset.troopType,t)})}}Object(u.b)("\n        \n            .twcheese-scavenge-preferences-widget .options-section,\n            .twcheese-scavenge-preferences-widget .timing-section,\n            .twcheese-scavenge-preferences-widget .troops-section,\n            .twcheese-scavenge-preferences-widget .troop-order-section {\n                width: 100%;\n            }\n        \n            \n            .twcheese-scavenge-preferences-widget .info {\n                width: 14px;\n                height: 14px;\n                vertical-align: middle;\n                position: relative;\n                top: -1px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .target-duration {\n                width: 50px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .timing-section .hint {\n                font-size: x-small;\n                margin-left: 25px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .timing-section input[type='radio'] {\n                vertical-align: middle;\n            }\n        \n            .twcheese-scavenge-preferences-widget .options-section td {\n                height: 22px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .options-section input,\n            .twcheese-scavenge-preferences-widget .options-section span {\n                vertical-align: middle;\n            }\n        \n            .twcheese-scavenge-preferences-widget .options-section img {\n                vertical-align: middle;\n                width: 18px;\n                height: 18px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troops-section td,\n            .twcheese-scavenge-preferences-widget .troop-order-section td {\n                height: 26px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troops-section td:first-child {\n                width: 45px;\n            }   \n        \n            .twcheese-scavenge-preferences-widget .troops-section img,\n            .twcheese-scavenge-preferences-widget .troops-section input {\n                vertical-align: middle;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troop-reserved {\n                width: 70px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troop-group {\n                position: relative;\n                border: 1px solid black;\n                border-radius: 3px;\n                height: 18px;\n                width: 176px;\n                padding: 3px;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troop-group.dragging-over {\n                background-color: darkOrange;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troop {\n                display: inline-block;\n                width: 18px;\n                height: 18px;\n                cursor: move;\n                margin: 0 3px;\n                -webkit-user-select: none;\n                -moz-user-select: none;\n                -ms-user-select: none;\n                user-select: none;\n            }\n        \n            .twcheese-scavenge-preferences-widget .troop.dragging {\n                opacity: 0.1;\n            }\n            \n        ");var P=n(7);let C,k,A,R={phases:[{type:"PhaseQuestion",internalName:"Entry",questions:[{type:"QuestionFreeForm",ask:"What's broken?",placeholderText:'e.g. "it doesn\'t focus the Start button"',minResponseLength:10}]}]},D=!1;function I(e=!0){let t=function(e){let t=[];return $(e).find(".scavenge-option").has(".free_send_button:not(.btn-disabled)").each(function(){let[,e]=$(this).find(".portrait").css("background-image").match(/options\/(\d).png/);t.push(parseInt(e))}),t}(document);if((t=k.adjustUsableOptionIds(t)).length<1)return void(e&&window.UI.ErrorMessage("Can't scavenge right now because there's no usable options"));let n=function(e){let t=new w;return $(e).find(".units-entry-all").each(function(){let e=this.dataset.unit;t[e]=parseInt(this.innerHTML.match(/\d+/)[0])}),t}(document);if(!k.areTroopsSufficient(n))return void(e&&window.UI.ErrorMessage("Not enough troops available to scavenge right now"));let s=k.assignTroops(t,n,C),r=t[t.length-1];s.get(r).each(function(e,t){$(`.unitsInput[name='${e}']`).val(t).trigger("change")}),function(e){$(".free_send_button")[e-1].focus()}(r)}let U=new P.a({});window.TwCheese.registerTool({id:"ASS",use:async function(){!function(){let e=document.location.href;return e.includes("screen=place")&&e.includes("mode=scavenge")}()?function(e){let{message:t,screen:n,screenName:s,uriParams:r,skippableId:i}=e;if(t=t||"{{Some genius forgot to write a message here}}",s=s||"{{Screen Name goes here}}",r=r||{},!n)throw Error("screen must be specified!");if(i&&a.get(d(i),!1))return window.UI.InfoMessage(`Redirecting to <strong>${s}</strong>...`),void setTimeout(()=>window.TribalWars.redirect(n,r),200);let o={text:"Take me there!",callback:()=>{if(i){let e=$("#twcheese-suggest-redirect-skip").prop("checked");a.set(d(i),e)}window.TribalWars.redirect(n,r)},confirm:!0};window.UI.ConfirmationBox(function(e,t){let n=e;return t.skippableId&&(n+='<div class="twcheese-suggest-redirect-skip-container">\n                    <input id="twcheese-suggest-redirect-skip" type="checkbox">\n                    <span>Don\'t ask, just take me there next time.</span>\n                </div>'),n}(t,e),[o,{text:"Whatever...",callback:()=>{}}],"twcheese_suggest_redirect",!0,!0)}({message:"To use this, you must be at the scavenging screen.",screen:"place",screenName:"Scavenging Screen",uriParams:{mode:"scavenge"},skippableId:"Tool:ASS"}):(D||(await async function(){await async function(){await Promise.all([c.ensureUpdated(),l.ensureUpdated(),h.ensureUpdated()])}();let e=v(document);k=new E(e.options,e.sendableTroopTypes,_),C=e.haulFactor;let t=a.get("ASS.troopsAssigner");t&&k.preferences.import(t),$(k.preferences).on("change",function(){a.set("ASS.troopsAssigner",k.preferences.export())}),A=e.options,function(){let e=$('<a href="#">&raquo; preferences</a>').css({fontSize:"small",marginLeft:"10px"}).on("click",function(e){e.preventDefault(),function(){let e=I;Dialog.show("twcheese-scavenge-preferences-popup",function(e){let t=new S(k.preferences,A,k.sendableTroopTypes);t.appendTo(e)},e)}()});$("#content_value").find("h3").eq(0).append(e)}(),function(){let e=$('<span>Script created by <a href="https://forum.tribalwars.net/index.php?members/28484">cheesasaurus</a> and maintained by <a target="_blank" href="https://www.github.com/Jopika">Jopika</a></span>').css({float:"right",fontSize:"xx-small",fontWeight:"normal"});$("#content_value").find("h3").eq(0).append(e)}(),Object(u.b)("\n                .free_send_button:focus {\n                    color: yellow;\n                    box-shadow: 0 0 5px 3px yellow;\n                }\n            "),function(e){let t=new MutationObserver(function(t){t.forEach(function(t){let n=$(t.addedNodes).is(".active-view");n&&e()})});$(".scavenge-option").each(function(){t.observe(this,{childList:!0,subtree:!0})})}(()=>I(!1))}(),D=!0),I())},getDebugProcess:function(){return U.create("Tool: Another Scavenging Script",R,!0)}})},function(e,t,n){"use strict";n.r(t);var s=n(2),r=n(1),i=n(0),o=n(5),a=n(4);class c extends s.a{constructor(e){super(),this.question=e,this.initStructure(e),this.watchSelf()}initStructure(){this.$el=$(this.createHtml().trim()),this.$answers=this.$el.find(".twcheese-debug-question-answer")}createHtml(){let e=[];for(let t=0;t<this.question.options.length;t++){let n=this.question.options[t];e.push(`\n                        <div class="twcheese-debug-question-answer ${n.className}" data-index="${t}">\n                            ${n.text}\n                        </div>\n                    `)}switch(this.question.getType()){case a.a.FREE_FORM:return this._createHtmlQuestionFreeForm();case a.a.VALUE:return this._createHtmlQuestionAboutValue(e);case a.a.SELECT:return this._createHtmlQuestionSelect(e);default:throw Error("unrecognized question type")}}_createHtmlQuestionSelect(e){return`\n                    <div class="twcheese-debug-question">\n                        <div class="twcheese-debug-question-text">${this.question.text}</div>\n                        <hr/>\n                        ${e.join("")}\n                    </div>\n                `}_createHtmlQuestionFreeForm(){let e=this.question.options[0];return`\n                    <div class="twcheese-debug-question">\n                        <div class="twcheese-debug-question-text">${this.question.text}</div>\n                        <hr/>\n                        <textarea\n                            placeholder="${Object(r.a)(e.text)}"\n                            class="twcheese-debug-question-answer ${e.className}"\n                            data-index="0"\n                        >${Object(r.a)(e.value)}</textarea>\n                    </div>\n                `}_createHtmlQuestionAboutValue(e){let t=this.createHtmlForValue(this.question.value);return`\n                    <div class="twcheese-debug-question">\n                        <div class="twcheese-debug-question-text">${this.question.text}</div>\n                        <hr/>\n                        <div class="twcheese-debug-question-content">\n                            <div class="twcheese-debug-question-value">${t}</div>\n                            <div style="padding-left: 10px;">${e.join("")}</div>\n                        </div>                \n                    </div>\n                `}createHtmlForValue(e){return null==e?'<span class="non-existent">non-existent</span>':"function"==typeof e.toDebugString?Object(r.a)(e.toDebugString()):"object"==typeof e?Object.entries(e).map(e=>{let[t,n]=e;return`<div class="twcheese-debug-value-iter">\n                            <div class="key">${this.createLabelForValue(n,t)}</div>\n                            <div class="value">${this.createHtmlForValue(n)}</div>\n                        </div>`}).join(""):Object(r.a)(e.toString())}createLabelForValue(e,t){return"function"==typeof e.imageSrc?`<image src="${e.imageSrc()}" />`:t}watchSelf(){this.question.getType()!==a.a.FREE_FORM?this.$answers.on("click",e=>{this.$answers.removeClass("active");let t=$(e.target).addClass("active");this.question.setSelectedOption(t.data("index"))}):this.$answers.on("input",e=>{let t=$(e.target);this.question.options[0].setValue(t.val())})}}Object(r.b)("\n            .twcheese-debug-question {\n                margin-bottom: 40px;\n            }\n        \n            .twcheese-debug-question-text {\n                font-size: 13px;\n                font-weight: 700;\n                color: rgb(200, 200, 200);\n            }\n        \n            .twcheese-debug-question hr {\n                height: 1px;\n                background-color: white;\n                border: none;\n                opacity: 0.2;\n            }\n        \n            .twcheese-debug-question-content {\n                display: flex;\n                justify-content: space-between;        \n                align-items: center;\n            }\n        \n            .twcheese-debug-question-value {\n                line-height: 20px;\n            }\n            .twcheese-debug-question-value img {\n                vertical-align: middle;\n            }\n        \n            .twcheese-debug-question-value .non-existent {\n                font-style: italic;\n            }\n        \n            .twcheese-debug-question-answer {\n                margin: 10px 0;\n                background-color: rgb(23, 23, 23);\n                border: 1px solid rgb(75, 75, 75);\n                height: 30px;\n                border-radius: 15px;\n                line-height: 30px;\n                white-space: nowrap;\n                padding: 0 10px;\n                text-align: center;\n                cursor: pointer;\n            }\n            .twcheese-debug-question-answer:hover {\n                border-color: rgb(150, 150, 150);\n            }\n            .twcheese-debug-question-answer.active {\n                border-color: darkOrange;\n                background-color: black;\n            }\n            \n            .twcheese-debug-question-answer.correct {\n                border-color: rgb(0, 70, 0);\n            }\n            .twcheese-debug-question-answer.correct:hover {\n                border-color: rgb(0, 100, 0);\n            }\n            .twcheese-debug-question-answer.correct.active {\n                border-color: rgb(0, 150, 0);\n            }\n        \n            .twcheese-debug-question-answer.incorrect {\n                border-color: rgb(100, 0, 0);\n            }\n            .twcheese-debug-question-answer.incorrect:hover {\n                border-color: rgb(175, 0, 0);\n            }\n            .twcheese-debug-question-answer.incorrect.active {\n                border-color: rgb(250, 0, 0);\n            }\n        \n            .twcheese-debug-question-answer.free-form {\n                border: 1px solid rgb(75, 75, 75);\n                border-radius: 3px;\n                white-space: pre-wrap;\n                color: inherit;\n                padding: 2px 5px;\n                text-align: left;\n                line-height: normal;\n                height: 120px;\n                width: calc(100% - 6px);\n                resize: vertical;\n                cursor: text;\n            }\n        \n            .twcheese-debug-value-iter {\n                display: flex;\n            }\n            .twcheese-debug-value-iter > div:nth-child(2) {\n                padding-left: 5px;\n            }\n        \n        ");class h extends s.a{constructor(e){super(),this.phase=e,this.initStructure(),this.watchSelf(),this.$abort.hide()}initStructure(){this.$el=$(this.createHtml().trim()),this.$abort=this.$el.find(".twcheese-debug-attempt-abort")}createHtml(){return this.phase.instructions?this.createHtmlForUserInteraction():this.createHtmlForAutoAttempt()}createHtmlForUserInteraction(){return`\n                    <div class="twcheese-debug-attempt">\n                        <p>${this.phase.instructions}</p>\n                        <div style="text-align: center;">\n                            <div class="twcheese-debug-attempt-abort">Can't do it</div>\n                        </div>\n                    </div>\n                `}createHtmlForAutoAttempt(){return`\n                    <div class="twcheese-debug-attempt">\n                        Standby for <i>${this.phase.name}</i>.\n                    </div>\n                `}watchSelf(){this.$abort.on("click",()=>this.phase.userAbort())}appendTo(e){return setTimeout(()=>this.showAbortButton(),1e4),super.appendTo(e)}showAbortButton(){this.$abort.show(),$(this).trigger("change")}}Object(r.b)("\n            .twcheese-debug-attempt-abort {\n                display: inline-block;\n                margin: 10px 0;\n                background-color: rgb(23, 23, 23);\n                border: 1px solid rgb(75, 75, 75);\n                height: 30px;\n                border-radius: 15px;\n                line-height: 30px;\n                white-space: nowrap;\n                padding: 0 10px;\n                text-align: center;\n                cursor: pointer;\n            }\n            .twcheese-debug-attempt-abort:hover {\n                border-color: rgb(150, 150, 150);\n            }   \n        ");class l extends s.a{constructor(e){super(),this.phase=e,this.initStructure(),this.watchPhase()}initStructure(){this.$el=$(this.createHtml().trim())}createHtml(){return'<div class="twcheese-debug-report"><i>Submitting report...</i></div>'}watchPhase(){$(this.phase).on(i.a.BUG_REPORT_SUCCEEDED,e=>{this.$el.html("<p>Bug reported!</p>")})}}Object(r.b)("\n            .twcheese-debug-report {\n                min-height: 200px;\n            }    \n        ");class u extends s.a{constructor(){super(),this.initStructure(),this.watchSelf(),this.watchGlobal(),this.process=null}initStructure(){this.$el=$(this.createHtml().trim()),this.$header=this.$el.find(".twcheese-debugger-header"),this.$content=this.$el.find(".twcheese-debugger-content"),this.$nav=this.$el.find(".twcheese-debugger-nav"),this.$next=this.$el.find(".twcheese-debugger-next"),this.$processName=this.$el.find(".twcheese-debugger-process-name"),this.$inspector=this.$el.find(".twcheese-debugger-inspector"),this.$iframe=this.$inspector.find("iframe"),this.$iframeOverlay=this.$inspector.find(".iframe-overlay")}createHtml(){return'\n                    <div class="twcheese-debugger">\n                        <div>\n                            <div class="twcheese-debugger-header">\n                                <div>REPORT A BUG</div>\n                                <div class="twcheese-debugger-process-name"></div>\n                            </div>\n                            <div class="twcheese-debugger-content">blah bla blucci</div>\n                            <div class="twcheese-debugger-nav">\n                                <div class="twcheese-debugger-next"></div>\n                            </div>\n                        </div>\n                        <div class="twcheese-debugger-inspector">\n                            <iframe scrolling="no"></iframe>\n                            <div class="iframe-overlay"></div>\n                        </div>\n                    </div>\n                '}watchSelf(){this.$next.on("click",()=>{this.process.goToNextPhase()})}watchGlobal(){$(window).on("resize",()=>this.updateScrolling())}startProcessForLastUsedToolIfSensible(){this.process||this.startProcess(window.TwCheese.newDebugProcess(TwCheese.lastToolUsedId))}startProcess(e){this.$next.hide(),this.process=e,this.$processName.text(e.name),$(e).on(i.a.PHASE_COMPLETION_READY,()=>{this.process.hasNextPhase()&&this.$next.show()}),$(e).on(i.a.PHASE_COMPLETION_NOT_READY,()=>{this.$next.hide()}),$(e).on(i.a.PHASE_CHANGED,()=>{this.renderCurrentPhase()}),e.start()}renderCurrentPhase(){this.$inspector.hide(),this.$content.html(""),this.process.hasNextPhase()||this.$next.hide();let e=this.process.getCurrentPhase();switch(e.getType()){case o.a.QUESTION:this._renderPhaseQuestion(e);break;case o.a.ATTEMPT:this._renderPhaseAttempt(e);break;case o.a.REPORT:this._renderPhaseReport(e);break;default:throw Error("unrecognized phase")}setTimeout(()=>this.updateScrolling(),200),$(this).trigger("change")}_renderPhaseQuestion(e){for(let t of e.questions)new c(t).appendTo(this.$content);"string"==typeof e.examinedHtml&&this.openInspector(e.examinedHtml)}_renderPhaseAttempt(e){let t=new h(e).appendTo(this.$content);$(t).on("change",()=>this.updateScrolling())}_renderPhaseReport(e){new l(e).appendTo(this.$content)}updateScrolling(){this.$content.parent(".slimScrollDiv").size()>0&&(this.$content.parent().replaceWith(this.$content),this.$content.height("auto"));let e=this.$el.innerHeight()-this.$header.outerHeight()-this.$nav.outerHeight();this.$content.slimScroll({height:Math.min(e,this.$content.outerHeight()),color:"rgb(150, 150, 150)",opacity:.3,borderRadius:0,alwaysVisible:!0})}openInspector(e){let t=this.$iframe[0].contentWindow,n=t.document;n.open(),n.write(e),n.close(),setTimeout(()=>{void 0!==t.Timing&&t.Timing.pause(),this.$inspector.show();let e=Math.min(t.document.body.scrollWidth,this.calcMaxIframeWidth());this.$iframe.css({width:e}),this.$iframeOverlay.css({width:e}),$(this).trigger("change")},200)}calcMaxIframeWidth(){return document.documentElement.clientWidth-this.$header.outerWidth()-50-40}}Object(r.b)("\n            .twcheese-debugger {\n                height: 100%;\n                display: flex;\n            }\n        \n            .twcheese-debugger a {\n                font-weight: normal;\n                font-size: 12px;\n                color: rgb(63, 156, 214);\n                text-decoration: underline;\n            }\n            .twcheese-debugger a:hover {\n                color: rgb(96, 174, 221);\n            }\n        \n            .twcheese-debugger-header {\n                background-color: rgb(56, 56, 56);\n                padding: 9px 20px;\n                font-weight: 700;\n                font-size: 14px;\n                color: rgb(200, 200, 200);\n                cursor: default;\n                min-width: 300px;\n            }\n        \n            .twcheese-debugger-process-name {\n                font-weight: normal;\n                font-size: 11px;\n                margin-top: 3px;\n                white-space: nowrap;\n            }\n        \n            .twcheese-debugger-content {\n                box-sizing: border-box;\n                padding: 20px;\n            }\n        \n            .twcheese-debugger-nav {\n                padding: 20px 10px;\n                height: 20px;\n            }\n        \n            .twcheese-debugger-next {\n                width: 0;\n                height: 0;\n                border: 10px solid transparent;\n                cursor: pointer;\n                webkit-filter: brightness(0.7);\n                filter: brightness(0.7);\n            }\n        \n            .twcheese-debugger-next {\n                border-left: 20px solid white;\n                float: right;\n            }\n        \n            .twcheese-debugger-next:hover {\n                webkit-filter: brightness(1);\n                filter: brightness(1);\n            }\n        \n            /* inspector */\n        \n            .twcheese-debugger-inspector {\n                position: relative;\n                width: 100%;\n                background-color: rgb(30, 30, 30);\n                line-height: unset;\n            }\n        \n            .twcheese-debugger-inspector iframe,\n            .twcheese-debugger-inspector .iframe-overlay {\n                width: 500px;\n                height: calc(100% - 40px);\n                margin: 20px;\n                border: none;\n                overflow: hidden;\n            }\n        \n            .twcheese-debugger-inspector .iframe-overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                background-color: cyan;\n                opacity: 0.1;\n            }\n        \n        ");var d=n(3);class p extends s.a{constructor(){super(),this.initStructure(),this.watchSelf(),this.isExpandedVert=!1,this.activeMenuItem=null,this.contents={bugReporter:(new u).appendTo(this.$content)},this.watchContents()}initStructure(){this.$el=$(this.createHtml().trim()),this.$menuMain=this.$el.find(".menu-item.main"),this.$mainIcon=this.$menuMain.find(".icon"),this.$menuBug=this.$el.find(".menu-item.bug"),this.$menuGithub=this.$el.find(".menu-item.github"),this.$content=this.$el.find(".twcheese-sidebar-content")}createHtml(){return'\n                    <div id="twcheese-sidebar">\n                        <div class="twcheese-sidebar-menu">\n                            <div class="menu-item main"><div class="icon"></div></div>\n                            <div class="menu-item bug"><div class="icon"></div></div>\n                            <a class="menu-item github"\n                              href="https://github.com/cheesasaurus/twcheese/releases"\n                              target="_blank"\n                            ><div class="icon"></div></a>\n                        </div>\n                        <div class="twcheese-sidebar-content"></div>\n                    </div>\n                '}watchSelf(){this.$menuMain.on("click",()=>this.toggleExpand()),this.$menuBug.on("click",()=>{this.$menuBug.hasClass("active")?(this.$menuBug.removeClass("active"),this.activeMenuItem=null,this.shrinkHoriz()):(this.contents.bugReporter.startProcessForLastUsedToolIfSensible(),this.$menuBug.addClass("active"),this.activeMenuItem="bug",this.expandHoriz())})}watchContents(){$.each(this.contents,(e,t)=>{$(t).on("change",()=>{this.activeMenuItem&&this.$el.width(this.$el[0].scrollWidth)})})}async toggleExpand(){let e=this.activeMenuItem?200:0,t=200+e;this.spinMainIcon(t),this.isExpandedVert?(this.activeMenuItem&&await this.shrinkHoriz(e),this.shrinkVert(200)):(await this.expandVert(200),this.activeMenuItem&&this.expandHoriz(e))}spinMainIcon(e){$({deg:0}).animate({deg:180},{duration:e,step:e=>{this.$mainIcon.css({transform:"rotate("+e+"deg)"})}})}async expandVert(e){return this.isExpandedVert=!0,new Promise((t,n)=>{let s={duration:e,complete:()=>{this.$menuGithub.show(),t()}};this.$el.animate({height:"100%",easing:"linear"},s)})}shrinkVert(e){this.$menuGithub.hide(),this.isExpandedVert=!1,this.$el.animate({height:"50px"},e)}expandHoriz(e){let t={duration:e};this.$el.animate({width:this.$el[0].scrollWidth},t)}async shrinkHoriz(e){return new Promise((t,n)=>{let s={duration:e,complete:t};this.$el.animate({width:"50px"},s)})}}Object(r.b)(`\n            #twcheese-sidebar {\n                position: fixed;\n                display: inline-block;\n                z-index: 20000;\n                top: 0;\n                left: 0;\n                height: 50px;\n                max-height: 100%;\n                overflow-x: hidden;\n                overflow-y: hidden;\n                width: 50px;\n                max-width: 100%;\n            }\n        \n            /* menu **************************************************/\n        \n            .twcheese-sidebar-menu {\n                position: relative;\n                display: block;\n                width: 50px;\n                height: 100%;\n                background-color: rgb(51, 51, 51);\n            }\n        \n            .twcheese-sidebar-menu.expanded {\n                height: 100%;\n            }\n        \n            .twcheese-sidebar-menu .menu-item {\n                position: relative;\n                display: block;\n                box-sizing: border-box;\n                width: 50px;\n                height: 50px;\n                cursor: pointer;\n            }\n        \n            .twcheese-sidebar-menu .menu-item .icon {\n                position: absolute;\n                box-sizing: border-box;\n                position: absolute;\n                width: 50px;\n                height: 50px;\n                \n                background-size: 36px 36px;\n                background-repeat: no-repeat;\n                background-position: center;\n            }\n            \n        \n            .twcheese-sidebar-menu .menu-item.main {\n                background-color: darkOrange;\n            }\n        \n            .twcheese-sidebar-menu .menu-item.main .icon {\n                background-image: url('${d.a.sidebarMain}');\n            }\n            .twcheese-sidebar-menu .menu-item.main:hover .icon {\n                -webkit-filter: brightness(2);\n                filter: brightness(2);\n            }\n        \n            .twcheese-sidebar-menu .menu-item.bug .icon {\n                background-image: url('${d.a.sidebarBug}');\n                -webkit-filter: brightness(0.7);\n                filter: brightness(0.7);\n            }\n        \n            .twcheese-sidebar-menu .menu-item.github {\n                position: absolute;\n                display: none;\n                bottom: 0;\n                margin-top: 50px;\n            }\n        \n            .twcheese-sidebar-menu .menu-item.github .icon {\n                background-image: url('${d.a.sidebarGithub}');\n                -webkit-filter: brightness(0.7);\n                filter: brightness(0.7);\n            }\n        \n            .twcheese-sidebar-menu .menu-item:hover .icon,\n            .twcheese-sidebar-menu .menu-item.active .icon {\n                -webkit-filter: brightness(1);\n                filter: brightness(1);\n            }\n        \n            /* content  **************************************************/\n        \n            .twcheese-sidebar-content {\n                position: absolute;\n                display: block;\n                left: 50px;\n                height: 100%;\n                top: 0;\n                background-color: rgb(37, 37, 37);\n                color: rgb(187, 187, 187);\n            }\n        \n        \n        `),TwCheese.registerTool({id:"Sidebar",use:()=>{(new p).appendTo($("body"))},getDebugProcess:()=>null})}]),sidebarInitd||TwCheese.useTool("Sidebar")}TwCheese.useTool(toolId)}();